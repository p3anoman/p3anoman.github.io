const e={TitleView:class TitleView{init(){this.addEventListener("click","click");let e=new(this.model.getLibrary("boards.AssetLibrary"));this.dom.querySelector("#boardTitleIcon").style.setProperty("background-image",e.greenlightLogo()),console.log("TitleView init")}click(){this.toggleQR()}startTitleMenu(){let e=this.makeMenu();this.titleMenu=e;let t=window.topView.querySelector("#cover");t&&t.call("CoverView","addMenu",{menu:e,placeElement:this})}hideTitleMenu(){this.titleMenu&&(this.titleMenu.remove(),this.titleMenu=null)}toggleQR(){if(this.qrElement)window.topView.querySelector("#tools").dom.removeChild(this.qrElement),delete this.qrElement;else{const{App:e}=Croquet,t=this.qrElement=document.createElement("div");t.id="qr",window.topView.querySelector("#tools").dom.appendChild(t);const i=e.sessionURL=window.location.href,s=e.makeQRCanvas();t.innerHTML='<p class="no-select">Scan to join</p>',t.onclick=e=>{e.preventDefault(),e.stopPropagation(),window.open(i)},t.appendChild(s)}}makeMenuItem(e,t,i){let s=document.createElement("div");if(null===t)return s.classList.add("no-select","frame-menu-title"),s.innerHTML=`<span>${i}</span>`,s;s.classList.add("no-select","frame-menu-item");let o="";if(e){o=`<div class="frame-menu-icon"><svg viewBox="0 0 24 24" class="frame-menu-icon-svg"><use href="#${"img-"+e}"></use></svg></div>`}return o+=`<span class="frame-menu-label">${i}</span>`,s.innerHTML=o,s.value=t,s.addEventListener("click",(e=>this.menuSelected(e)),!0),s}makeMenu(){let e=[{value:null,label:"MAIN MENU"},{value:"saveContents",label:"Save"},{value:"saveContentsAs",label:"Save As..."},{value:"loadContents",label:"Load"},{value:"loadContentsFrom",label:"Load From..."}];this.qrElement?e.push({value:"toggleQR",label:"Hide QR Code"}):e.push({value:"toggleQR",label:"Show QR Code"});let t=this.model.getLibrary("widgets.DOMMenu"),i=document.createElement("div");return(new t).makeMenu(i,"frame-menu",e,this,this.menuSelected),i}menuSelected(e){let t=e.currentTarget.value;this.hideTitleMenu();let i=window.topView.querySelector("#scaler"),s=window.topView.querySelector("#cover");if(!s)return;s.call("CoverView","deactivate");let o={x:e.clientX+32,y:e.clientY};"saveContents"===t?i.call("PasteUpView","saveRequest",o):"saveContentsAs"===t?i.call("PasteUpView","saveRequest",o,!0):"loadContents"===t?i.call("PasteUpView","loadRequest",o):"loadContentsFrom"===t?i.call("PasteUpView","loadRequest",o,!0):"toggleQR"===t&&this.toggleQR()}requestToolsHidden(e){e?(this.dom.classList.add("hidden"),this.hideTitleMenu()):this.dom.classList.remove("hidden")}},MiddleView:class MiddleView{enablePointerMoveHandler(){this.addEventListener("pointermove","pointerMove")}disablePointerMoveHandler(){this.removeEventListener("pointermove","pointerMove")}ensureScaler(){return this.scaler||(this.scaler=window.topView.querySelector("#scaler")),this.scaler}pointerMove(e){e.preventDefault(),e.stopPropagation(),this.ensureScaler(),this.scaler.call("PasteUpView","pointerMove",e,!0)}},PeerView:class PeerView{init(){this.dom.style.setProperty("top","0px"),this.dom.style.setProperty("height","100%");let e=window.innerWidth,t=.4;window.fromLandingPage&&"textOnly"===window.fromLandingPage.chat&&(t=.12);let i=100+(e-700)*t;i=Math.min(Math.max(100,i),450),window.fromLandingPage&&"off"!==window.fromLandingPage.chat||(i=0),this.dom.style.setProperty("width",i+"px")}},FrameModel:class FrameModel{setObject(e,t){if(this._set("target",e.asElementRef()),this.initElementsFor(e),t){let{x:e,y:i}=t,s=[1,0,0,1,e,i];this.setTransform(s)}this.subscribe(this.id,"qrState","qrState"),this.subscribe(this.sessionId,"presentationStopped","presentationStopped"),this.subscribe(this.id,"requestInteraction","requestInteraction"),this.subscribe(this.id,"endInteraction","endInteraction")}getTitleHeight(){return 35}initElementsFor(e){if(this.title)return;let t=e._get("desiredFrameType");this._set("frameType",t);let i=this.createElement();i.domId="pad",i.classList.add("frame-pad"),i.style.setProperty("opacity","0.99999999"),i.appendChild(e),this.pad=i,this.classList.add("frame-frame"),this.style.setProperty("-cards-direct-manipulation",!0),this.setTransform("1,0,0,1,0,0"),this.style.setProperty("position","absolute");let s=this.createElement();s.domId="trash",s.setCode("boards.FrameTrashModel"),s.setViewCode(["boards.FrameTrashView","widgets.PointerDownFilterView","widgets.DoubleClickFilterView"]),s.classList.add("frame-trash-button");let o=this.createElement();o.domId="title",o.classList.add("frame-title"),o.setViewCode("boards.FrameMoveView"),"stickyNote"===t&&(this.classList.add("sticky-note"),i.classList.add("sticky-note"),o.classList.add("sticky-note"),s.classList.add("sticky-note")),this._get("hasAddressBar")&&(this.addQRButton(o),this.addAddress(o)),o.appendChild(s),this.appendChild(o),this.appendChild(i),this.title=o,["left","right","top","bottom"].forEach((e=>{let i=this.createElement();i.domId=`resizer-${e}`,i.classList.add("frame-resize-edge",`edge-${e}`),"stickyNote"===t&&i.classList.add("sticky-note"),i.setCode("boards.FrameResizeModel"),i.setViewCode("boards.FrameResizeView");let s="left"===e||"right"===e;i.call("FrameResizeModel","setEdges",s?e:null,s?null:e),this.appendChild(i)})),["left","right"].forEach((e=>{["top","bottom"].forEach((i=>{let s=this.createElement();s.domId=`resizer-${e}-${i}`,s.classList.add("frame-resize-corner",`x-${e}`,`y-${i}`),"stickyNote"===t&&s.classList.add("sticky-note"),s.setCode("boards.FrameResizeModel"),s.setViewCode("boards.FrameResizeView"),s.call("FrameResizeModel","setEdges",e,i),this.appendChild(s)}))})),this._set("showBorder",!0),this._set("background",null),this._set("locked",!1),this._set("showBorder",!0),this._set("active",!1),this._set("frameUser",null),this._set("interactionStatus",{}),this._set("qrState",null),this.interactionTimeout=5e3,this.checkLockExpiry()}addAddress(e){let t=this._get("target");if(!t)return;let i=this.getElement(t);if(!i)return;let s=this.createElement("TextElement");s.domId="externalAddress",s.classList.add("frame-external-address"),s.style.setProperty("-cards-text-singleLine",!0),s.style.setProperty("-cards-text-margin","0px 0px 0px 4px"),s.setDefault("Poppins-Medium",16),s._set("enterToAccept",!0),i._set("addressBarInfo",s.asElementRef()),i.subscribe(s.id,"text","MiniBrowser.urlFromText"),e.appendChild(s);let o=this.createElement();o.domId="addressEdit",o.setCode("boards.FrameAddressEditModel"),o.setViewCode(["boards.FrameAddressEditView","widgets.PointerDownFilterView","widgets.DoubleClickFilterView"]),o.classList.add("frame-address-edit-button"),e.appendChild(o)}addQRButton(e){let t=this.createElement();t.domId="frame-qr-button",t.setViewCode(["minibrowser.QRView","widgets.DoubleClickFilterView"]),t.classList.add("frame-qr-button"),e.appendChild(t)}qrState(e){this._set("qrState",e),this.stateChanged()}presentationStopped(){this._set("qrState",null)}stateChanged(){this.publish(this.id,"frameStateChanged")}beSolidBackground(){}requestInteraction({requester:e,scope:t,event:i,data:s}){const o=s.updates,r=this.lockOrFilter(e,Object.keys(o));if(0===r.length)return;if(this.publish(this.id,"interactionStateChanged"),!i)return;const n={};r.forEach((e=>n[e]=o[e]));const a={...s,updates:n};this.publish(t,i,a)}endInteraction({scope:e,event:t,requester:i,data:s}){const o=this._get("interactionStatus")[i];o&&(delete o.interacting,o.heldLocks.length&&this.releaseLocks(i));for(const e of Object.values(this._get("interactionStatus")))if(e.heldLocks.length)return;this.publish(e,t,s)}releaseLocks(e){this._get("interactionStatus")[e].heldLocks.length=0,this.publish(this.id,"interactionStateChanged")}lockHolder(e){for(const[t,i]of Object.entries(this._get("interactionStatus")))if(i.heldLocks.includes(e))return t;return null}lockOrFilter(e,t){let i,s=this._get("interactionStatus")[e];s||(s=this._get("interactionStatus")[e]={heldLocks:[]}),s.interacting?i=s.heldLocks:(s.interacting=!0,i=t.filter((e=>!this.lockHolder(e))),s.heldLocks=i);const o=t.filter((e=>i.includes(e)));return o.length&&(s.lockTime=this.now()),o}checkLockExpiry(){for(const[e,t]of Object.entries(this._get("interactionStatus"))){const{heldLocks:i,lockTime:s}=t;i.length&&this.now()-s>=this.interactionTimeout&&this.releaseLocks(e)}this.future(500).call("FrameModel","checkLockExpiry")}},FrameView:class FrameView{init(){this.addEventListener("pointerenter","pointerEnter"),this.addEventListener("pointerleave","pointerLeave"),this.subscribe(this.model.id,"frameStateChanged","frameStateChanged"),this.subscribe(this.model.id,"interactionStateChanged","interactionStateChanged"),this.subscribe(this.sessionId,"presentationStarted","presentationStarted"),this.subscribe(this.sessionId,"followingChanged","followingChanged"),this.dom.setAttribute("pointerEntered","false"),this.dom.setAttribute("showBorder",`${this.model._get("showBorder")}`),this.setupQRButton(),this.interactionStateChanged(),this.frameStateChanged()}pointerEnter(){this.dom.setAttribute("pointerEntered","true"),this.model._get("background")&&this.dom.style.setProperty("background-color",this.model._get("background"))}pointerLeave(){"true"===this.dom.getAttribute("interacting")||this.menuIsActive||this.dom.setAttribute("pointerEntered","false")}setupQRButton(){this.pad=window.topView.querySelector("#pad"),this.qrButton=this.querySelector("#frame-qr-button"),this.qrButton&&this.qrButton.call("QRView","setFrameView",this.id),this.subscribe(this.id,"qrState","qrState")}qrState(e){this.pad.call("TransformView","getPresenter")===this.viewId&&this.publish(this.model.id,"qrState",e)}presentationStarted(){this.pad.call("TransformView","getPresenter")===this.viewId&&this.publish(this.model.id,"qrState",this.model._get("qrState"))}followingChanged(){this.frameStateChanged()}getRect(){let e=this.dom.querySelector("#pad");if(!e)return null;let t=e.firstChild;if(!t)return null;let i=t.style.getPropertyValue("width"),s=t.style.getPropertyValue("height"),o=this.dom.style.getPropertyValue("transform");if(!i||!s||!o)return null;o=o.split(",");let r=parseFloat(o[4]),n=parseFloat(o[5]);return{width:parseFloat(i),height:parseFloat(s),x:r,y:n}}frameStateChanged(){this.dom.setAttribute("locked",this.model._get("locked")?"true":"false"),this.dom.setAttribute("showBorder",`${this.model._get("showBorder")}`),this.qrButton&&this.pad.following&&(!0===this.model._get("qrState")?this.qrButton.call("QRView","show"):!1===this.model._get("qrState")&&this.qrButton.call("QRView","hide"))}interactionStateChanged(){const e=this.model._get("interactionStatus"),t=[];let i="stickyNote"===this.model._get("frameType");for(const[s,o]of Object.entries(e)){let e=o.heldLocks;if(i&&(e=e.filter((e=>"top"!==e))),e){const o=window.topView.querySelector("#scaler").call("PasteUpView","getUserColor",s);if(4===e.length)i||t.push(`0 0 2px 4px ${o}`);else{const s={};(i?["bottom"]:["top","bottom"]).forEach((i=>{e.includes(i)&&["left","right"].forEach((r=>{if(e.includes(r)){const e=("left"===r?"-":"")+"3px",n=("top"===i?"-":"")+"3px";t.push(`${e} ${n} 2px 1px ${o}`),s[r]=!0,s[i]=!0}}))})),e.forEach((e=>{if(!s[e]){let i;switch(e){case"top":i="0 -6px";break;case"right":i="6px 0";break;case"bottom":i="0 6px";break;case"left":i="-6px 0"}t.push(`${i} 2px -2px ${o}`)}}))}}}t.length?this.dom.style.setProperty("box-shadow",t.join(",")):this.dom.style.setProperty("box-shadow",null)}},FrameMoveView:class FrameMoveView{init(){let e=this.getModel();e&&(this.addEventListener("pointerdown","pointerDown"),this.addEventListener("dblclick","doubleClick"),this.subscribe(e.id,"frameStateChanged","frameStateChanged"),this.frameStateChanged())}frameStateChanged(){let e=this.getModel();e&&this.dom.setAttribute("locked",e._get("locked")?"true":"false")}getScaler(){return this.scaler||(this.scaler=window.topView.querySelector("#scaler")),this.scaler}getPad(){return this.pad||(this.pad=window.topView.querySelector("#pad")),this.pad}getView(){return this.parentNode}getModel(){let e=this.getView();return e&&e.model}getEmbeddedObject(){let e=this.getModel(),t=e&&e._get("target");return t&&e.getElement(t)}pointerDown(e){if(1!==e.buttons)return;if(e.preventDefault(),e.stopPropagation(),this.setPointerCapture(e.pointerId),"0"===this.dom.style.getPropertyValue("opacity"))return;let t=this.getView();if(!t)return;let i=this.getModel();if(!i)return;if(i._get("locked"))return;let s=this.getEmbeddedObject();if(!s)return;let o=i.asElementRef();this.publish(this.sessionId,"bringToFront",{target:o,viewId:this.viewId}),this.addEventListener("pointermove","pointerMove"),this.addEventListener("pointerup","pointerUp"),this.addEventListener("pointercancel","pointerUp"),this.addEventListener("lostpointercapture","pointerUp"),t.dom.setAttribute("interacting","true");let r=this.getScaler(),n=this.getPad(),a=r.currentZoom,l=r.currentTranslation,d=n.dom.getBoundingClientRect(),xRaw=e=>Math.round((l.x+e-d.x)/a),yRaw=e=>Math.round((l.y+e-d.y)/a);this.origDownPoint={x:xRaw(e.clientX),y:yRaw(e.clientY)};let h=t.dom.getBoundingClientRect();this.origRect={top:yRaw(h.top),bottom:yRaw(h.bottom),left:xRaw(h.left),right:xRaw(h.right)},this.resizeTarget=s,this.publish(i.id,"requestInteraction",{requester:this.viewId,data:{updates:{top:!0,bottom:!0,left:!0,right:!0}}})}pointerMove(e){e.preventDefault(),e.stopPropagation();let t=this.getModel();if(!t)return;let i=t.asElementRef(),s=this.resizeTarget.asElementRef(),o=this.viewId,r=this.getScaler(),n=r.currentZoom,a=r.currentTranslation,l=this.pad.dom.getBoundingClientRect(),d=Math.round((a.x+e.clientX-l.x)/n),h=Math.round((a.y+e.clientY-l.y)/n),c=this.origDownPoint,u=d-c.x,m=h-c.y,g=this.origRect,w=g.top+m,f=g.bottom+m,v=g.left+u,y=g.right+u;window.topView.throttledInvoke("moveObjectEdges",r.throttleBaseMS,(()=>this.publish(t.id,"requestInteraction",{requester:o,scope:t.sessionId,event:"moveObjectEdges",data:{target:s,viewId:o,frameInfo:i,updates:{top:w,bottom:f,left:v,right:y}}}))),this.getPad().call("TransformView","clearRestoreViewportIfSameFrame",t.id)}pointerUp(e){this.releaseAllPointerCapture(),this.removeEventListener("pointermove","pointerMove"),this.removeEventListener("pointerup","pointerUp"),this.removeEventListener("pointercancel","pointerUp"),this.removeEventListener("lostpointercapture","pointerUp"),window.topView.clearThrottledInvoke("moveObjectEdges");let t=this.getView();if(!t)return;t.dom.setAttribute("interacting","false");let i=this.getModel();if(!i)return;let s=i.asElementRef(),o=this.viewId;this.publish(i.id,"endInteraction",{scope:i.sessionId,event:"resizeOrMoveEnd",requester:o,data:{frameInfo:s,viewId:o}})}doubleClick(e){e.preventDefault(),e.stopPropagation();let t=this.getView();if(!t)return;let i=this.getModel();if(!i)return;let s=this.getScaler(),o=this.getPad();if(o.call("TransformView","restoreViewportIfSameFrame",i.id))return;let r=s.currentZoom,n=s.currentTranslation,a=o.dom.getBoundingClientRect(),l=t.dom.getBoundingClientRect(),d=i.call("FrameModel","getTitleHeight"),h=(n.x+l.left-a.x)/r;h-=d;let c=(n.y+l.top-a.y)/r,u=l.width/r;u+=2*d;let m=l.height/r;m+=d;let g={x:h,y:c,width:u,height:m};o.call("TransformView","setViewportFromFrame",i.id,g)}},FrameResizeModel:class FrameResizeModel{setEdges(e,t){this.edges=[e,t]}},FrameResizeView:class FrameResizeView{init(){this.getModel()&&window.topView.requestInitialization(this,"FrameResizeView","setup")}setup(){if(this.addEventListener("pointerdown","pointerDown"),this.edges=this.model.edges,this.edges[0]&&this.edges[1]){let e=`<div class="resize-corner-blob" style="background-color: ${window.topView.querySelector("#scaler").call("PasteUpView","getUserColor",this.viewId)}"></div>`;this.dom.innerHTML=e}}getView(){return this.parentNode}getModel(){let e=this.getView();return e&&e.model}getEmbeddedObject(){let e=this.getModel(),t=e&&e._get("target");return t&&e.getElement(t)}pointerDown(e){if(1!==e.buttons)return;e.preventDefault(),e.stopPropagation(),this.setPointerCapture(e.pointerId);let t=this.getView();if(!t)return;let i=this.getModel();if(!i)return;if(i._get("locked"))return;let s=this.getEmbeddedObject();if(!s)return;this.addEventListener("pointermove","pointerMove"),this.addEventListener("pointerup","pointerUp"),this.addEventListener("pointercancel","pointerUp"),this.addEventListener("lostpointercapture","pointerUp"),this.scaler||(this.scaler=window.topView.querySelector("#scaler")),this.pad||(this.pad=window.topView.querySelector("#pad")),t.dom.setAttribute("interacting","true");let o=this.scaler.currentZoom,r=this.scaler.currentTranslation,n=this.pad.dom.getBoundingClientRect(),xRaw=e=>Math.round((r.x+e-n.x)/o),yRaw=e=>Math.round((r.y+e-n.y)/o),a=t.dom.getBoundingClientRect(),[l,d]=this.edges,h=l&&xRaw(a[l])-xRaw(e.clientX),c=d&&yRaw(a[d])-yRaw(e.clientY);this.interactionOffset={x:h,y:c},this.resizeTarget=s,this.frameView=t;let u={};l&&(u[l]=!0),d&&(u[d]=!0),this.publish(i.id,"requestInteraction",{requester:this.viewId,data:{updates:u}})}pointerMove(e){if(e.preventDefault(),e.stopPropagation(),!this.resizeTarget)return;let t=this.scaler.currentZoom,i=this.scaler.currentTranslation,s=this.pad.dom.getBoundingClientRect(),o=Math.round((i.x+e.clientX-s.x)/t),r=Math.round((i.y+e.clientY-s.y)/t),n=this.frameView.model,a=n.asElementRef(),l=this.resizeTarget.asElementRef(),d=this.viewId,[h,c]=this.edges,u=this.interactionOffset,m={};h&&(m[h]=o+u.x),c&&(m[c]=r+u.y);window.topView.throttledInvoke("moveObjectEdges",this.scaler.throttleBaseMS,(()=>this.publish(n.id,"requestInteraction",{requester:d,scope:n.sessionId,event:"moveObjectEdges",data:{target:l,viewId:d,frameInfo:a,updates:m}})))}pointerUp(e){if(this.releaseAllPointerCapture(),this.removeEventListener("pointermove","pointerMove"),this.removeEventListener("pointerup","pointerUp"),this.removeEventListener("pointercancel","pointerUp"),this.removeEventListener("lostpointercapture","pointerUp"),window.topView.clearThrottledInvoke("moveObjectEdges"),!this.frameView)return;this.frameView.dom.setAttribute("interacting","false");let t=this.frameView.model,i=t.asElementRef(),s=this.viewId;this.publish(t.id,"endInteraction",{scope:t.sessionId,event:"resizeOrMoveEnd",requester:s,data:{frameInfo:i,viewId:s}})}},FrameMenuModel:class FrameMenuModel{init(){if(!this.querySelector("#icon")){let e='\n<svg id="icon-inactive" viewBox="0 0 24 24"><use href="#img-more"></use></svg>\n<svg id="icon-active" viewBox="0 0 24 24"><use href="#img-more-active"></use></svg>\n';this.innerHTML=e}this._get("remoteMenus")||this._set("remoteMenus",{}),this.subscribe(this.id,"addMenuFor","addMenuFor"),this.subscribe(this.id,"removeMenuFor","removeMenuFor"),this.subscribe(this.sessionId,"view-exit","removeMenuFor")}addMenuFor(e){let t={...this._get("remoteMenus")};t[e]=!0,this._set("remoteMenus",t),this.publish(this.id,"remoteMenusChanged")}removeMenuFor(e){let t={...this._get("remoteMenus")};delete t[e],this._set("remoteMenus",t),this.publish(this.id,"remoteMenusChanged")}},FrameMenuView:class FrameMenuView{init(){this.addEventListener("click","click"),this.subscribe(this.model.id,"remoteMenusChanged","remoteMenusChanged"),this.remoteMenusChanged(),console.log("FrameMenuView.init")}getMenuTarget(){let e=this.getTarget();return e&&e._get("target")}getTarget(){let e=this.getView();return e&&e.model}getView(){return this.parentNode?this.parentNode.parentNode:null}click(e){let t=this.getView();if(!t)return;let i=this.makeMenu();if(!i)return;let s=window.topView.querySelector("#cover");s&&this.getTarget()&&(t.menuIsActive=!0,s.call("CoverView","addMenu",{menu:i,placeElement:t}),this.dom.setAttribute("active","true"),this.publish(this.model.id,"addMenuFor",this.viewId))}remoteMenusChanged(){let e=this.model._get("remoteMenus"),t=Object.keys(e);!this.getTarget().parentNode||0===t.length||e[this.viewId]?this.hideRemoteMenu():this.showRemoteMenu()}hideRemoteMenu(){this.remoteMenu&&(this.remoteMenu.remove(),this.remoteMenu=null)}showRemoteMenu(){if(this.remoteMenu)return;if(!this.dom.parentNode)return;let e=this.makeMenu(!0);e&&(this.dom.parentNode.appendChild(e),this.remoteMenu=e)}faveIndicator(e){return this.svgStarFunc||(this.svgStarFunc=new Function(this.model.getLibrary("boards.faveIndicator"))()),this.svgStarFunc(e)}makeMenu(e){let t=this.getView();if(!t)return null;let i=this.getMenuTarget();if(!i)return null;let s=this.model.getElement(i);if(!s)return null;let o=this.getTarget();if(!o)return null;let r=t.querySelector("#miniBrowser"),n=r&&r.call("MiniBrowserView","getMenuFavoriteItems")||[];n=n.map((e=>{let t=this.faveIndicator(e.iconGenerator.slice(5));return{...e,asset:t}})),e&&(n=n.map((e=>e.localToView?{label:"--- [user]"}:e)));let a=s._get("menuItems")||[],l=o._get("showBorder"),d=o._get("locked"),h=[{value:l?"HideBorder":"ShowBorder",label:l?"Hide border":"Show border",asset:l?"outline-hide0":"outline-show0"},{value:d?"UnlockFrame":"LockFrame",label:d?"Unlock frame":"Lock frame",asset:d?"unlock":"lock"}],c=[{value:null,label:"FRAME",asset:null},{value:"Delete",label:"Delete",asset:"trash-can"},{value:"Copy",label:"Copy",asset:"new"},...n,{value:"BringToFront",label:"Bring to front",asset:"bring-front"},{value:"SendToBack",label:"Send to back",asset:"send-back"},...h,{value:"FullScreen",label:"Full screen",asset:"fullscreen"},...a],u=n.concat(a);this.customItems=u.length?u:null,this.menuTarget=s,this.miniBrowserView=r,window.location.search.indexOf("scripting=true")>=0&&c.push({label:"Scripting"});let m=this.model.getLibrary("widgets.DOMMenu"),g=document.createElement("div");return(new m).makeMenu(g,e?"frame-menu-grayed-out":"frame-menu",c,this,this.menuSelected),g.onDismiss=()=>this.menuWasDismissed(),g}menuWasDismissed(){let e=this.getView();e&&(e.menuIsActive=!1,e.call("FrameView","pointerLeave")),this.dom.setAttribute("active","false"),this.publish(this.model.id,"removeMenuFor",this.viewId)}menuSelected(e){let t=e.currentTarget.value;window.topView.querySelector("#cover").call("CoverView","menuUp");let i=this.getTarget();if(i){if(this.customItems){let e=this.customItems.find((e=>e.value===t));if(e)return void this.call(e.traits||"FrameMenuView",e.method,this.menuTarget,this.miniBrowserView)}"Delete"===t&&this.trashObject(i),"Copy"===t&&this.copyObject(i),"ShowBorder"===t&&this.setFrameBorder(i,!0),"HideBorder"===t&&this.setFrameBorder(i,!1),"BringToFront"===t&&this.bringToFront(i),"SendToBack"===t&&this.sendToBack(i),"LockFrame"===t&&this.setLockFrame(i,!0),"UnlockFrame"===t&&this.setLockFrame(i,!1),"FullScreen"===t&&this.beFullScreen(),"Scripting"===t&&this.startScripting(i)}}setFrameBorder(e,t){let i=e.asElementRef();this.publish(this.sessionId,"setFrameBorder",{target:i,viewId:this.viewId,flag:t})}setLockFrame(e,t){let i=e.asElementRef();this.publish(this.sessionId,"setLockFrame",{target:i,viewId:this.viewId,flag:t})}trashObject(e){let t=e.asElementRef();this.publish(this.sessionId,"trashObject",{target:t,viewId:this.viewId})}copyObject(e){let t=e.asElementRef();this.publish(this.sessionId,"copyObject",{target:t,viewId:this.viewId})}bringToFront(e){let t=e.asElementRef();this.publish(this.sessionId,"bringToFront",{target:t,viewId:this.viewId})}sendToBack(e){let t=e.asElementRef();this.publish(this.sessionId,"sendToBack",{target:t,viewId:this.viewId})}beFullScreen(){let e=window.topView.querySelector("#pad"),t=window.topView.querySelector("#scaler"),i=this.getView(),s=this.getMenuTarget();if(!s)return;let o=e.call("TransformView","getVisibleScalerRect");this.publish(t.model.sessionId,"moveAndResizeObject",{width:o.width,height:o.height,x:o.x,y:o.y-28,frameInfo:i.model.asElementRef(),target:s})}copyURL(e){let t=e.call("MiniBrowser","getURL");t&&navigator.clipboard&&navigator.clipboard.writeText(t).then((e=>console.log(e)),(e=>console.log("error",e)))}openTab(e){let t=e.call("MiniBrowser","getURL");t&&window.open(t,"_blank")}beTransparent(e){this.publish(e.id,"beTransparent",!0)}beOpaque(e){this.publish(e.id,"beTransparent",!1)}addFavorite(e,t){let i=e.call("MiniBrowserView","getLoadedURL");if(!i)return;let s={appInfo:e.call("MiniBrowserView","getAppInfo"),url:i};"session"===t?s.sessionFave=!0:"user"===t&&(s.userFave=!0);let o=window.topView.querySelector("#scaler"),r=this.getView().dom.getBoundingClientRect(),n={x:r.right,y:r.top};o.call("PasteUpView","nameAndSetFavorite",n,t,s)}removeFavorite(e,t){let i=e.call("MiniBrowserView","getLoadedURL");if(!i)return;let s={appName:e.call("MiniBrowserView","getAppInfo").appName,url:i};"session"===t?s.sessionFave=!1:"user"===t&&(s.userFave=!1),window.topView.querySelector("#scaler").call("PasteUpView","setFavorite",s)}addUserFavorite(e,t){this.addFavorite(t,"user")}removeUserFavorite(e,t){this.removeFavorite(t,"user")}addSessionFavorite(e,t){this.addFavorite(t,"session")}removeSessionFavorite(e,t){this.removeFavorite(t,"session")}startScripting(e){let t=window.topView.querySelector("#scaler"),i=this.getMenuTarget();i&&this.publish(t.model.id,"startScripting",{frameInfo:e.asElementRef(),objectInfo:i})}},FrameLockModel:class FrameLockModel{init(){this.innerHTML='<svg id="icon" viewBox="0 0 24 24"><use href="#img-frame-lock"></use></svg>'}},FrameLockView:class FrameLockView{init(){let e=this.getModel();e&&(this.addEventListener("click","click"),this.subscribe(e.id,"frameStateChanged","frameStateChanged"),this.frameStateChanged())}getModel(){return this.parentNode&&this.parentNode.parentNode?this.parentNode.parentNode.model:null}click(){let e=this.getModel();if(!e)return;let t=e.asElementRef();this.publish(this.sessionId,"setLockFrame",{target:t,viewId:this.viewId,flag:!1})}frameStateChanged(){let e=this.getModel();if(!e)return;let t=e._get("locked");this.dom.setAttribute("locked",""+t)}},FrameTrashModel:class FrameTrashModel{init(){this.innerHTML='<svg id="icon" viewBox="0 0 32 28"><use href="#img-close"></use></svg>'}},FrameTrashView:class FrameTrashView{init(){if(!this.getModel())return;this.addEventListener("click","click"),this.subscribe(this.sessionId,"followingChanged","followingChanged"),this.pad=window.topView.querySelector("#pad");let e=this.pad.model._get("presentingViewId");this.followingChanged(e)}getModel(){return this.parentNode&&this.parentNode.parentNode?this.parentNode.parentNode.model:null}click(){let e=this.getModel();if(!e)return;let t=this.pad.model._get("presentingViewId");if(t&&t!==this.viewId)return;let i=e.asElementRef();this.publish(this.sessionId,"trashObject",{target:i,viewId:this.viewId})}followingChanged(){let e=this.pad.model._get("presentingViewId"),t=e&&e!==this.viewId;this.dom.setAttribute("disabled",t)}},FrameAddressEditModel:class FrameAddressEditModel{init(){this.innerHTML='<svg id="icon" viewBox="0 0 24 28"><use href="#img-edit"></use></svg>',void 0===this._get("open")&&this._set("open",!1),this.subscribe(this.id,"setEditState","setEditState")}setEditState(e){this._set("open")!==e&&(this._set("open",e),this.publish(this.id,"editStateChanged"))}},FrameAddressEditView:class FrameAddressEditView{init(){if(!this.getModel())return;this.addEventListener("click","click");let e=this.getView().querySelector("#externalAddress");this.subscribe(e.model.id,"setEditState","setEditState"),this.subscribe(e.model.id,"setButtonVisibility","setButtonVisibility"),this.subscribe(e.model.id,"text","addressAccepted"),this.subscribe(this.model.id,"editStateChanged","editStateChanged"),this.editStateChanged()}getView(){return this.parentNode&&this.parentNode.parentNode}getModel(){let e=this.getView();return e&&e.model}click(){if(!this.getModel())return;let e=this.getView().dom.classList.contains("editingAddress");this.publish(this.model.id,"setEditState",!e)}editStateChanged(){let e=this.model._get("open");this.setEditState(e)}setEditState(e){let t=this.getView();t&&(e?t.dom.classList.add("editingAddress"):t.dom.classList.remove("editingAddress"))}addressAccepted({text:e}){e.trim()&&(this.setEditState(!1),this.publish(this.model.id,"setEditState",!1))}setButtonVisibility(e){let t=this.getView().querySelector("#addressEdit");t&&t.dom.style.setProperty("display",e?"":"none")}},RadarModel:class RadarModel{init(){void 0===this._get("showRadar")&&this._set("showRadar",!1)}setShowRadar(e){this._set("showRadar",e),this.publish(this.id,"showRadarChanged")}},RadarView:class RadarView{init(){this.pad=window.topView.querySelector("#pad"),this.scaler=this.pad.querySelector("#scaler"),this.scalerWidth=parseInt(this.scaler.dom.style.getPropertyValue("width"),10),this.scalerHeight=parseInt(this.scaler.dom.style.getPropertyValue("height"),10),this.addEventListener("pointerdown","pointerDown"),this.addEventListener("wheel","wheel"),this.hide(!1),this.showRadarChanged(!0),console.log("RadarView.init")}showRadarChanged(e=!1){if(!e){let e=this.pad.call("TransformView","getPresenter");if(!e||e===this.viewId||this.pad.following!==e)return}let t="on"===this.dom.getAttribute("extended"),i=this.model._get("showRadar");i!==t&&(i?this.show(!1):this.hide(!1))}radarUpdate(){"on"===this.dom.getAttribute("extended")&&this.future(50).call("RadarView","radarUpdate"),this.render()}show(e){this.dom.setAttribute("extended","on"),this.radarUpdate(),e&&this.publish(this.model.id,"setShowRadar",!0)}hide(e){this.dom.setAttribute("extended","off"),e&&this.publish(this.model.id,"setShowRadar",!1)}toggle(){"on"===this.dom.getAttribute("extended")?this.hide(false):this.show(false)}presentationStarted(){}followingChanged(e){e&&this.showRadarChanged()}pointerDown(e){if(1!==e.buttons)return;if(e.preventDefault(),e.stopPropagation(),!this.viewport)return;let t=this.scaler.currentZoom,i=e.offsetX/this.viewport.scale+this.viewport.offsetX,s=e.offsetY/this.viewport.scale+this.viewport.offsetY;i-=this.viewport.width/2,s-=this.viewport.height/2,i*=t,s*=t,this.pad.call("TransformView","jumpViewport",{x:i,y:s})}wheel(e){e.preventDefault(),e.stopPropagation(),this.pad.call("TransformView","wheel",e)}ensureCanvas(){let e=this.dom.querySelector("#canvas");return e||(e=document.createElement("canvas"),e.id="canvas",e.width=200,e.height=200,e.classList.add("radar-canvas"),this.dom.appendChild(e)),e}computeView(e,t,i,s){t||(t=this.pad),s||(s=this.scaler),i||(i=this.ensureCanvas());let o,r,n=Number.MAX_VALUE,a=Number.MAX_VALUE,l=Number.MIN_VALUE,d=Number.MIN_VALUE,h=t.model._get("clientViewRecords"),c=s.dom.childNodes;if(e){if(o=h[this.viewId],!o||!o.lastViewport)return null;{let e=o.lastViewport;r=e,n=Math.min(n,e.x),a=Math.min(a,e.y),l=Math.max(l,e.x+e.width),d=Math.max(d,e.y+e.height)}}c.forEach((e=>{if(!e.key)return;let t=window.views[e.key].call("FrameView","getRect");t&&(n=Math.min(n,t.x),a=Math.min(a,t.y),l=Math.max(l,t.x+t.width),d=Math.max(d,t.y+t.height))}));let u,m,g=l-n,w=d-a,f=Math.max(g,w),v=Math.max(1.2,Math.min(2,this.scalerWidth/f)),y=i.width/(Math.max(g,w)*v);return g>w?(u=(l+n)/v-(l-n),m=(d+a)/v-(d-a+(g-w))):(u=(l+n)/v-(l-n+(w-g)),m=(d+a)/v-(d-a)),{scale:y,offsetX:u,offsetY:m,lastViewport:r,centerX:(l+n)/2,centerY:(d+a)/2}}render(e){if(!e&&"off"===this.dom.getAttribute("extended"))return;let t=this.pad,i=this.scaler,s=i.dom.childNodes,o=this.ensureCanvas(),r=o.getContext("2d");r.lineWidth=1;let n=this.computeView(!0,t,{width:o.width},i);if(!n)return;this.viewport=n;let{lastViewport:a,scale:l,offsetX:d,offsetY:h}=n;r.clearRect(0,0,o.width,o.height),r.fillStyle="#C0C0C0C0",r.fillRect(0,0,o.width,o.height),r.fillStyle="#FFFFFFC0";let c=[(a.x-d)*l,(a.y-h)*l,a.width*l,a.height*l];r.clearRect(...c),r.fillRect(...c),c=[(0-d)*l,(0-h)*l,this.scalerWidth*l,this.scalerHeight*l],r.strokeStyle="#4D4D4D",r.strokeRect(...c),r.lineWidth=1,r.strokeStyle=this.randomColor(this.viewId,.8),c=[(a.x-d)*l,(a.y-h)*l,a.width*l,a.height*l],r.strokeRect(...c),r.fillStyle="#78acad40",r.strokeStyle="#78acad",r.lineWidth=1,s.forEach((e=>{if(!e.key)return;let t=window.views[e.key].call("FrameView","getRect");t&&(c=[(t.x-d)*l,(t.y-h)*l,t.width*l,t.height*l],r.fillRect(...c),r.strokeRect(...c),c[3]=1,r.strokeRect(...c))}))}randomColor(e,t){return`hsla(${Math.floor(parseInt(e,36)/36**10*360)}, 40%, 40%, ${t})`}},RadarButtonView:class RadarButtonView{init(){this.addEventListener("click","click"),console.log("RadarButtonView.init"),this.radarView=window.topView.querySelector("#radar")}click(){this.radarView.call("RadarView","toggle")}},VersionStringView:class VersionStringView{init(){}version(e){this.dom.textContent=e,this.dom.style.setProperty("font-family","Poppins-Medium"),this.dom.style.setProperty("font-size","10px"),this.dom.style.setProperty("margin-left","auto"),this.dom.style.setProperty("margin-right","20px")}getVersion(){fetch("./meta/version.txt",{method:"GET",mode:"cors",headers:{"Content-Type":"text"}}).then((e=>e.ok?e.text():"")).then((e=>{e?this.version(e):console.log("version file not found")})).catch((e=>{console.error(e.message,e)}))}},VSeparatorModel:class VSeparatorModel{init(){this.innerHTML='<div id="vSeparator-feedback"></div>'}},VSeparatorView:class VSeparatorView{init(){this.addEventListener("pointerdown","pointerDown"),this.addEventListener("pointerenter","show"),this.addEventListener("pointerleave","hide"),this.feedback=this.dom.querySelector("#vSeparator-feedback"),window.fromLandingPage&&"videoOnly"!==window.fromLandingPage.chat&&"textOnly"!==window.fromLandingPage.chat&&"off"!==window.fromLandingPage.chat||this.dom.style.setProperty("display","none"),this.separatorHeight=4,this.hide(),console.log("VSeparatorView.init")}show(e){this.feedback.setAttribute("hovered","true")}hide(e){this.feedback.setAttribute("hovered","false")}pointerDown(e){if(1!==e.buttons)return;let t=this.dom.previousElementSibling;if(!t)return;if(!this.dom.nextElementSibling)return;this.setPointerCapture(e.pointerId),this.scaler||(this.scaler=window.topView.querySelector("#scaler")),this.downPoint={x:e.clientX,y:e.clientY};let i=t.style.getPropertyValue("height");"auto"===i||i.endsWith("%")?(i=t.getBoundingClientRect().height,t.style.setProperty("height",i+"px")):i=parseFloat(i),this.oldHeight=i,this.addEventListener("pointermove","pointerMove"),this.addEventListener("pointerup","pointerUp"),this.addEventListener("pointercancel","pointerUp"),this.addEventListener("lostpointercapture","pointerUp")}pointerMove(e){if(e.preventDefault(),e.stopPropagation(),this.downPoint){let t=this.cookEvent(e),i=this.dom.previousElementSibling,s=t.clientY-this.downPoint.y,o=this.oldHeight+s,r=this.dom.parentNode.clientHeight;o=Math.max(o,this.separatorHeight+200),o=Math.min(o,r-200),i.style.setProperty("height",o+"px");let n=i.querySelector("#videoChatFrame");n&&n.style.setProperty("height",o+"px")}}pointerUp(){this.releaseAllPointerCapture(),this.downPoint=null,this.removeEventListener("pointermove","pointerMove"),this.removeEventListener("pointerup","pointerUp"),this.removeEventListener("pointercancel","pointerUp"),this.removeEventListener("lostpointercapture","pointerUp")}},SeparatorModel:class SeparatorModel{init(){this.innerHTML='<div id="separator-feedback"></div>'}},SeparatorView:class SeparatorView{init(){this.addEventListener("pointerdown","pointerDown"),this.addEventListener("pointerenter","show"),this.addEventListener("pointerleave","hide"),this.feedback=this.dom.querySelector("#separator-feedback"),this.separatorWidth=4,this.hide(),console.log("SeparatorView.init")}show(e){this.feedback.setAttribute("hovered","true")}hide(e){this.feedback.setAttribute("hovered","false")}pointerDown(e){if(1!==e.buttons)return;let t=this.parentNode;if(!t)return;this.setPointerCapture(e.pointerId),this.scaler||(this.scaler=window.topView.querySelector("#scaler")),t=t.dom,this.downPoint={x:e.clientX,y:e.clientY};let i=t.style.getPropertyValue("width");"auto"===i?(i=t.getBoundingClientRect().width,t.style.setProperty("width","100px")):i=parseFloat(i),this.oldWidth=i,this.addEventListener("pointermove","pointerMove"),this.addEventListener("pointerup","pointerUp"),this.addEventListener("pointercancel","pointerUp"),this.addEventListener("lostpointercapture","pointerUp")}pointerMove(e){if(e.preventDefault(),e.stopPropagation(),this.downPoint){let t=this.cookEvent(e),i=this.parentNode;if(!i)return;i=i.dom;let s=t.clientX-this.downPoint.x,o=this.oldWidth-s;o=Math.max(o,this.separatorWidth);let r=window.topView.dom.querySelector("#pad").getBoundingClientRect().width-100;o=Math.min(o,r),i.style.setProperty("width",o+"px"),window.topView.throttledInvoke("publishSeparatorMove",3*this.scaler.throttleBaseMS,(()=>{let e=window.topView.querySelector("#pad");e.call("TransformView","adjustToFollowedViewport"),e.call("TransformView","publishViewport"),e.call("TransformView","adjustHeaderPosition")}))}}pointerUp(){this.releaseAllPointerCapture(),this.downPoint=null,this.removeEventListener("pointermove","pointerMove"),this.removeEventListener("pointerup","pointerUp"),this.removeEventListener("pointercancel","pointerUp"),this.removeEventListener("lostpointercapture","pointerUp")}},ScaleReadOutModel:class ScaleReadOutModel{init(){if(!this.querySelector("#readout")){let e=this.createElement();e.domId="readout",e.innerHTML="100%",this.appendChild(e)}}},ScaleReadOutView:class ScaleReadOutView{init(){this.readout=this.querySelector("#readout"),this.addEventListener("click","setScale")}showScale(e){this.readout.dom.innerHTML=(100*e).toFixed(0)+"%"}setScale(){let e=window.topView.querySelector("#pad");e&&e.call("TransformView","zoomAboutPoint",1)}},PresentationButtonModel:class PresentationButtonModel{init(){if(!this.querySelector("#button")){let e=this.createElement();e.domId="button",this.innerHTML='\n                <svg viewBox="0 0 24 24" class="unhovered">\n                   <use href="#img-roomnavigation-presenation2"></use></svg>',this.appendChild(e)}}},PresentationButtonView:class PresentationButtonView{init(){this.showingMenu=!1,this.addEventListener("click","click"),this.dom.title="Presentation"}click(){this.showingMenu?this.removeMenu():this.startMenu()}startMenu(){let e=window.topView.querySelector("#cover");if(!e)return;this.showingMenu=!0;let t=this.makeMenu();e.call("CoverView","addMenu",{menu:t,placeElement:this,position:"present"})}removeMenu(){if(!this.showingMenu)return;let e=window.topView.querySelector("#cover");e&&e.call("CoverView","menuUp")}makeMenu(){let e=[{value:null,label:"PRESENTATION",asset:null}],t=window.topView.querySelector("#pad"),i=t.viewId,s=t.call("TransformView","getPresenter");s?s===i?e.push({value:"stopPresenting",label:"Stop Presenting"}):t.following?(e.push({value:"leavePresentation",label:"Leave Presentation"}),e.push({value:"forceStopPresentation",label:"Force Stop Presentation"})):e.push({value:"joinPresentation",label:"Join Presentation"}):e.push({value:"startPresenting",label:"Start Presenting"}),"string"==typeof window.backdropURL&&e.push({value:"setBackground",label:"Set desktop background"});let o=t.model.getLibrary("widgets.DOMMenu"),r=document.createElement("div");return r.className="presentMenu",(new o).makeMenu(r,"presentation-menu",e,this,this.menuSelected),r.onDismiss=()=>this.showingMenu=!1,r}menuSelected(e){let t=e.currentTarget.value;this.removeMenu();let i=window.topView.querySelector("#pad"),s=i.viewId;if("startPresenting"===t)console.log(`request to start presentation as ${s}`),this.publish(i.model.id,"startPresentation",s);else if("stopPresenting"===t)console.log(`request to stop presentation as ${s}`),this.publish(i.model.id,"stopPresentation",s);else if("forceStopPresentation"===t)console.log(`request to force stop presentation as ${s}`),this.publish(i.model.id,"forceStopPresentation",s);else if("leavePresentation"===t)i.call("TransformView","leavePresentation",!0);else if("joinPresentation"===t)i.call("TransformView","joinPresentation",!0);else if("openWorkspace"===t){let e=window.topView.querySelector("#scaler").currentTranslation;this.publish(this.sessionId,"openWorkspace",e)}else"setBackground"===t&&this.publish(this.sessionId,"setBackground",{url:window.backdropURL,type:"iframe"})}},AnnotationButtonModel:class AnnotationButtonModel{init(){this._set("defaultColor","#A6A8A9"),this.style.setProperty("fill",this._get("defaultColor"))}svg(){return(new(this.getLibrary("boards.MarkerPenIcon"))).marker()}},AnnotationButtonView:class AnnotationButtonView{init(){this.active=!1}setActive(e,t){e!==this.active&&(this.active=e,this.dom.style.setProperty("fill",e?t:this.model._get("defaultColor")))}},RoomNameModel:class RoomNameModel{init(){this.classList.add("room-name-readout"),this.innerHTML="(Unknown)"}},RoomNameView:class RoomNameView{setName(e){this.dom.textContent=e}},RoomParticipantsModel:class RoomParticipantsModel{init(){if(!this._get("init")){this._set("init",!0),this.classList.add("room-participants-holder");let e=this.createElement();e.classList.add("room-participants-icon"),e.innerHTML='<svg viewBox="0 0 24 24" class="icon-svg"><use href="#img-numberofoccupants"></use></svg>';let t=this.createElement();t.classList.add("room-participants-number"),t.domId="participants-number",t.innerHTML="0";let i=this.createElement("div");i.classList.add("room-participants-tooltip"),i.domId="participants-tooltip";let s=this.createElement("div");s.classList.add("room-participants-tooltip-arrow");let o=this.createElement("div");o.classList.add("room-participants-tooltip-contents"),o.domId="participants-contents",i.appendChild(s),i.appendChild(o),this.appendChild(t),this.appendChild(e),this.appendChild(i)}}},RoomParticipantsView:class RoomParticipantsView{init(){this.tooltip=this.querySelector("#participants-tooltip"),this.count=this.querySelector("#participants-number"),this.contents=this.querySelector("#participants-contents")}setScaler(e){this.scaler=e,this.subscribe(this.scaler.model.id,"userInfoChanged","updateCount")}setCount(e){this.count.dom.innerHTML=`${e}`,this.dom.setAttribute("number",`${e}`),e>0?this.tooltip.dom.style.removeProperty("visibility"):this.tooltip.dom.style.setProperty("visibility","none")}setNames(e){this.contents.dom.innerHTML=e.join("<br>")}updateCount(){let e=this.scaler&&this.scaler.model._get("userInfo")||{},t=Object.keys(e),i=t.length,s=t.map((t=>e[t].nickname));this.setCount(i),this.setNames(s)}}};const t={expanders:[class DrawModel{init(){this.subscribe(this.sessionId,"view-exit","viewExit"),this.subscribe(this.id,"addLine","addLine"),this._get("layers")||this._set("layers",[[]]),this._get("layerMap")||this._set("layerMap",{}),void 0===this._get("runCleaner")&&this._set("runCleaner",!1),this._set("delay",3e3),console.log("DrawModel.init")}viewExit(e){let t=this._get("layerMap");t&&delete t[e]}addLine(e){let t,{viewId:i,x0:s,y0:o,x1:r,y1:n,color:a,under:l,isNew:d}=e,h=this._get("layerMap"),c=this._get("layers"),u=this.now();d&&l?(t=0,h[i]=t,c.unshift([])):(t=c.length-1,h[i]=t,c[t]||(c[t]=[]));let m={viewId:i,time:u,x0:s,y0:o,x1:r,y1:n,color:a,under:l};c[t].push(m),this.publish(this.id,"drawLine",m),this._get("runCleaner")||(this._set("runCleaner",!0),this.runClear())}clear(){let e=this.now()-(this._get("delay")||3e3),t=this._get("layers"),i=!1;t.forEach((t=>{let s=0;for(let i=0;i<=t.length;i++){let o=t[i];if(i===t.length){s=i;break}if(!(o.time<e)){s=i;break}}s>0&&(t.splice(0,s),i=!0)})),i&&(()=>{for(let e in t)if(t[e].length>0)return!1;return!0})()&&(this._set("layers",[[]]),this._set("runCleaner",!1),this.publish(this.id,"cleanUpDone"))}runClear(){this.clear(),this._get("runCleaner")&&this.future(500).call("DrawModel","runClear")}loadPersistentData(e){this._set("layers",e)}savePersistentData(){this.wellKnownModel("modelRoot").persistSession((()=>this._get("layers")))}},class DrawView{init(){this.subscribe(this.model.id,"drawLine","handleDrawLine"),this.subscribe(this.model.id,"drawAll","drawAll"),this.subscribe(this.model.id,"cleanUpDone","cleanUpDone"),this.subscribe(this.sessionId,"annotationCleanAndDraw","cleanAndDraw"),this.subscribe(this.sessionId,"annotationResizeAndDraw","resizeAndDraw"),this.ensureScaler(),this.ensurePad(),this.localDiff=Date.now()-this.now(),this.setupCanvas(),window.topView.detachCallbacks.push((()=>{this.stopCleaner()})),this.ensureCleanEventHandlers(),this.setup(),console.log("DrawView.init")}ensureScaler(){return this.scaler||(this.scaler=window.topView.querySelector("#scaler")),this.scaler}ensurePad(){return this.pad||(this.pad=window.topView.querySelector("#pad")),this.pad}getUserColor(){if(this.userColor)return this.userColor;if(this.scaler){let e=this.scaler.model[this.viewId];this.userColor=e&&e.userColor||"#00FF00"}return this.userColor}localActivate(e){this.userColor=e,this.dom.style.removeProperty("pointer-events"),this.addEventListener("pointerdown","pointerDown"),this.pointerMoveReporter=e=>this.reportPointerMove(e),this.dom.addEventListener("pointermove",this.pointerMoveReporter)}localDeactivate(){this.ensureCleanEventHandlers()}ensureCleanEventHandlers(){this.dom.style.setProperty("pointer-events","none"),this.removeEventListener("pointerdown","pointerDown"),this.removeEventListener("pointerup","pointerUp"),this.removeEventListener("pointerleave","pointerUp"),this.removeEventListener("lostpointercapture","pointerUp"),this.removeEventListener("pointermove","pointerMove"),this.pointerMoveReporter&&(this.dom.removeEventListener("pointermove",this.pointerMoveReporter),this.pointerMoveReporter=null)}setup(){if(this.pad){let e=this.pad.dom.getBoundingClientRect(),t=e.width,i=e.height;this.resize(t,i)}this.startCleaner(),this.drawAll()}resize(e,t){this.dom.getAttribute("width")===`${e}`&&this.dom.getAttribute("height")===`${t}`||(this.dom.setAttribute("width",e),this.dom.setAttribute("height",t))}resizeAndDraw(e,t){e&&t&&this.resize(e,t),this.startCleaner(),this.drawAll()}cleanUpDone(){console.log("cleanup done"),this.clear(),this.stopCleaner()}setupCanvas(){if(this.canvas)return;let e=this.model._get("canvasId");if(e){if(this.dom.id===e)return void(this.canvas=this.dom);if(this.canvas=this.dom.querySelector(`#${e}`),this.canvas)return}this.canvas=document.createElement("canvas"),this.dom.appendChild(this.canvas)}startCleaner(){if(this.cleaner)return;(()=>{let e=this.model._get("layers");if(!e)return!0;for(let t in e)if(e[t].length>0)return!1;return!0})()||(this.cleaner=setInterval((()=>this.cleanAndDraw()),33))}stopCleaner(){this.cleaner&&(clearInterval(this.cleaner),this.cleaner=null)}cleanAndDraw(){let e=Date.now()-this.localDiff-(this.model._get("delay")||3e3);this.drawAll(e)}clear(){let e=this.canvas;e.getContext("2d").clearRect(0,0,e.width,e.height)}drawAll(e){if(!this.canvas)return;let t=this.model._get("layers");t&&(this.clear(),this.drawLayers(t,e))}drawLayers(e,t){e.forEach((e=>{e.forEach((e=>{this.drawLine(e,t)}))}))}handleDrawLine(e){this.startCleaner(),this.localDiff=Date.now()-this.now(),this.drawLine(e)}drawLine(e,t){let{x0:i,y0:s,x1:o,y1:r,color:n,under:a,time:l}=e;if(void 0!==t&&l<t)return;let d=this.invertPoint(i,s),h=this.invertPoint(o,r),c=this.canvas.getContext("2d");c.globalCompositionOperation=a?"source-out":"source-over",c.lineWidth=8,c.lineCap="round",c.strokeStyle=n,c.beginPath(),c.moveTo(d.x,d.y),c.lineTo(h.x,h.y),c.stroke()}pointerDown(e){if(1!==e.buttons)return;this.setPointerCapture(e.pointerId);let t=e.offsetX,i=e.offsetY,s=this.transformPoint(t,i);this.lastPoint=s,this.addEventListener("pointermove","pointerMove"),this.addEventListener("pointerup","pointerUp"),this.addEventListener("pointerleave","pointerUp"),this.addEventListener("lostpointercapture","pointerUp")}pointerMove(e){if(1===e.buttons&&this.lastPoint){let t=this.lastPoint.x,i=this.lastPoint.y,s=this.transformPoint(e.offsetX,e.offsetY),o=this.getUserColor();this.lastPoint=s,this.publish(this.model.id,"addLine",{viewId:this.viewId,x0:t,y0:i,x1:s.x,y1:s.y,color:o})}}pointerUp(e){this.lastPoint=null,this.releaseAllPointerCapture(),this.localDeactivate(),this.pad&&this.pad.call("TransformView","annotationDone")}transformPoint(e,t){if(this.scaler){let i=this.scaler.currentZoom,s=this.scaler.currentTranslation;return{x:(e+s.x)/i,y:(t+s.y)/i}}return{x:e,y:t}}invertPoint(e,t){if(this.scaler){let i=this.scaler.currentZoom,s=this.scaler.currentTranslation;return i&&s?{x:e*i-s.x,y:t*i-s.y}:[e,t]}return{x:e,y:t}}reportPointerMove(e){this.scaler&&this.scaler.call("PasteUpView","pointerMove",e,!0)}}],classes:[class MarkerPenIcon{marker(){return'\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25px" height="25px"\n         viewBox="0 0 25 25">\n<g id="Layer_2">\n        <g>\n                <path d="M17.95,2.7c1.31,1.3,2.62,2.6,3.92,3.9c0.36,0.36,0.32,0.6-0.13,1.04c-2.46,2.46-4.92,4.92-7.38,7.37\n                        c-0.51,0.51-1.03,1-1.51,1.53c-0.33,0.36-0.71,0.53-1.18,0.62c-1.35,0.25-2.69,0.53-4.03,0.8c-0.62,0.12-0.91-0.14-0.79-0.77\n                        c0.28-1.46,0.56-2.93,0.87-4.39c0.05-0.22,0.18-0.46,0.34-0.62c3.04-3.06,6.1-6.11,9.15-9.16c0.12-0.12,0.25-0.22,0.38-0.32\n                        C17.7,2.7,17.83,2.7,17.95,2.7z M11.49,16.09c-0.92-0.92-1.85-1.85-2.78-2.78c-0.1,0.48-0.15,1.03-0.32,1.54\n                        c-0.21,0.61-0.07,1.05,0.45,1.4c0.15,0.1,0.34,0.28,0.48,0.26C10.07,16.39,10.81,16.23,11.49,16.09z"/>\n                <path d="M19.78,23.31c-0.12-0.13-0.31-0.23-0.37-0.38c-0.73-1.88-2.22-2.73-4.1-3.1c-1.99-0.39-3.81-0.04-5.47,1.13\n                        c-1.08,0.76-2.15,1.56-3.45,1.93c-0.65,0.19-1.31,0.29-1.98,0.13c-1.23-0.28-1.86-1.54-1.33-2.72c0.53-1.18,1.57-1.74,2.74-2.1\n                        c0.14-0.04,0.5,0.18,0.53,0.33c0.04,0.19-0.08,0.51-0.24,0.64c-0.3,0.23-0.69,0.31-1.01,0.52c-0.3,0.19-0.59,0.44-0.84,0.7\n                        c-0.29,0.3-0.41,0.68-0.21,1.09c0.21,0.43,0.57,0.66,1.03,0.61c0.42-0.05,0.86-0.12,1.23-0.31c0.77-0.39,1.54-0.81,2.24-1.3\n                        c1.37-0.95,2.81-1.75,4.5-1.88c2.68-0.2,5.05,0.47,6.73,2.76c0.23,0.31,0.37,0.7,0.55,1.05c0.19,0.36,0.15,0.66-0.2,0.9\n                        C20.02,23.31,19.9,23.31,19.78,23.31z"/>\n        </g>\n</g>\n</svg>'}}],functions:[function beDrawing(e,t,i){let s=e.createElement("CanvasElement");s.domId="draw-canvas",s.style.setProperty("border","1px solid gray");let o=e.createElement();o.setCode("drawing.DrawModel"),o.setViewCode("drawing.DrawView"),o._set("canvasId","draw-canvas"),o.appendChild(s),e.appendChild(o)}]};const i={expanders:[class TransformModel{init(){this.subscribe(this.id,"newIFrame","newIFrame"),this.subscribe(this.id,"newImage","newImage"),this.subscribe(this.id,"newText","newText"),this.subscribe(this.id,"viewport","viewport"),this.subscribe(this.sessionId,"viewPointerMoved","pointerMoved"),this.subscribe(this.id,"startPresentation","startPresentation"),this.subscribe(this.id,"stopPresentation","stopPresentation"),this.subscribe(this.id,"forceStopPresentation","forceStopPresentation"),this.subscribe(this.id,"setFollowing","setFollowing"),this.subscribe(this.sessionId,"view-join","addUser"),this.subscribe(this.sessionId,"view-exit","deleteUser"),this.subscribe(this.sessionId,"localUserJoin","localUserJoin"),this.ensureClientViewRecords(),console.log("TransformModel.init")}ensureClientViewRecords(){this._get("clientViewRecords")||(this._set("clientViewRecords",{}),this._set("presentingViewId",null),this.future(500).call("TransformModel","checkForInactiveClients"))}addUser(e){let t={...this._get("clientViewRecords")};t[e]={},this._set("clientViewRecords",t),console.log("TransformModel.addUser",t),this.publish(this.id,"addUser",e)}deleteUser(e){let t={...this._get("clientViewRecords")};delete t[e],this._set("clientViewRecords",t),console.log("TransformModel.deleteUser",t),this._get("presentingViewId")===e&&(this._set("presentingViewId",null),this.publish(this.sessionId,"presentationStopped")),this.publish(this.id,"deleteUser",e)}localUserJoin(e){this.addUser(e),console.log("localUserJoin",e)}editClientViewRecord(e,t,i){let s=this._get("clientViewRecords"),o=s[e];if(void 0===o)return!1;let r={...s},n={...o};return t&&t(n),i&&!n.active&&(n.active=!0,n.lastActive=this.now(),this.publish(this.sessionId,"userCursorUpdated",e)),r[e]=n,this._set("clientViewRecords",r),!0}checkForInactiveClients(){let e=this._get("clientViewRecords");Object.keys(e).forEach((t=>{let i=e[t],{lastActive:s,active:o}=i;void 0===o?this.editClientViewRecord(t,null,!0):o&&this.now()-s>5e3&&(this.editClientViewRecord(t,(e=>e.active=!1)),this.publish(this.sessionId,"userCursorUpdated",t))})),this.future(500).call("TransformModel","checkForInactiveClients")}pointerMoved(e){let{viewId:t,...i}=e;this.editClientViewRecord(t,(e=>e.lastPointer=i),!0)&&this.publish(this.id,"pointerMoved",e)}viewport(e){let{viewId:t,scalerRect:i}=e;if(!this.editClientViewRecord(t,(e=>e.lastViewport=i),!0))return;let s=this._get("presentingViewId");if(t===s){let e=this._get("clientViewRecords");Object.keys(e).forEach((t=>{if(t!==s){e[t].isFollowing&&this.editClientViewRecord(t,(e=>e.lastViewport={...i}))}}))}this.publish(this.id,"viewportChanged",e)}startPresentation(e){let t=this._get("presentingViewId");if(t)return void console.warn(`${e} can't present while ${t} is presenting`);console.log(`${e} starting presentation`),this._set("presentingViewId",e);let i=this._get("clientViewRecords");Object.keys(i).forEach((t=>{t!==e&&this.setFollowing({viewId:t,isFollowing:!0})})),this.publish(this.sessionId,"presentationStarted"),this.publish(this.sessionId,"allUserCursorsUpdated")}forceStopPresentation(e){this.stopPresentation(e,!0)}stopPresentation(e,t){let i=this._get("presentingViewId");if(!t&&i!==e)return void console.warn(`rejecting ${e} request to stop presenting; presenter is ${i}`);console.log(`${e} stopping presentation`),this._set("presentingViewId",null);let s=this._get("clientViewRecords");Object.keys(s).forEach((t=>{t!==e&&this.setFollowing({viewId:t,isFollowing:!1})})),this.publish(this.sessionId,"presentationStopped"),this.publish(this.sessionId,"allUserCursorsUpdated")}setFollowing(e){let{viewId:t,isFollowing:i}=e,s=this._get("presentingViewId");if(s||(i=!1),i){let e=this._get("clientViewRecords")[s].lastViewport;this.editClientViewRecord(t,(t=>{t.isFollowing=!0,t.lastViewport={...e}}))}else this.editClientViewRecord(t,(e=>e.isFollowing=!1))}addFrame(e){let t=this.querySelector("#scaler");t&&t.call("PasteUpModel","addFrame",e)}newImage(e){let{handle:t,type:i,width:s,height:o,displayPoint:r}=e,n=this.createElement();n.style.setProperty("-cards-direct-manipulation",!0),n.style.setProperty("width",`${s}px`),n.style.setProperty("height",`${o}px`),n.style.setProperty("-cards-background-image-asset",{handle:t,type:i}),n.style.setProperty("background-size","contain"),n.style.setProperty("background-repeat","no-repeat"),n.style.setProperty("background-position","center");let a=r.x,l=r.y;n.setTransform([1,0,0,1,0,0]);let d=this.createElement();d.setCode("boards.FrameModel"),d.setViewCode("boards.FrameView"),d.call("FrameModel","setObject",n,{x:a,y:l}),d.call("FrameModel","beSolidBackground"),this.addFrame(d)}newText(e){let{x:t,y:i,width:s,height:o}=e,r=this.createElement();r.domId="stickyNote",r.classList.add("sticky-note-text"),r.setCode("text.TextModel");let n=this.createElement();n.setCode("boards.FrameModel"),n.setViewCode("boards.FrameView");let a=n.call("FrameModel","getTitleHeight");r.call("TextModel","setup",s,o-a),n.call("FrameModel","setObject",r,{x:t,y:i}),this.addFrame(n)}newIFrame(e){let{x:t,y:i,width:s,height:o,viewId:r,type:n,appInfo:a}=e,l=this.createElement();l.domId="miniBrowser",l._set("useExternalAddress",!0),l.setCode("minibrowser.MiniBrowser"),l.setViewCode("minibrowser.MiniBrowserView"),l.style.setProperty("-cards-direct-manipulation",!0),l.setTransform([1,0,0,1,0,0]);let d=this.createElement();d.setCode("boards.FrameModel"),d.setViewCode("boards.FrameView"),d._set("hasAddressBar",!0);let h=d.call("FrameModel","getTitleHeight");d.call("FrameModel","setObject",l,{x:t,y:i}),l.call("MiniBrowser","setExtent",s,o-h),e.url?l.call("MiniBrowser","url",e.url,!0):l.call("MiniBrowser","setCoverContent",n),l.call("MiniBrowser","setAppInfo",a);let c=this.querySelector("#scaler"),u=c?c._get("userInfo")[r]:null,m=u?u.userId:r;l.call("MiniBrowser","setCreatingUser",m),this.addFrame(d)}},class TransformView{init(){this.subscribe(this.sessionId,"toolButtonPressed","toolButtonPressed"),this.subscribe(this.sessionId,"followButton","followButtonPressed"),this.subscribe(this.model.id,"addUser","addUser"),this.subscribe(this.model.id,"deleteUser","deleteUser"),this.subscribe(this.sessionId,"presentationStarted","presentationStarted"),this.subscribe(this.sessionId,"presentationStopped","presentationStopped"),this.subscribe(this.model.id,"pointerMoved","pointerMoved"),this.subscribe(this.model.id,"viewportChanged","viewportChanged"),this.subscribe(this.sessionId,"favoritesChanged","favoritesChanged"),this.subscribe(this.sessionId,{event:"userAppsChanged",handling:"immediate"},"TransformView.userAppsChanged"),this.subscribe(this.sessionId,"sessionAppUpdated","sessionAppUpdated"),this.subscribe(this.sessionId,"zoomInButton","zoomInButtonPressed"),this.subscribe(this.sessionId,"zoomOutButton","zoomOutButtonPressed"),this.subscribe(this.sessionId,"recenterButton","homeButtonPressed"),this.subscribe(this.sessionId,"localWindowResized","windowResize"),this.subscribe(this.sessionId,"annotationButton","annotationButtonPressed"),this.subscribe(this.sessionId,"annotationDone","annotationDone"),this.following=null,window.topView.viewportTracker={target:this,trait:"TransformView",getPresenter:"getPresenter",getViewDetails:"getViewDetails"},window.topView.requestInitialization(this,"TransformView","setup"),console.log("TransformView.init")}setup(){let e=this.dom.querySelector("#scaler").key;this.scaler=window.views[e],this.scaler.currentZoom=1,this.scrollToHome(),this.dom.addEventListener("pointerdown",(e=>this.pointerDown(e)),!0),this.dom.addEventListener("dblclick",(e=>this.dblClick(e))),this.dom.addEventListener("wheel",(e=>this.wheel(e))),this.dom.addEventListener("scroll",(e=>this.scroll(e)));let t=this.followCanvas=document.createElement("canvas");t.width=t.height=this.followCanvasWidth=this.followCanvasHeight=1e3,t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.pointerEvents="none",this.dom.parentNode.appendChild(t),this.updateAllPointers(),this.getPresenter()&&this.joinPresentation(!0),this.evCache=[],this.origDiff=-1,this.origZoom=1,this.noDrag=!1,this.hasPendingAppsUpdate=!1,this.resetToolState(),this.setupFontStyle(),window.document.fonts.ready.then((()=>{window.topView.setLastFontLoadedTime(Date.now())})),this.setRoomName(),this.windowResize(!0)}setRoomName(){let e=window.topView.querySelector("#roomName");e&&window.fromLandingPage&&e.call("RoomNameView","setName",window.fromLandingPage.boardName)}setupFontStyle(){let e=window._production,t=document.createElement("style");t.innerHTML=`\n@font-face {\n  font-family: 'OpenSans-Regular';\n  src: url("${e}/assets/fonts/open-sans-v17-latin-ext_latin-regular.woff2") format('woff2');\n}\n\n@font-face {\n  font-family: 'OpenSans-SemiBold';\n  src: url('${e}/assets/fonts/open-sans-v17-latin-ext_latin-600.woff2') format('woff2');\n}\n\n@font-face {\n    font-family: 'Poppins-Medium';\n    src: url('${e}/assets/fonts/Poppins-Medium.woff2') format('woff2');\n}\n`,document.body.appendChild(t)}dblClick(e){let t=window.topView.querySelector("#radar"),i=this.getVisibleClientRect(),s=t.call("RadarView","computeView",!1,null,{width:i.width},null);s.offsetX>2e4||s.offsetY>2e4?this.scrollToHome():(this.zoom(s.scale),this.setScroll(s.centerX*s.scale-i.width/2,s.centerY*s.scale-i.height/2,!0))}addUser(e){console.log("transformview.addUser"),this.scaler&&this.scaler.call("PasteUpView","handleEnterSoundRequest")}deleteUser(e){this.deletePointer(e),this.scaler&&this.scaler.call("PasteUpView","handleLeaveSoundRequest")}windowResize(e){if(!this.scaler)return;let t=window.topView.querySelector("#tools");t&&t.call("ToolsView","windowResize",e),this.following?this.adjustToFollowedViewport():this.zoomAboutCenter(1);let i=this.parentNode.querySelector("#annotation-canvas");if(i){let e=this.dom.getBoundingClientRect();i.call("DrawView","resizeAndDraw",e.width,e.height)}this.adjustHeaderPosition()}adjustHeaderPosition(){let e=window.topView.querySelector("#header"),t=window.topView.querySelector("#peers");if(e){let i=this.dom.getBoundingClientRect(),s=t.dom.getBoundingClientRect(),o=e.dom.getBoundingClientRect(),r=i.width-s.width,n=(r-o.width)/2;e.dom.style.setProperty("max-width",`${r}px`),n>=0?e.dom.style.setProperty("left",`${n}px`):e.dom.style.setProperty("left","0px");let a=e.querySelector("#participants-tooltip");if(a){let e=a.dom.getBoundingClientRect(),t=(o.width-e.width)/2;a.dom.style.setProperty("left",`${t}`)}}}getVisibleClientRect(){let e,t;{let i=this.dom.getBoundingClientRect();e=i.left,t=i.top}this.infoBarView||(this.infoBarView=window.topView.querySelector("#infoBar"));let i=this.infoBarView.dom.getBoundingClientRect().top;return this.peersView||(this.peersView=window.topView.querySelector("#peers")),{x:e,y:t,width:this.peersView.dom.getBoundingClientRect().left-e,height:i-t}}getVisibleScalerRect(){let e=this.dom.getBoundingClientRect(),t=this.getVisibleClientRect(),i=this.scaler.currentTranslation,s=this.scaler.currentZoom;return{x:(i.x+t.x-e.x)/s,y:(i.y+t.y-e.y)/s,width:t.width/s,height:t.height/s}}jumpViewport(e){let{x:t,y:i}=e;this.setScroll(t,i,!0)}scrollToHome(){let e=this.getPresenter();if(e&&e!==this.viewId&&this.following)return void this.adjustToFollowedViewport(!0);this.zoom(1);let t=this.scaler.dom.getBoundingClientRect(),i=this.dom.getBoundingClientRect(),s=(t.width-i.width)/2,o=(t.height-i.height)/2;this.setScroll(s,o,!0)}homeButtonPressed(){this.scrollToHome()}dashboardButtonPressed(){let e=new URL(window.location.href),t=e.searchParams.get("t"),i=`${e.origin}${e.pathname}?t=${t}`;window.open(i,"_blank")}radarButtonPressed(){window.topView.querySelector("#radar").call("RadarView","toggle")}zoomInButtonPressed(){this.zoomAboutCenter(1.1)}zoomOutButtonPressed(){this.zoomAboutCenter(1/1.1)}zoomAboutCenter(e){this.zoomAboutPoint(this.scaler.currentZoom*e)}zoomAboutPoint(e,t,i){let s=this.scaler.currentTranslation;if(void 0===t&&void 0===i){let e=this.dom.getBoundingClientRect();t=e.width/2,i=e.height/2}let o=this.scaler.currentZoom,r=this.constrainedZoom(e);if(r!==o){this.zoom(r),s={x:(s.x+t)/o*r-t,y:(s.y+i)/o*r-i}}this.setScroll(s.x,s.y,!0)}followButtonPressed(){if(this.followMenu)return this.followMenu.remove(),void(this.followMenu=null);if(this.following)this.unfollow();else{let e=window.topView.querySelector("#followButton"),t=this.model._get("clientViewRecords");if(!t)return;let i=Object.keys(t).filter((e=>e!==this.viewId)),s=this.makeFollowMenu(i);s.addEventListener("input",(e=>this.followerSelected(e))),s.style.setProperty("position","absolute");let o=e.dom.getBoundingClientRect();s.style.setProperty("left",o.x+20+"px"),s.style.setProperty("top",o.y+20+"px"),s.style.setProperty("z-index","10"),this.followMenu=s,e.dom.parentNode.appendChild(s)}}makeFollowMenu(e){let t=document.createElement("select");t.size=""+e.length+1;let i=document.createElement("option");return i.disabled=!0,i.selected=!0,i.innerHTML="Select the user to follow",i.style.setProperty("font-size","20px"),t.appendChild(i),e.forEach((e=>{let i=document.createElement("option");i.innerHTML=this.scaler.call("PasteUpView","getUserInfo",e).nickname||e,i.value=e,i.style.setProperty("font-size","20px"),t.appendChild(i)})),t}followerSelected(e){let t=e.target.value;e.target.remove(),this.followMenu=null,this.follow(t)}getPresenter(){return this.model._get("presentingViewId")}getViewDetails(e){let t=e===this.viewId,i=this.getPresenter(),s=e===i,o=i&&!s&&!(t&&!this.following),r=this.model._get("clientViewRecords");return{isLocal:t,isPresenter:s,isFollower:o,isActive:r[e]&&r[e].active}}presentationStarted(){this.joinPresentation(!1)}joinPresentation(e){let t=this.getPresenter();if(t){if(t===this.viewId){let e=this.scaler.call("PasteUpView","getUserInitials",t);return this.setPresenterString(`PRESENTING AS "${e}"`,"purple"),void document.getElementById("presentationButton").classList.add("app-selected")}console.log(`starting to follow ${t}`),e&&this.publish(this.model.id,"setFollowing",{viewId:this.viewId,isFollowing:!0}),this.follow(t)}else console.warn("no presentation to follow")}presentationStopped(){this.leavePresentation(!1)}leavePresentation(e){let t=this.getPresenter();if(t!==this.viewId){if(t)console.log(`leaving presentation by ${t}`),e&&this.publish(this.model.id,"setFollowing",{viewId:this.viewId,isFollowing:!1});else{document.getElementById("presentationButton").classList.remove("app-selected")}this.unfollow()}else console.warn("cannot leave own presentation")}follow(e){this.following=e,this.adjustToFollowedViewport();let t=this.scaler.call("PasteUpView","getUserInitials",e);this.setPresenterString(`USER "${t}" IS PRESENTING`,"#ef4b3e"),this.requestToolsHidden(!0),this.publish(this.sessionId,"followingChanged",e)}unfollow(){this.following=null;let e=this.followCanvas;e.width=e.width,this.setPresenterString(""),this.requestToolsHidden(!1),this.publish(this.sessionId,"followingChanged",null),this.publishViewport()}setPresenterString(e,t){this.presenterString||(this.presenterString=this.dom.parentNode.parentNode.querySelector("#presenterString")),this.presenterString&&(t&&(this.presenterString.style.color=t),this.presenterString.innerHTML=e)}requestToolsHidden(e){let t=window.topView.querySelector("#toolsTab");t&&t.call("ToolsTabView","requestToolsHidden",e);let i=window.topView.querySelector("#boardTitle");i&&i.call("TitleView","requestToolsHidden",e)}pointerDown(e){if(1===e.buttons&&e.target.key===this.scaler.dom.key){if(e.preventDefault(),e.stopPropagation(),e=this.cookEvent(e),this.evCache.push(e),"pointerdown"===e.type&&e.isPrimary){this.addEventListener("pointermove","pointerMove"),this.addEventListener("pointerup","pointerUp"),this.addEventListener("pointercancel","pointerUp"),this.addEventListener("pointerleave","pointerUp"),this.addEventListener("lostpointercapture","pointerLost"),this.setPointerCapture(e.pointerId);let t=this.scaler.currentTranslation,i=this.scaler.currentZoom,s=this.dom.getBoundingClientRect(),o=(t.x+e.clientX-s.x)/i,r=(t.y+e.clientY-s.y)/i;this.dragPoint={x:o,y:r}}if(2===this.evCache.length){let e=this.evCache[0].clientX-this.evCache[1].clientX,t=this.evCache[0].clientY-this.evCache[1].clientY;this.origDiff=Math.sqrt(e*e+t*t),this.origZoom=this.scaler.currentZoom}}}pointerMove(e){e.preventDefault(),e.stopPropagation(),e=this.cookEvent(e);for(let t=0;t<this.evCache.length;t++)if(e.pointerId===this.evCache[t].pointerId){this.evCache[t]=e;break}if(1!==this.evCache.length){if(2===this.evCache.length){let e=this.evCache[0].clientX-this.evCache[1].clientX,t=this.evCache[0].clientY-this.evCache[1].clientY,i=Math.sqrt(e*e+t*t);if(this.origDiff>0){let s=this.origZoom*(i/this.origDiff),o=e/2+this.evCache[1].clientX,r=t/2+this.evCache[1].clientY;this.zoomAboutPoint(s,o,r)}}}else{if(this.noDrag)return;let t=this.dragPoint,i=this.scaler.currentZoom,s=this.dom.getBoundingClientRect(),o=e.clientX-s.x,r=e.clientY-s.y,n=t.x*i-o,a=t.y*i-r;this.setScroll(n,a,!0)}}pointerUp(e){let t=this.evCache.length;for(let t=0;t<this.evCache.length;t++)if(this.evCache[t].pointerId===e.pointerId){this.evCache.splice(t,1);break}this.evCache.length<2&&(this.origDiff=-1),0===this.evCache.length&&(this.releaseAllPointerCapture(),this.noDrag=!1,this.removeEventListener("pointermove","pointerMove"),this.removeEventListener("pointerup","pointerUp"),this.removeEventListener("pointercancel","pointerUp"),this.removeEventListener("pointerleave","pointerUp"),this.removeEventListener("lostpointercapture","pointerLost")),2===t&&1===this.evCache.length&&(this.noDrag=!0)}pointerLost(e){this.evCache=[],this.pointerUp(e)}wheel(e){e.preventDefault(),e.stopPropagation();const t=Date.now();if(this.lastWheel&&t-this.lastWheel<33)return;this.lastWheel=t;let i=e.deltaY,s=Math.min(30,Math.abs(i));s>10&&(this.lastWheelBurst=t),this.lastWheelBurst&&t-this.lastWheelBurst<2e3||(s=Math.max(10,s));let o=Math.sign(i)*s,r=this.scaler.currentZoom*(1-o/200),n=this.dom.getBoundingClientRect(),a=e.clientX-n.x,l=e.clientY-n.y;this.zoomAboutPoint(r,a,l)}constrainedZoom(e){let t=this.scaler.model._get("boardWidth"),i=this.scaler.model._get("boardHeight"),s=this.dom.getBoundingClientRect(),o=Math.min(e,16);return o=Math.max(o,s.width/t,s.height/i),o}deletePointer(e){window.topView.pluggableDispatch("pointerTracker","deletePointer",e)}pointerMoved(e){window.topView.pluggableDispatch("pointerTracker","pointerMoved",e)}updateAllPointers(){let e=this.model._get("clientViewRecords");Object.keys(e).forEach((t=>{let i=e[t];i.lastPointer&&this.pointerMoved({viewId:t,...i.lastPointer})}))}viewportChanged(e){e.viewId!==this.viewId&&e.viewId===this.following&&this.adjustToFollowedViewport()}adjustToFollowedViewport(e=!1){if(!this.following)return;let t=this.model._get("clientViewRecords");if(!t)return;let i=t[this.following];if(!i)return;let s=i.lastViewport;if(!s)return;let o=this.viewportRestoreSpec,r=this.dom.getBoundingClientRect(),{zoom:n,translation:a}=this.setViewportToRect(s,!1);e||(this.viewportRestoreSpec=o);let l=this.followCanvas;l.width=l.width;let d=l.getContext("2d"),h=this.followCanvasWidth,c=this.followCanvasHeight;d.beginPath(),d.moveTo(0,0),d.rect(0,0,h,c);let u=Math.max(0,(s.x*n-a.x)/r.width*h),m=Math.max(0,(s.y*n-a.y)/r.height*c),g=Math.min(h-u,s.width*n/r.width*h),w=Math.min(c-m,s.height*n/r.height*c);d.moveTo(u,m),d.rect(u,m,g,w),d.fillStyle="black",d.fill("evenodd")}setViewportToRect(e,t=!0){let i=this.dom.getBoundingClientRect(),s=this.getVisibleClientRect(),o=this.scaler.currentZoom,r=Math.min(s.width/e.width,s.height/e.height),n=this.constrainedZoom(r);n!==o&&this.zoom(n);let a=e.x+e.width/2,l=e.y+e.height/2,d=a*n-(s.x+s.width/2-i.x),h=l*n-(s.y+s.height/2-i.y);return{zoom:n,translation:this.setScroll(d,h,t)}}setViewportFromFrame(e,t){let i=this.getVisibleScalerRect();this.setViewportToRect(t),this.viewportRestoreSpec={frameId:e,scalerRect:i}}restoreViewportIfSameFrame(e){let t=this.viewportRestoreSpec;return!(!t||t.frameId!==e)&&(this.setViewportToRect(t.scalerRect),!0)}clearRestoreViewportIfSameFrame(e){let t=this.viewportRestoreSpec;t&&t.frameId===e&&(this.viewportRestoreSpec=null)}urlFromTemplate(e){return(new(this.model.getLibrary("boards.PasteUpSaver3"))).urlFromTemplate(e)}toolButtonPressed(e){let{name:t,url:i,menu:s,appInfo:o,buttonClientRect:r}=e;if(null===t)return void this.resetToolState();let n=window.topView.querySelector("#cover"),a=this.toolState&&this.toolState.selected?this.toolState.name:null;if(!s&&!i&&a===t)return n.call("CoverView","cancelRubberBanding"),void this.setToolState({name:t});let l=this.hasPendingAppsUpdate&&s;if(l&&(this.hasPendingAppsUpdate=!1),n.call("CoverView","menuUp",!0),l&&(this.hasPendingAppsUpdate=!0),s){let e=!s.dummy||"dummy";this.setToolState({name:t,showingMenu:e}),n.call("CoverView","cancelRubberBanding");let i=s.onDismiss;return s.onDismiss=()=>{i&&i(),this.resetToolState()},void n.call("CoverView","addMenu",{menu:s})}!i&&o&&o.urlTemplate&&(i=o?this.urlFromTemplate(o.urlTemplate):""),this.setToolState({name:t,selected:!0,url:i,appInfo:o}),n.padView=this,n.call("CoverView","startRubberBanding",r,t),n.call("CoverView","setPointer")}setToolState(e){this.toolState=e,this.publish(this.sessionId,"updatedToolState",e)}resetToolState(){let e=window.topView.querySelector("#cover");e.padView=this,e.call("CoverView","cancelRubberBanding"),e.call("CoverView","menuUp"),e.call("CoverView","setPointer"),this.setToolState(null),this.hasPendingAppsUpdate&&(this.hasPendingAppsUpdate=!1,this.publish(this.sessionId,"appsChanged"))}userAppsChanged(){this.toolState&&this.toolState.showingMenu?this.hasPendingAppsUpdate=!0:this.publish(this.sessionId,"appsChanged")}sessionAppUpdated(e){!window.topView.querySelector("#scaler").call("PasteUpView","getUserApps")[e]&&this.toolState&&this.toolState.showingMenu?this.hasPendingAppsUpdate=!0:this.publish(this.sessionId,"appsChanged")}favoritesChanged(e){if(!this.toolState)return;let{name:t,showingMenu:i}=this.toolState;!0!==i||e&&t!==e||this.publish(this.sessionId,"toolFavoritesChanged",e)}createObjectInRect(e){let{name:t,url:i,appInfo:s}=this.toolState,{x:o,y:r,width:n,height:a}=e,l={x:o,y:r,width:n,height:a,viewId:this.viewId,type:t,url:i,appInfo:s};"text"===t?this.publish(this.model.id,"newText",l):this.publish(this.model.id,"newIFrame",l)}scroll(e){if(!this.scaler)return;let t=this.scaler.currentTranslation,i=Math.round(this.dom.scrollLeft);Math.abs(i-t.x)>1&&(this.dom.scrollLeft=t.x);let s=Math.round(this.dom.scrollTop);Math.abs(s-t.y)>1&&(this.dom.scrollTop=t.y)}setScroll(e,t,i){let s=this.scaler.currentZoom,o=this.dom.getBoundingClientRect();return e=e<0?0:Math.min(e,this.scaler.model._get("boardWidth")*s-o.width),t=t<0?0:Math.min(t,this.scaler.model._get("boardHeight")*s-o.height),e=Math.round(e),t=Math.round(t),this.scaler.currentTranslation={x:e,y:t},this.dom.scrollLeft=e,this.dom.scrollTop=t,i&&window.topView.throttledInvoke("publishViewport",3*this.scaler.throttleBaseMS,(()=>this.publishViewport())),this.updateAllPointers(),this.viewportRestoreSpec=null,this.publish(this.sessionId,"annotationCleanAndDraw"),{x:e,y:t}}publishViewport(){let e=this.getVisibleScalerRect(),{x:t,y:i,width:s,height:o}=e,r={x:0|t,y:0|i,width:0|s,height:0|o};this.publish(this.model.id,"viewport",{viewId:this.viewId,scalerRect:r})}zoom(e){this.scaler.currentZoom=e;let t=this.scaler.dom.style.getPropertyValue("transform");if(!t)return;let i=t.split(", ");i[0].startsWith("matrix(")&&(i[0]=i[0].slice(7)),i[5].endsWith(")")&&(i[5]=i[5].slice(0,i[5].length-1));let s=i.map((e=>parseFloat(e)));s[0]=e,s[3]=e;let o=`matrix(${s.join(", ")})`;this.scaler.dom.style.setProperty("transform",o);let r=window.topView.querySelector("#scaleReadout");r&&r.call("ScaleReadOutView","showScale",e),window.topView.querySelector("#cover").call("CoverView","zoomUpdated");let n=Array.from(this.dom.querySelectorAll("iframe")).map((e=>[e,e.style.display]));n.forEach((([e,t])=>e.style.display="none")),this.dom.scrollWidth,n.forEach((([e,t])=>e.style.display=t));let a=this.dom.getBoundingClientRect();this.publish(this.sessionId,"annotationResizeAndDraw",a.width,a.height)}annotationDone(){this.isDrawing=!1;let e=window.topView.querySelector("#annotationButton");e&&e.call("AnnotationButtonView","setActive",!1)}annotationButtonPressed(){if(this.isDrawing)return this.isDrawing=!1,void this.stopAnnotationDrawing(!0);this.isDrawing=!0,this.startAnnotationDrawing()}startAnnotationDrawing(){if(!this.scaler)return;let e=this.scaler.call("PasteUpView","getUserInfo",this.viewId).userColor||"#00FF00",t=this.parentNode.querySelector("#annotation-canvas");t&&t.call("DrawView","localActivate",e);let i=window.topView.querySelector("#annotationButton");i&&i.call("AnnotationButtonView","setActive",!0,e)}stopAnnotationDrawing(){let e=this.parentNode.querySelector("#annotation-canvas");e&&e.call("DrawView","localDeactivate");let t=window.topView.querySelector("#annotationButton");t&&t.call("AnnotationButtonView","setActive",!1)}},class CoverView{init(){this.addEventListener("pointerdown","pointerDown"),this.addEventListener("pointermove","pointerMove"),this.addEventListener("wheel","wheel"),this.dom.setAttribute("tabindex","-1"),console.log("CoverView.init")}activate(){this.addEventListener("keydown","keyDown"),this.dom.style.removeProperty("display"),this.dom.focus()}deactivate(){this.dom.blur(),this.dom.style.setProperty("display","none"),this.removeEventListener("keydown","keyDown")}ensureScaler(){return this.scaler||(this.scaler=window.topView.querySelector("#scaler")),this.scaler}setPointer(){this.ensureScaler(),this.dom.style.setProperty("cursor",this.scaler.dom.style.getPropertyValue("cursor"))}pointerMove(e){e.preventDefault(),this.ensureScaler(),this.scaler.call("PasteUpView","pointerMove",e,!0)}pointerDown(e){1===e.buttons&&(e.preventDefault(),e.stopPropagation(),this.rubber?this.newObjectDown(e):this.menuUp())}wheel(e){e.preventDefault(),e.stopPropagation(),this.pad||(this.pad=window.topView.querySelector("#pad")),this.pad.call("TransformView","wheel",e)}newObjectDown(e){if(1!==e.buttons)return;this.setPointerCapture(e.pointerId);let t=this.dom.getBoundingClientRect(),i=e.clientX-t.x,s=e.clientY-t.y;this.rubberBandingInfo.originX=i,this.rubberBandingInfo.originY=s,this.addEventListener("pointerup","newObjectUp"),this.addEventListener("lostpointercapture","resetToolState")}newObjectMove(e){let t=this.dom.getBoundingClientRect(),i=e.clientX-t.x,s=e.clientY-t.y,o=this.rubber;if(void 0!==this.rubberBandingInfo.originX){let{originX:e,originY:t}=this.rubberBandingInfo,o=i-e,r=s-t;if(Math.abs(o)<10&&Math.abs(r)<10)return;o<0?o=-o:i=e,r<0?r=-r:s=t,this.rubberBandingInfo.dragWidth=o,this.rubberBandingInfo.dragHeight=r,this.scaleRubberForZoom()}o.style.setProperty("left",i+"px"),o.style.setProperty("top",s+"px"),o.style.setProperty("opacity","0.2")}newObjectLeave(e){this.releaseAllPointerCapture(),this.rubber&&this.rubber.style.setProperty("opacity","0")}newObjectUp(e){this.releaseAllPointerCapture(),this.removeEventListener("pointerup","newObjectUp");let{originX:t,originY:i,width:s,height:o}=this.rubberBandingInfo,r=this.scaler.currentTranslation,n=this.scaler.currentZoom,a={x:(t+r.x)/n,y:(i+r.y)/n,width:s,height:o};this.padView.call("TransformView","createObjectInRect",a),this.padView.call("TransformView","resetToolState")}startRubberBanding(e,t){let i,s;"text"===t?(i=300,s=250):(i=600,s=500),this.ensureScaler();let o=this.scaler.model.call("PasteUpModel","getMinObjectExtent");if(this.rubberBandingInfo={minWidth:o.x,minHeight:o.y,width:i,height:s},this.rubber)this.dom.focus();else{let e=this.rubber=document.createElement("div");e.style.setProperty("position","absolute"),e.style.setProperty("background-color","#99999999"),e.style.setProperty("pointer-events","none"),this.dom.appendChild(e),this.addEventListener("pointermove","newObjectMove"),this.addEventListener("pointerenter","newObjectMove"),this.addEventListener("pointerleave","newObjectLeave"),this.activate()}this.rubber.style.setProperty("top",`${e.top+25}px`),this.rubber.style.setProperty("left",`${e.right+25}px`),this.rubber.style.setProperty("opacity","0.2"),this.scaleRubberForZoom()}scaleRubberForZoom(){let e=this.scaler.currentZoom;if(void 0!==this.rubberBandingInfo.dragWidth){let{dragWidth:t,dragHeight:i,minWidth:s,minHeight:o}=this.rubberBandingInfo;this.rubberBandingInfo.width=Math.max(t/e,s),this.rubberBandingInfo.height=Math.max(i/e,o)}let{width:t,height:i}=this.rubberBandingInfo;this.rubber.style.setProperty("width",t*e+"px"),this.rubber.style.setProperty("height",i*e+"px")}zoomUpdated(){this.rubber&&this.scaleRubberForZoom()}resetToolState(){this.padView.call("TransformView","resetToolState")}keyDown(e){e.preventDefault(),"Escape"===e.key&&this.resetToolState()}cancelRubberBanding(){this.rubber&&(delete this.rubberBandingInfo,this.rubber.remove(),this.rubber=null,this.removeEventListener("pointermove","newObjectMove"),this.removeEventListener("pointerenter","newObjectMove"),this.removeEventListener("pointerleave","newObjectLeave"),this.removeEventListener("lostpointercapture","resetToolState"),this.deactivate())}addMenu(e){this.menuUp();let{menu:t,placeElement:i,position:s}=e;this.addEventListener("click","menuUp"),this.activate(),this.menu=t;let o=window.topView.querySelector("#middle");if(o.call("MiddleView","enablePointerMoveHandler"),t.dummy)return;o.dom.appendChild(t);let r=t.getBoundingClientRect();if(t.style.setProperty("z-index","10000030"),i){let e,o,n=i.dom.getBoundingClientRect(),a=this.dom.getBoundingClientRect();if("center"===s)e=n.width/2+n.left-a.left,e-=r.width/2,o=n.bottom-a.top;else{if("bottomRight"===s)return e=n.left-r.width,t.style.setProperty("position","absolute"),t.style.setProperty("left",e-15+"px"),void t.style.setProperty("bottom","32px");if("bottomLeft"===s)return e=n.right,t.style.setProperty("position","absolute"),t.style.setProperty("left",e+15+"px"),void t.style.setProperty("bottom","24px");"present"===s?(e=n.left-a.left-10,e-=r.width,o=n.bottom-r.height):"centerLeft"===s?(e=n.width+n.left,o=n.bottom-a.top):(e=n.right-a.left,o=n.y-a.top)}t.style.setProperty("position","absolute"),t.style.setProperty("left",e+5+"px"),t.style.setProperty("top",o+0+"px")}}menuUp(e=!1){if(this.menu){let t=this.menu;this.menu=null,this.removeEventListener("click","menuUp");let i=!!t.dummy;!t.onDismiss||i&&e||t.onDismiss(),i||t.remove(),window.topView.querySelector("#middle").call("MiddleView","disablePointerMoveHandler"),this.deactivate()}}},class PasteUpModel{init(){this.subscribe(this.sessionId,"triggerPersist","triggerPersist"),this.subscribe(this.sessionId,"trashObject","trashObject"),this.subscribe(this.sessionId,"copyObject","copyObject"),this.subscribe(this.sessionId,"moveObjectEdges","moveObjectEdges"),this.subscribe(this.sessionId,"resizeOrMoveEnd","resizeOrMoveEnd"),this.subscribe(this.sessionId,"moveAndResizeObject","moveAndResizeObject"),this.subscribe(this.sessionId,"returnToPreviousState","returnToPreviousState"),this.subscribe(this.sessionId,"bringToFront","bringToFront"),this.subscribe(this.sessionId,"sendToBack","sendToBack"),this.subscribe(this.sessionId,"setFrameBorder","setFrameBorder"),this.subscribe(this.sessionId,"setLockFrame","setLockFrame"),this.subscribe(this.sessionId,"openWorkspace","openWorkspace"),this.subscribe(this.id,"setSessionFavorite","setSessionFavorite"),this.subscribe(this.id,"startScripting","startScripting"),this.subscribe(this.id,"setUserInfo","setUserInfo"),this.subscribe(this.sessionId,"view-join","addUser"),this.subscribe(this.sessionId,"view-exit","deleteUser"),this.subscribe(this.id,"loadContents","loadDuplicate"),this.subscribe(this.sessionId,"setBackground","setBackground"),this.ensureUserInfo(),this.ensureLayers(),this.ensureSessionApps(),this.ensureSessionUtilities(),this.ensureSessionFavorites(),this.ensurePersistenceProps(),this.ensureScriptors(),console.log("PasteUpModel.init")}ensureUserInfo(){return this._get("userInfo")||this._set("userInfo",{}),this._get("userInfo")}ensureLayers(){return this._get("layers")||this._set("layers",[]),this._get("layers")}ensureSessionFavorites(){return this._get("sessionFavorites")||this._set("sessionFavorites",{}),this._get("sessionFavorites")}ensureSessionApps(){let e=!1,t=this._get("sessionApps");if((()=>{if(!t)return void(e=!0);let i=Object.keys(t);0!==i.length&&t[i[0]].order||(e=!0)})(),e){let e={poker:{label:"Ugly Poker",iconName:"link.svgIcon",urlTemplate:"https://p3anoman.github.io/poker/?q=${q}",order:70,noURLEdit:!0,noSandbox:!0},chalculator:{label:"Chalculator",iconName:"link.svgIcon",urlTemplate:"https://p3anoman.github.io/chalculator/?q=${q}",order:50,noURLEdit:!0,noSandbox:!0},cubes:{label:"Cubes",iconName:"link.svgIcon",urlTemplate:"https://p3anoman.github.io/cellblock/?q=${q}",order:60,noURLEdit:!0,noSandbox:!0},docview:{label:"document",iconName:"pdf.svgIcon",urlTemplate:"../docview/?q=${q}",order:20},pix:{label:"pictures",iconName:"addimg.svgIcon",urlTemplate:"../pix/?q=${q}",order:30},text:{label:"notes",iconName:"text-fields.svgIcon",urlTemplate:"../text/apps/?q=${q}",order:40},youtube:{label:"youtube",iconName:"youtube.svgIcon",urlTemplate:"../youtube/?q=${q}",order:80}};this._set("sessionApps",e)}return this._get("sessionApps")}ensureSessionUtilities(){if(!this._get("sessionUtilities")){let e={file:{label:"upload file",iconName:"upload.svgIcon",buttonClass:"FileButtonClass",order:10}};this._set("sessionUtilities",e)}return this._get("sessionUtilities")}ensurePersistenceProps(){if(!this._get("persistPeriod")){let e=6e4;this._set("persistPeriod",e)}void 0===this._get("lastPersistTime")&&this._set("lastPersistTime",0),void 0===this._get("persistRequested")&&this._get("persistRequested",!1)}ensureScriptors(){return this._get("scriptors")||this._set("scriptors",{}),this._get("scriptors")}chooseNewUserColor(e){let t=this._get("userInfo"),i=Object.keys(t).length+1,s=Math.ceil(i/e),o=new Array(e).fill(s);Object.values(t).forEach((e=>{let t=e.userColorIndex;void 0!==t&&o[t]--}));let r=[];return o.forEach(((e,t)=>{e>0&&r.push(t)})),r[Math.floor(Math.random()*r.length)]}setUserInfo(e){let{viewId:t,sessionName:i,...s}=e;if(this._set("sessionName",i),t.startsWith("viewDomain"))return;if(!s.userColor){let e=["#1378a5","#c71f3c","#2f4858","#6a3d9a","#333F91","#2ba249","#275B33","#cc7025","#f15a3a","#901940","#3b0f30"],t=this.chooseNewUserColor(e.length);s.userColorIndex=t,s.userColor=e[t]}let o=this._get("userInfo"),r={...o[t]||{},...s};o={...o,[t]:r},this._set("userInfo",o),this.publish(this.sessionId,"userCursorUpdated",t),this.publish(this.id,"userInfoChanged")}addUser(e){}deleteUser(e){let t={...this._get("userInfo")};delete t[e],this._set("userInfo",t),this.publish(this.id,"userInfoChanged")}trashObject(e){let{target:t,_viewId:i}=e;if(t){let e=this.getElement(t);if(e){let i=this._get("layers").slice(),s=i.findIndex((e=>t.equals(e))),o=i.length;if(s>=0){i.splice(s,1);for(let e=s;e<o-1;e++){this.getElement(i[e]).style.setProperty("z-index",`${e}`)}this._set("layers",i)}e.remove(),this.publish(this.id,"trashObject",t),this.triggerPersist()}}}copyObject(e){let{target:t,_viewId:i}=e;if(t){let e=this.getElement(t);if(e){let t=new(this.getLibrary("boards.PasteUpSaver3")),i=t.save(this,[e]),s=t.load(i,this)[0],o=s.getTransform().slice();o[4]+=50,o[5]+=50,s.setTransform(o),this.addFrame(s);let r=this.getElement(s._get("target"));this.comeUpFullyOnReload(s,r)}}}setFrameBorder(e){let{target:t,_viewId:i,flag:s}=e;if(t){let e=this.getElement(t);e&&(e._set("showBorder",s),e.call("FrameModel","stateChanged"))}}setLockFrame(e){let{target:t,_viewId:i,flag:s}=e;if(t){let e=this.getElement(t);e&&(e._set("locked",s),e.call("FrameModel","stateChanged"))}}getMinObjectExtent(){return{x:150,y:85}}moveObjectEdges(e){let{updates:{top:t,bottom:i,left:s,right:o},target:r,viewId:n,frameInfo:a}=e,l=this.getElement(r);if(!l)return void console.log("target not found",r);let d=this.getElement(a);if(!d)return void console.log("frame not found",a);let h=d.getTransform().slice(),c=h[4],u=h[5],m=d.call("FrameModel","getTitleHeight"),g=this.getMinObjectExtent(),w=g.x,f=g.y-m,v=c,y=u+m,b=parseFloat(l.style.getPropertyValue("width")),C=parseFloat(l.style.getPropertyValue("height")),S=!1;if(void 0!==s){let e=v+b;c=Math.min(s,Math.max(e,o||0)-w),v=c,h[4]=c,S=!0,b=e-v}if(void 0!==o){b=Math.max(o,v+w)-v}if(void 0!==t){let e=y+C;u=Math.min(t,Math.max(e,i||0)-f-m),y=u+m,h[5]=u,S=!0,C=e-y}if(void 0!==i){C=Math.max(i,y+f)-y}S&&d.setTransform(h),l._get("_useSetExtent")?l.call(...l._get("_useSetExtent"),b,C):(l.style.setProperty("width",b+"px"),l.style.setProperty("height",C+"px"))}moveAndResizeObject(e){let{width:t,height:i,x:s,y:o,frameInfo:r,target:n,_viewId:a}=e,l=this.getElement(r),d=this.getElement(n);if(!d)return void console.log("target not found",n);if(!l)return void console.flog("frame not found",r);let h=l.getTransform().slice();h[4]=s,h[5]=o,l.setTransform(h),t=Math.max(t,36),i=Math.max(i,36),d._get("_useSetExtent")?d.call(...d._get("_useSetExtent"),t,i):(d.style.setProperty("width",t+"px"),d.style.setProperty("height",i+"px"))}resizeOrMoveEnd(e){let t=e.frameInfo,i=this.getElement(t);if(!i)return;let s=i.getTransform().slice(),o=i._get("target");if(!o)return;let r=this.getElement(o),n=this._get("boardWidth"),a=this._get("boardHeight"),l=r?parseFloat(r.style.getPropertyValue("width")):400;s[4]<0&&(s[4]=0),s[4]+l>n&&(s[4]=n-l-200),s[5]<0&&(s[5]=0),s[5]+200>a&&(s[5]=a-200),i.setTransform(s),this.triggerPersist()}returnToPreviousState(){let e=this._get("previousWindowState");e&&this.moveAndResizeObject(e)}bringToFront(e){let{target:t,_viewId:i}=e;if(t){let e=this.getElement(t);if(e){let i=this._get("layers").slice(),s=i.findIndex((e=>t.equals(e))),o=i.length;if(s>=0){let t=i[s];i.splice(s,1);for(let e=s;e<o-1;e++){this.getElement(i[e]).style.setProperty("z-index",`${e}`)}return i.push(t),e.style.setProperty("z-index",""+(i.length-1)),void this._set("layers",i)}this.appendChild(e)}}}sendToBack(e){let{target:t,_viewId:i}=e;if(t){let e=this.getElement(t);if(e){let i=this._get("layers").slice(),s=i.findIndex((e=>t.equals(e)));if(s>=0){let t=i[s];i.splice(s,1),i.unshift(t),e.style.setProperty("z-index","0");for(let e=1;e<s+1;e++){this.getElement(i[e]).style.setProperty("z-index",`${e}`)}return void this._set("layers",i)}this.insertFirst(e)}}}setSessionFavorite(e){let t=this._get("sessionFavorites"),i={};for(let[e,s]of Object.entries(t))i[e]={...s};let s=!0,{url:o,status:r,appInfo:n,proposedName:a}=e,{appName:l}=n,d=i[o];if(r){if(d){let{appInfo:{appName:e},faveName:t}=d;s=!(l===e&&a===t)}if(s){let e=Object.keys(i).map((e=>{if(e===o)return null;let t=i[e];return t.appInfo.appName===l&&t.faveName})).filter(Boolean),t=a,s=0;for(;e.includes(t);)t=`${a} (${++s})`;i[o]={appInfo:n,faveName:t};let r=this._get("sessionApps");if(!r[l]){let e={};for(let[t,i]of Object.entries(r))e[t]={...i};let{label:t,iconName:i,urlTemplate:s}=n;e[l]={label:t,iconName:i,urlTemplate:s},this._set("sessionApps",e),this.publish(this.sessionId,"sessionAppUpdated",l)}}}else delete i[o],s=!!d;this._set("sessionFavorites",i),s&&this.publish(this.sessionId,"favoritesChanged",l)}addFrame(e){let t=[...this._get("layers"),e.asElementRef()];this._set("layers",t),e.style.setProperty("z-index",""+(t.length-1)),this.appendChild(e),this.triggerPersist()}openWorkspace(e,t){let i=t||this.newNativeText({x:e.x+200,y:e.y+200,width:400,height:300}),s=i.querySelector("#text");this.workspaceAccepted({ref:s.asElementRef(),text:void 0}),{...this._get("scriptors")}[s.asElementRef().asKey()]={textFrameRef:i.asElementRef()},this.subscribe(s.id,"text","PasteUpModel.workspaceAccepted")}workspaceAccepted(e){let{ref:t,text:i}=e,s=this.getElement(t),o=`\nclass Workspace {\n    m() {\n        return (${i});\n    }\n}`.trim();s.addCode(o);let r=s.call("Workspace","m");void 0!==r&&s.load([{text:i+"\n"+r}])}startScripting(e){let{frameInfo:t,objectInfo:i}=e,s=this.getElement(t);if(!s)return;let o=this.getElement(i),r=parseInt(o.style.getPropertyValue("width"),10),n=s.getTransform().slice(),a=this.newNativeText({x:n[4]+r+10,y:n[5],width:400,height:300}),l=a.querySelector("#text"),d={...this._get("scriptors")};d[l.asElementRef().asKey()]={textFrameRef:a.asElementRef(),frameRef:s.asElementRef(),objectRef:o.asElementRef()},this._set("scriptors",d);let h=o.getCode()[0]||"";h.length>0&&!h.trim().startsWith("class")&&(h=this.getLibrary(h)),l.load(h||""),this.subscribe(l.id,"text","PasteUpModel.codeAccepted")}newNativeText(e){let{x:t,y:i,width:s,height:o}=e,r=this.createElement("TextElement");r.domId="text",r.style.setProperty("-cards-direct-manipulation",!0),r.style.setProperty("-cards-text-margin","4px 4px 4px 4px"),r.setDefault("Poppins-Medium",16),r.setWidth(s),r.style.setProperty("width",s+"px"),r.style.setProperty("height",o+"px"),r.style.setProperty("background-color","white");r.setTransform([1,0,0,1,0,0]);let n=this.createElement();return n.setCode("boards.FrameModel"),n.setViewCode("boards.FrameView"),n.call("FrameModel","setObject",r,{x:t,y:i}),this.addFrame(n),n}codeAccepted(e){let{ref:t,text:i}=e,s=this._get("scriptors")[t.asKey()];this.getElement(s.objectRef).setCode(i)}loadDuplicate(e){return this.load(e,"3")}load(e,t){let i,s=e;if("3"===t){i=this.getLibrary("boards.PasteUpSaver3"),s=this.wellKnownModel("modelRoot").parse(e)}else i=this.getLibrary("boards.PasteUpSaver"),s="2"===t?e:JSON.parse(e);let{json:o}=s;(new i).load(o,this).forEach((e=>{this.addFrame(e);let t=this.getElement(e._get("target"));this.comeUpFullyOnReload(e,t)})),this.publish(this.id,"loadCompleted")}comeUpFullyOnReload(e,t){t.hasHandler("MiniBrowser")&&t.call("MiniBrowser","comeUpFullyOnReload"),t.hasHandler("Workspace")&&this.openWorkspace(null,e)}loadPersistentData({_name:e,version:t,data:i}){try{this._delete("loadingPersistentDataErrored"),this._set("loadingPersistentData",!0),this.load(i,t)}catch(e){console.error("error in loading persistent data",e),this._set("loadingPersistentDataErrored",!0)}finally{this._delete("loadingPersistentData")}}savePersistentData(){if(this._get("loadingPersistentData"))return;if(this._get("loadingPersistentDataErrored"))return;this._set("lastPersistTime",this.now());let e=this.wellKnownModel("modelRoot");e.persistSession((()=>{let t=this.getLibrary("boards.PasteUpSaver3"),i=this._get("sessionName")||"Unknown",s=new t,o=this._get("sessionFavorites")||{},r=this._get("sessionApps")||{},n=s.save(this);return{name:i,version:"3",data:e.stringify({json:n,sessionFavorites:o,sessionApps:r})}}))}triggerPersist(){let e=this.now(),t=e-this._get("lastPersistTime"),i=this._get("persistPeriod");t<i?this._get("persistRequested")||(this._set("persistRequested",!0),this.future(i-t).call("PasteUpModel","triggerPersist")):(this._set("lastPersistTime",e),this._set("persistRequested",!1),this.savePersistentData())}setBackground(e){let{url:t,type:i}=e,s=this.parentNode.parentNode.querySelector("#middle-backdrop"),o=this.parentNode;if("iframe"===i){let i=this._get("backdrop");if(this._set("backdrop",e),i&&"iframe"===i.type&&(s.childNodes.length>0&&s.childNodes[0].remove(),o.style.removeProperty("height"),this.style.removeProperty("background-color"),this.style.removeProperty("background-size")),0===t.length)return;let r=this.createElement("IFrameElement");r.domId="backdrop-iframe",r.classList.add("backdrop-iframe"),r._set("src",t),r._set("allow","camera; microphone; encrypted-media"),r._set("sandbox","allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-same-origin allow-scripts"),s.appendChild(r),o.style.setProperty("height","95%"),this.style.setProperty("background-color","#00000001"),this.style.setProperty("background-size","0 0")}}},class PasteUpView{init(){this.subscribe(this.sessionId,"fileUpload","handleFileUpload"),this.subscribe(this.sessionId,"allUserCursorsUpdated","allUserCursorsUpdated"),this.subscribe(this.sessionId,"userCursorUpdated","userCursorUpdated"),this.subscribe(this.model.id,"userInfoChanged","userInfoChanged"),this.subscribe(this.model.id,"trashObject","trashObject"),this.subscribe(this.model.id,"loadCompleted","loadCompleted"),this.addEventListener("drop","drop"),this.dom.addEventListener("pointermove",(e=>this.pointerMove(e)),!0),this.throttleBaseMS=20,this.setup(),console.log("PasteUpView.init")}setup(){this.setupUserInfo(),this.iframes=new Map,this.iframeInitializers={},this.viewportRestoreSpec=null,this.docked=[],this.userFavorites=[],this.userApps={},this.provisionalApp=null;const{Messenger:e,App:t}=Croquet;e.setReceiver(this),e.setIframeEnumerator((()=>this.getIframes())),e.on("appReady","handleAppReady"),e.on("sessionInfoRequest","handleSessionInfoRequest"),e.on("userInfoRequest","handleUserInfoRequest"),e.on("videoChatInitialStateRequest","handleVideoChatInitialStateRequest"),e.on("allUserInfoRequest","handleAllUserInfoRequest"),e.on("userCursorRequest","handleUserCursorRequest"),e.on("transparencyRequest","handleTransparencyRequest"),e.on("creatingUserRequest","handleCreatingUserRequest"),e.on("appInfo","handleAppInfo"),e.on("pointerPosition","handlePointerPosition"),e.on("messageSoundRequest","handleMessageSoundRequest"),e.on("leaveSoundRequest","handleLeaveSoundRequest"),e.on("enterSoundRequest","handleEnterSoundRequest"),this.sounds={};for(const e of["message","enter","leave"]){let t=window._production;this.sounds[e]=new Audio(`${t}/assets/sounds/${e}.mp3`),"enter"===e&&this.sounds[e].addEventListener("canplay",(()=>{this.parentNode.model._get("presentingViewId")||this.sounds[e].play().catch(console.log)}))}t.root="middle",t.messages=!0,t.showMessage=(e,i={})=>{i.q_custom&&t.messageFunction(e,i)};let i=window.navigator.userAgent,s=i.indexOf("Safari")>=0&&-1===i.indexOf("Chrome"),o=s?60:30,r=s?59:29;this.model.getLibrary("minibrowser.QRIcon").defaultDragImage(o,o).then((e=>{this.dragImageDetails={img:e,xOff:24,yOff:r}}));let n=new URL(window.location.href),a=n.searchParams.get("launch");if(a){let e=n.searchParams.get("dataId");return void this.loadContents(a,e).then((e=>{let t=window.location,i=`${t.origin}${t.pathname}?r=${a}&launched=true`;setTimeout((()=>window.location.assign(i)),100)})).catch((e=>{console.log(e)}))}let l=n.searchParams.get("duplicate"),d=n.searchParams.get("newId");if(l&&d)return void this.duplicateAndUpload(d);let h=window.topView.querySelector("#beacon");h&&(h.call("BeaconView","sendBeacon"),window.topView.detachCallbacks.push((()=>{h.call("BeaconView","clearTimeout")}))),this.setupAppFileFormats();let c=window.topView.querySelector("#room-participants");c&&c.call("RoomParticipantsView","setScaler",this)}setupUserInfo(){let e,t,i,s=window.topView.viewId;if(window.fromLandingPage&&(e=window.fromLandingPage.nickname,t=window.fromLandingPage.initials,i=window.fromLandingPage.sessionName),e||(e=s),!t){let i=e.split(" ").filter((e=>e.length>0));1===i.length?t=i[0].slice(0,2).toUpperCase():(t=i.map((e=>e[0])),t=t[0]+t.slice(-1),t=t.toUpperCase())}let o=e;console.log("setupUserInfo",e,s),this.localUserInfoPromise=new Promise((e=>this.localUserInfoResolver=e)),this.publish(this.model.id,"setUserInfo",{nickname:e,initials:t,viewId:s,userId:o,sessionName:i})}getAllUserInfo(){return this.model._get("userInfo")||{}}getUserInfo(e){return this.getAllUserInfo()[e]||{}}getUserInitials(e){return this.getUserInfo(e).initials}getUserId(e){return this.getUserInfo(e).userId}getUserColor(e){return this.getUserInfo(e).userColor}getDragImageDetails(){return this.dragImageDetails}getUserApps(){return this.userApps}setupAppFileFormats(){const e=this.appFileSpecs={};e.pix={types:["image/jpeg","image/gif","image/png","image/bmp"],extensions:["jpg","gif","png","bmp"]};const t=new Promise((e=>{fetch("https://croquet.io/convert/formats",{method:"GET",mode:"cors",headers:{"Content-Type":"text"}}).then((e=>e.ok?e.json():null)).then((t=>{if(t){const i=new Set,s=new Set;Object.values(t).forEach((e=>{e.forEach((e=>{i.add(e.mime),s.add(e.extension)}))})),i.delete("application/postscript"),s.delete("eps"),e({types:Array.from(i),extensions:Array.from(s)})}else console.warn("failed to load PDF-viewer conversion formats"),e({types:[],extensions:[]})})).catch((t=>{console.error(t.message,t),e({types:[],extensions:[]})}))}));e.docviewP=t,e.allKnownP=t}async getAppForFile(e){const{name:t,type:i}=e,s=this.appFileSpecs;if(s.pix.types.includes(i))return"pix";if(i.startsWith("text/"))return"docview";const o=t.slice(2+(t.lastIndexOf(".")-1>>>0));return(await s.docviewP).extensions.includes(o)?"docview":null}getAllDroppableFileFormats(){return this.appFileSpecs?this.appFileSpecs.allKnownP:Promise.resolve({types:[],extensions:[]})}setProvisionalApp(e,t){this.provisionalApp!==e&&(this.userApps[e]?this.provisionalApp=null:(this.userApps[e]=t,this.provisionalApp=e,this.publish(this.sessionId,"userAppsChanged")))}clearProvisionalApp(e){this.provisionalApp&&(e||(delete this.userApps[this.provisionalApp],this.publish(this.sessionId,"userAppsChanged")),this.provisionalApp=null)}randomColor(e){return`hsl(${Math.floor(parseInt(e,36)/36**10*360)}, 40%, 40%)`}allUserCursorsUpdated(){let e=this.getAllUserInfo();Object.keys(e).forEach((e=>this.userCursorUpdated(e)))}userCursorUpdated(e){if(this.call("RemoteCursorView","updatePointer",e),e===this.viewId){window.topView.querySelector("#cover").call("CoverView","setPointer")}}userInfoChanged(){this.getAllUserInfo()[this.viewId]&&this.localUserInfoResolver(),this.sendAllUserInfo()}sendAllUserInfo(e){Croquet.Messenger.send("allUserInfo",this.getAllUserInfo(),e)}pointerMove(e){let t,i,s=this.currentTranslation||{x:0,y:0},o=this.currentZoom||1;if(!this.dom.parentNode)return;let r,n=this.dom.parentNode.getBoundingClientRect();t=e.clientX-n.x,i=e.clientY-n.y,t=(t+s.x)/o,i=(i+s.y)/o,r="string"==typeof e.target?e.target:"object"==typeof e.target?e.target.key:this.dom.key,this.call("RemoteCursorView","localMouseMove",{time:e.timeStamp,target:r,x:t,y:i})}drop(e){const t={x:e.offsetX,y:e.offsetY},i=[],s=e.dataTransfer;if(s.types.includes("Files"))for(let e=0;e<s.files.length;e++){const t=s.files[e];i.push(t)}i.length&&this.handleFileUpload(i,t)}addAsset(e){this.publish(this.model.id,"addAsset",{descriptor:e,currentTranslation:this.currentTranslation,currentZoom:this.currentZoom,dropPoint:e.dropPoint})}openDialog(e,t,i,s,o){let removeDialog=()=>{this.dialog&&(this.dialog.remove(),this.dialog=null)};if(this.dialog)return void removeDialog();this.dialog=document.createElement("div"),this.dialog.classList.add("simpleDialog"),"text"===i&&(this.dialog.innerHTML=`<span style="font-family: Poppins-Medium">${t}:</span><br><input id="field" type="text" autocomplete="off" style="width:200px; height: 20px"></input><br><button id="accept">Accept</button>&nbsp;<button id="cancel">Cancel</button>`);let r,n,a=this.dialog.querySelector("#field"),cancelCallback=e=>{s(null),removeDialog()};"text"===i&&(r=e=>{let t=a.value;s(t),removeDialog()},n=e=>{"Enter"!==e.key&&13!==e.keyCode&&10!==e.keyCode||r(e),"Escape"===e.key&&cancelCallback()},a.addEventListener("keydown",n)),this.dialog.style.setProperty("left",e.x+32+"px"),this.dialog.style.setProperty("top",e.y+32+"px"),"text"===i&&(this.dialog.querySelector("#cancel").addEventListener("click",cancelCallback),this.dialog.querySelector("#accept").addEventListener("click",r)),document.body.appendChild(this.dialog),"text"===i&&(a.focus(),o&&(a.value=o))}async handleFileUpload(e,t=null){let i=this.currentTranslation,s=this.currentZoom;const o={pix:[],docview:[]};for(let t=0;t<e.length;t++){const i=e[t],{size:s,type:r}=i;if(s>52428800){this.showToastWarning(`${i.name} exceeds max size of 50MB`);continue}let n=await this.getAppForFile(i);n?o[n].push(i):this.showToastWarning(`${i.name} is of unhandled type "${r}"`)}let r={x:0,y:0},makeDisplayPoint=()=>{let e;return t?(e={x:t.x+r.x,y:t.y+r.y},r.x+=60,r.y+=40):e={x:(i.x+(50*Math.random()-25)+200)/s,y:(i.y+(50*Math.random()-25)+100)/s},e},getSendableSpec=e=>{let t;return t=e.arrayBuffer?e.arrayBuffer():new Promise((t=>{const i=new FileReader;i.onload=()=>t(i.result),i.readAsArrayBuffer(e)})),t.then((t=>{if(t.byteLength)return{name:e.name,size:e.size,type:e.type,croquet_contents:t};throw Error("length is zero")})).catch((t=>(this.showToastWarning(`${e.name} - ${t.message}`),null)))},n=this.model._get("sessionApps"),a=window.topView.querySelector("#pad");if(o.pix.length){let load=async e=>{const t=await new Promise((t=>{const i=new FileReader;i.onload=()=>t(i.result),i.readAsArrayBuffer(e)})),i=await Croquet.Data.store(this.sessionId,t);let s={displayPoint:makeDisplayPoint(),width:600,height:500,viewId:this.viewId,handle:i,type:"image"};this.publish(a.model.id,"newImage",s)};o.pix.forEach(load)}o.docview.length&&o.docview.forEach((async e=>{let t=await getSendableSpec(e);if(t){let e=makeDisplayPoint(),s=(i="docview",a.call("TransformView","urlFromTemplate",n[i].urlTemplate)),o={x:e.x,y:e.y,width:600,height:500,viewId:this.viewId,type:"docview",url:s,appInfo:n.docview};this.iframeInitializers[s]={message:"uploadFile",data:{file:t}},this.publish(a.model.id,"newIFrame",o)}var i}))}getIframes(){let e=[],add=(t,i)=>{let s=t.querySelector("iframe");if(s){if(i&&e.indexOf(s)>=0)return;e.push(s)}};return this.dom.childNodes.forEach(add),this.docked.forEach(add),e}ensureIframeEntry(e){let t=this.iframes.get(e);if(!t){if(t=this.getIframes().find((t=>t.contentWindow===e)),!t)return null;this.iframes.set(e,t)}return t}computeSessionHandles(){return this.sessionHandlesP||(this.sessionHandlesP=new Promise(((e,t)=>{let i=window.crypto.subtle;if(!i)return void t(new Error("crypto.subtle is not available"));let s=new TextEncoder,o=[this.session.persistentId,this.sessionId].map((e=>i.digest("SHA-256",s.encode(e)).then((e=>Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")))));Promise.all(o).then((([t,i])=>e({persistent:t,ephemeral:i})))}))),this.sessionHandlesP}handleAppReady(e,t){if(this.ensureIframeEntry(t),Croquet.Messenger.send("appInfoRequest",null,t),e&&this.iframeInitializers[e]){let{message:i,data:s}=this.iframeInitializers[e];Croquet.Messenger.send(i,s,t),delete this.iframeInitializers[e]}}handleSessionInfoRequest(e,t){let i=this.computeSessionHandles(),s=window.fromLandingPage&&window.fromLandingPage.boardName;s||(s=this.getSessionName()),Promise.all([i,s]).then((([e,i])=>{Croquet.Messenger.send("sessionInfo",{sessionHandle:e.persistent,sessionName:i,ephemeralSessionHandle:e.ephemeral},t)}))}async handleUserInfoRequest(e,t){this.ensureIframeEntry(t),await this.localUserInfoPromise;let i={...this.getUserInfo(this.viewId),viewId:this.viewId};Croquet.Messenger.send("userInfo",i,t)}handleAllUserInfoRequest(e,t){this.sendAllUserInfo(t)}handleVideoChatInitialStateRequest(e,t){let i=window.fromLandingPage||{},s={mic:i.mic||"on",video:i.video||"on",cameraDeviceId:i.cameraDeviceId,cameraDeviceLabel:i.cameraDeviceLabel,cameraDeviceIndex:i.cameraDeviceIndex,micDeviceId:i.micDeviceId,micDeviceLabel:i.micDeviceLabel,micDeviceIndex:i.micDeviceIndex,fromLandingPage:!!window.fromLandingPage};Croquet.Messenger.send("videoChatInitialState",s,t)}handleUserCursorRequest(e,t){this.ensureIframeEntry(t);let i=this.dom.style.getPropertyValue("cursor");Croquet.Messenger.send("userCursor",i,t)}miniBrowserViewForSource(e){let t=this.ensureIframeEntry(e),i=t&&t.parentNode,s=i&&i.key,o=s&&window.views[s];return o&&o.hasHandler("MiniBrowserView")?o:null}handleTransparencyRequest(e,t){let i=this.miniBrowserViewForSource(t);i&&i.call("MiniBrowserView","updateTransparency")}handleCreatingUserRequest(e,t){let i=this.miniBrowserViewForSource(t);i&&i.call("MiniBrowserView","sendCreatingUser")}handleAppInfo(e,t){let i=this.miniBrowserViewForSource(t);i&&i.call("MiniBrowserView","setAppInfo",e)}handlePointerPosition(e,t){let i=this.ensureIframeEntry(t);if(!i)return;let s=this.currentZoom||1,o=i.getBoundingClientRect(),r={clientX:o.x+e.x*s,clientY:o.y+e.y*s,target:this.dom.key,timeStamp:Date.now()};this.pointerMove(r)}trashObject(e){let t=e.asElementRef().asKey(),i=window.views[t];if(!i)return;let s=i.dom.querySelector("iframe");s&&this.iframes.delete(s.contentWindow,s)}addToDock(e){this.docked.indexOf(e)<0&&this.docked.push(e)}removeFromDock(e){let t=this.docked.indexOf(e);t>=0&&this.docked.splice(t,1)}nameAndSetFavorite(e,t,i){let s=this.model._get("sessionFavorites")[i.url],o=s&&s.faveName,r=this.userFavorites[i.url],n=r&&r.faveName,a="session"===t?o||n:n||o;a=a||"",this.openDialog(e,`Name for ${t} favorite`,"text",(e=>{this.clearProvisionalApp(!!e),e&&(e=e.trim(),"session"===t?(i.sessionFave=!0,i.proposedSessionName=e):"user"===t&&(i.userFave=!0,i.proposedUserName=e),this.setFavorite(i))}),a)}getAppFavorites(e){let t=this.model._get("sessionFavorites"),i=[];for(let[s,o]of Object.entries(t))o.appInfo.appName===e&&i.push({url:s,sessionName:o.faveName});let s={...this.userFavorites};return Object.keys(s).length&&(i.forEach((e=>{let{url:t}=e,i=s[t];i&&(e.userName=i.faveName,delete s[t])})),Object.keys(s).forEach((t=>{let o=s[t],{appInfo:{appName:r},faveName:n}=o;r===e&&i.push({url:t,userName:n})}))),i}setFavorite(e){let{appInfo:t,url:i,sessionFave:s,userFave:o}=e;if(void 0!==o){if(!this.walletIframe)return void console.warn("favorite set before wallet iframe known");let s={favorites:{url:i,spec:o?{appInfo:t,faveName:e.proposedUserName}:null}};Croquet.Messenger.send("updateWalletContents",s,this.walletIframe.contentWindow)}if(void 0!==s){let o={appInfo:t,url:i,status:s};s&&(o.proposedName=e.proposedSessionName),this.publish(this.model.id,"setSessionFavorite",o)}}save(e,t){let i=new(this.model.getLibrary("boards.PasteUpSaver3")),s=this.model._get("sessionFavorites")||{},o=this.model._get("sessionApps")||{},r=i.save(this.model,null,t),n=this.wellKnownModel("modelRoot");return this.uploadContents({name:e,version:"3",data:n.stringify({json:r,sessionFavorites:s,sessionApps:o})})}getSessionName(){let e=this.model._get("sessionName");return e?Promise.resolve(e):Croquet.App.autoSession("q")}saveRequest(e,t){this.getSessionName().then((i=>{if(!t)return void this.save(i);this.openDialog(e,"New Session Name: ","text",(e=>{e&&(e=e.trim(),this.save(e))}),i)}))}loadRequest(e,t){this.getSessionName().then((i=>{if(!t)return void this.loadContents(i);this.openDialog(e,"Load Session Named: ","text",(e=>{e&&(e=e.trim(),this.loadContents(e))}),i)}))}uploadContents(e){return Croquet.Data.store(this.sessionId,e.data).then((t=>({action:"duplicate",name:e.name,id:Croquet.Data.toId(t)})))}duplicateAndUpload(e){return this.save(e,!0).then((t=>{let{action:i,name:s,id:o}=t;console.log(i,s,o);let r=window.location,n=`${r.origin}${r.pathname}?r=${e}&launch=${e}&dataId=${encodeURIComponent(o)}`;window.location.assign(n)}))}loadContents(e,t){let i=Croquet.Data.fromId(t);return Croquet.Data.fetch(this.sessionId,i).then((e=>{let t=(new TextDecoder).decode(e);this.publish(this.model.id,"loadContents",t)}))}loadCompleted(){if(this.loadResolve){let e=this.loadResolve;delete this.loadPromise,delete this.loadResolve,delete this.loadReject,e(!0)}}handleMessageSoundRequest(){this.parentNode.model._get("presentingViewId")||this.sounds.message.play().catch(console.log)}handleEnterSoundRequest(){this.parentNode.model._get("presentingViewId")||this.sounds.enter.play().catch(console.log)}handleLeaveSoundRequest(){this.parentNode.model._get("presentingViewId")||this.sounds.leave.play().catch(console.log)}showToast(e,t,i){Croquet.App.showMessage(e,{q_custom:!0,position:"center",level:t,duration:i})}showToastLog(e){this.showToast(e)}showToastWarning(e){this.showToast(e,"warning",3e3)}showToastError(e){this.showToast(e,"error",3e3)}},class AppButtonManager{init(){this.subscribe(this.sessionId,"updatedToolState","updatedToolState"),this.subscribe(this.sessionId,"dropHighlightedTool","dropHighlightedTool"),this.subscribe(this.sessionId,"toolFavoritesChanged","toolFavoritesChanged"),this.subscribe(this.sessionId,"appsChanged","refreshAppButtons"),this.appButtons={},this.initAppButtonClass(),this.initUtilityButtonClasses(),this.refreshAppButtons(),this.refreshUtilButtons(),console.log("AppButtonManager.init")}refreshAppButtons(){let e=this.appButtons,t=window.topView.querySelector("#toolsAppRegion"),i=window.topView.querySelector("#scaler"),s=i.model._get("sessionApps"),o=i.call("PasteUpView","getUserApps"),r={};for(let[e,t]of Object.entries(s))r[e]=t;for(let[e,t]of Object.entries(o))r[e]=t;for(let[t,i]of Object.entries(e))r[t]||(delete e[t],i.dom.remove());let n=Object.keys(r);n.sort(((e,t)=>{let i=r[e],s=r[t];return i.order-s.order}));let createButton=e=>{let{appName:t,label:i,iconName:s,urlTemplate:o,noURLEdit:r,noSandbox:n,viewBox:a}=e;return[t,this.makeAppButton({appName:t,label:i,iconName:s,urlTemplate:o,noURLEdit:r,noSandbox:n,viewBox:a})]};n.forEach((i=>{let o=r[i];if(!e[i]){let{label:s,iconName:r,urlTemplate:n,noURLEdit:a,noSandbox:l,pressHold:d,viewBox:h}=o,c=this.makeAppButton({appName:i,label:s,iconName:r,urlTemplate:n,noURLEdit:a,noSandbox:l,pressHold:d,viewBox:h});if(d){let[t,i]=createButton(d);c.setSecondaryButton(t,i),e[t]=i}t.dom.appendChild(c.containerDom||c.dom),e[i]=c}let n=!s[i],a=e[i];n?a.dom.setAttribute("userOnly","true"):a.dom.removeAttribute("userOnly")}))}refreshUtilButtons(){let e=window.topView.querySelector("#toolsUtilRegion"),t=window.topView.querySelector("#scaler").model._get("sessionUtilities"),i=Object.keys(t);i.sort(((e,i)=>{let s=t[e],o=t[i];return s.order-o.order})),i.forEach((i=>{let s=t[i];if("-"===s.label){let t=document.createElement("div");t.classList.add("toolsDivider"),e.dom.appendChild(t)}else{let t=this.makeUtilityButton({utilityName:i,...s});t.dom.style.setProperty("order",s.order),e.dom.appendChild(t.dom)}}))}setIconAndLabel(e,t,i,s,o=!1){let r=[],n="img-"+t.slice(0,t.length-".svgIcon".length),a=o?`${n}-inverted`:n,l=o?n:`${n}-inverted`,d=s?`0 0 ${s[0]} ${s[1]}`:"0 0 24 24",h=`<div id="button-icon" class="no-select tool-button-holder">\n        <svg viewBox="${d}" class="tool-button-icon unhovered">\n        <use href="#${a}"></use></svg>\n        <svg viewBox="${d}" class="tool-button-icon hovered">\n        <use href="#${l}"></use></svg></div>`;r.push(h),i&&r.push(`<span class="no-select tool-button-label">${i}</span>`),e.innerHTML=r.join("")}initAppButtonClass(){this.AppButtonClass=this.model.getLibrary("boards.AppButton")}initUtilityButtonClasses(){this.UtilityButtonClass=this.model.getLibrary("boards.UtilityButton"),this.PresentationButtonClass=this.model.getLibrary("boards.PresentationButton"),this.FileButtonClass=this.model.getLibrary("boards.FileButton")}makeAppButton(e){return new this.AppButtonClass(this,e)}makeUtilityButton(e){return new(0,this[e.buttonClass])(this,e)}doWithAppButtons(e){Object.values(this.appButtons).forEach(e)}updatedToolState(e){this.doWithAppButtons((t=>t.updatedToolState(e)))}dropHighlightedTool(e){this.doWithAppButtons((t=>t.dropHighlightedTool(e)))}toolFavoritesChanged(e){this.doWithAppButtons((t=>t.toolFavoritesChanged(e)))}},class RemoteCursorView{init(){if(this.pointers)for(let e in this.pointers)this.deletePointer(e);if(!this.assetLib){let e=this.model.getLibrary("boards.AssetLibrary");this.assetLib=new e}this.pointers={},this.lastPointer={time:0,target:null,x:0,y:0,viewId:this.viewId},window.topView.pointerTracker={target:this,trait:"RemoteCursorView",pointerMoved:"pointerMoved",deletePointer:"deletePointer",deleteAllPointers:"deleteAllPointers"},this.setPointer(),console.log("RemoteCursorView.init")}setPointer(){let e=this.ensurePointer(this.viewId);this.dom.style.setProperty("cursor",`${e.style.getPropertyValue("background-image")},auto`),e.remove()}localMouseMove(e){let{target:t,time:i,x:s,y:o}=e;this.lastPointer.x===s&&this.lastPointer.y===o||(this.lastPointer.target=t,this.lastPointer.x=0|s,this.lastPointer.y=0|o,this.lastPointer.time=0|i,window.topView.throttledInvoke("publishPointer",this.throttleBaseMS,(()=>this.publishPointer({target:this.lastPointer.target,x:this.lastPointer.x,y:this.lastPointer.y,time:this.lastPointer.time,viewId:this.viewId}))))}deleteAllPointers(){for(let e in this.pointers)this.pointers[e].remove(),delete this.pointers[e]}deletePointer(e){let t=this.pointers[e];t&&(t.remove(),delete this.pointers[e])}pointerMoved(e){let{target:t,x:i,y:s,viewId:o}=e;if(o===this.viewId)return;if(!t)return;let r=this.ensurePointer(o),n=window.views[t];n&&n.model._get("_parent")&&(n=n.parentNode,i-=n.dom.scrollLeft,s-=n.dom.scrollTop);let a=this.currentZoom,l=this.currentTranslation;if(!a||!l)return;let d=i*a-l.x,h=s*a-l.y;r.style.setProperty("transform",`translate(${d}px,${h}px)`)}ensurePointer(e){let t=this.call("PasteUpView","getUserInitials",e);if(!this.pointers[e]){let i=document.createElement("div");i.setAttribute("cursor-name",t),i.style.setProperty("position","absolute"),i.style.setProperty("background-repeat","no-repeat"),i.style.setProperty("background-size","contain"),i.style.setProperty("width","32px"),i.style.setProperty("height","32px"),i.style.setProperty("user-select","none"),i.style.setProperty("pointer-events","none"),i.style.setProperty("left","0px"),i.style.setProperty("top","0px"),this.pointers[e]=i,this.updatePointerShape(e),window.topView.dom.appendChild(i)}return this.pointers[e]}updatePointer(e){let t=this.pointers[e];t&&(this.updatePointerShape(e),e===this.viewId&&this.dom.style.setProperty("cursor",`${t.style.getPropertyValue("background-image")},auto`))}updatePointerShape(e){let t=this.pointers[e],i=Object.keys(this.pointers).length,s=window.topView.pluggableDispatch("viewportTracker","getViewDetails",e);if(!s)return;let o,{isLocal:r,isPresenter:n,isFollower:a,isActive:l}=s,d=this.call("PasteUpView","getUserInfo",e),h=d?d.userColor:"darkblue",c=h,u=r?h:"white",m=this.call("PasteUpView","getUserInitials",e),g=r?"white":h;o=r||n||l&&!a?"1":i<10?"0.3":"0.1";let w=this.assetLib.avatar(m,c,u,g);w=encodeURIComponent(w),w=`url('data:image/svg+xml;utf8,${w}')`,t.style.setProperty("background-image",w),t.style.setProperty("opacity",o)}publishPointer(e){this.publish(this.model.sessionId,"viewPointerMoved",e)}},class VideoChatView{init(){if(!window.fromLandingPage)return;let e=window.fromLandingPage.chat;if(e&&("videoOnly"!==e||"off"===e))return;let t=this.dom.querySelector("#videoChatFrame");t||(t=document.createElement("iframe"),t.allow="autoplay;camera;microphone;fullscreen;picture-in-picture;display-capture;midi;geolocation;",t.id="videoChatFrame",t.src="https://vdo.ninja/?room=croquet_"+window.location.search.q+"&transparent",t.classList.add("docked-iframe"),t.attributeStyleMap.set("flex","auto"),this.dom.appendChild(t))}setup(){this.scaler=window.topView.querySelector("#scaler"),this.dom.style.setProperty("width","100%"),this.dom.style.setProperty("height","100%"),this.scaler.call("PasteUpView","addToDock",this.dom)}url(e){if(e.startsWith("http"))return e;let t=window.location.origin+window.location.pathname,i=window.location.hostname;if(("localhost"===i||i.endsWith(".ngrok.io"))&&(!e.startsWith("http")||!e.startsWith(".")))return new URL(e,"https://croquet.io/dev/q/").toString();if(e.startsWith("."))return new URL(e,t).toString();throw new Error("unrecognized URL fragment")}},class TextChatView{init(){window.topView.requestInitialization(this,"TextChatView","setup")}setup(){if(!window.fromLandingPage)return;let e=window.fromLandingPage.chat;if(e&&("textOnly"!==e||"off"===e))return;let t=this.dom.querySelector("#textChatFrame");t||(t=document.createElement("iframe"),t.id="textChatFrame",t.classList.add("docked-iframe"),this.dom.appendChild(t)),this.scaler=window.topView.querySelector("#scaler"),this.scaler.call("PasteUpView","computeSessionHandles").then((e=>{let i=window.topView.isRunningLocally()||!window.fromLandingPage?"&isLocal":"",s=window._production;t.src=this.url(`${s}/text-chat.html?q=${e.persistent}&docked=true${i}`),console.log("text-chat app location: "+t.src)})),this.dom.style.setProperty("flex-grow","1"),this.dom.style.setProperty("width","100%"),this.dom.style.setProperty("height","40%"),this.scaler.call("PasteUpView","addToDock",this.dom)}url(e){if(e.startsWith("http"))return e;let t=window.location.origin+window.location.pathname;if(e.startsWith("."))return new URL(e,t).toString();throw new Error("unrecognized URL fragment")}},class ToolsView{init(){let e=this.querySelector("#toolsAppRegion").dom;e.addEventListener("dragenter",(e=>this.dragEnter(e)),!0),e.addEventListener("dragover",(e=>this.dragOver(e)),!0),e.addEventListener("dragleave",(e=>this.dragLeave(e)),!0),e.addEventListener("drop",(e=>this.drop(e)),!0),this.dragEnterSeen=this.dragEnterHandled=!1,this.circle(.1),window.topView.querySelector("#top").dom.appendChild(this.circleCanvas),console.log("ToolsView.init")}circle(e,t,i){if(this.circleCanvas||(this.circleCanvas=document.createElement("canvas"),this.circleCanvas.width=32,this.circleCanvas.height=32,this.circleCanvas.classList.add("circleCanvas")),0===e)return void this.circleCanvas.style.setProperty("display","none");let s=this.circleCanvas.getContext("2d");s.lineWidth=2,s.strokeStyle="#4CF048",s.clearRect(0,0,32,32),s.beginPath();let o=.5*Math.PI;s.arc(16,16,14,-o,e-o),s.stroke(),this.circleCanvas.style.removeProperty("display"),this.circleCanvas.style.setProperty("left",t+"px"),this.circleCanvas.style.setProperty("top",i+"px")}appInfoFromEvent(e){let t={appName:"browser",label:"browser",iconName:"link.svgIcon",urlTemplate:null},i=e.dataTransfer.types.find((e=>e.includes("x.croquetfave")));if(i){let e=i.split(".")[2].match(/.{1,2}/g).map((e=>String.fromCharCode(Number(parseInt(e,16))))).join("");t=JSON.parse(e)}return t}dragEnter(e){if(!e.dataTransfer.types.includes("text/uri-list"))return;if(e.stopPropagation(),e.preventDefault(),this.dragEnterHandled)return void(this.dragEnterSeen=!0);this.dragEnterHandled=!0;let t=this.appInfoFromEvent(e),{appName:i,label:s,iconName:o,urlTemplate:r}=t;window.topView.querySelector("#scaler").call("PasteUpView","setProvisionalApp",i,{label:s,iconName:o,urlTemplate:r}),this.publish(this.sessionId,"dropHighlightedTool",i)}dragOver(e){let t=e.dataTransfer;t.types.includes("text/uri-list")&&(e.stopPropagation(),e.preventDefault(),t.dropEffect="copy")}dragLeave(e){if(e.stopPropagation(),e.preventDefault(),this.dragEnterSeen)return void(this.dragEnterSeen=!1);this.dragEnterHandled=!1,window.topView.querySelector("#scaler").call("PasteUpView","clearProvisionalApp",!1),this.publish(this.sessionId,"dropHighlightedTool",null)}drop(e){e.preventDefault(),this.dragEnterSeen=this.dragEnterHandled=!1,this.publish(this.sessionId,"dropHighlightedTool",null);let t=this.appInfoFromEvent(e),i=e.dataTransfer.getData("URL"),s={x:e.clientX+32,y:e.clientY};window.topView.querySelector("#scaler").call("PasteUpView","nameAndSetFavorite",s,"user",{url:i,appInfo:t})}windowResize(e){e&&setTimeout((()=>this.dom.style.setProperty("display","flex")),20);let t=window.topView.querySelector("#pad");if(!t)return;let i=t.dom.clientHeight;i<500?this.dom.style.setProperty("transform","scale(0.3)"):i<750?this.dom.style.setProperty("transform","scale(0.45)"):i<900?this.dom.style.setProperty("transform","scale(0.6)"):i<2e3?this.dom.style.setProperty("transform","scale(0.72)"):this.dom.style.removeProperty("transform")}},class ToolsTabView{init(){this.addEventListener("click","ToolsTabView.click"),this.userWantsHidden=this.isHidden=!1,this.updateState(),console.log("ToolsTabView.init")}click(){this.userWantsHidden=this.isHidden=!this.isHidden,this.updateState()}requestToolsHidden(e){let t=this.isHidden;this.isHidden=e||this.userWantsHidden,this.isHidden!==t&&this.updateState()}updateState(){let e=window.topView.querySelector("#tools");if(e){e.dom.setAttribute("hiddenState",`${this.isHidden}`),window.topView.querySelector("#pad").call("TransformView","resetToolState")}let t=window.topView.querySelector("#toolsTab");t&&t.dom.setAttribute("hiddenState",!1);let i=this.dom.querySelector("#icon");i&&(i.textContent=this.isHidden?"+":"-")}},class BeaconView{init(){this.lastTime=Date.now(),this.timeout=null}clearTimeout(){console.log("beacon: clear timeout",this.timeout),this.timeout&&(clearInterval(this.timeout),this.timeout=null)}sendBeacon(){if(!window.fromLandingPage)return;if(!window.fromLandingPage.sessionName)return;if(!window.Database)return;let e=window.fromLandingPage.sessionName,t=this.sessionId,i=window.fromLandingPage.nickname||"guest",s={thumbnail:null,boardId:e,sessionId:t,viewId:this.viewId,guestName:i};window.Database.postLastUpdated(s)}schedule(){this.clearTimeout(),this.timeout=setInterval((()=>this.sendBeacon()),3e4),console.log("schedule beacon",this.timeout),this.sendBeacon()}},e.TitleView,e.MiddleView,e.PeerView,e.FrameModel,e.FrameView,e.FrameResizeModel,e.FrameResizeView,e.FrameMoveView,e.FrameMenuModel,e.FrameMenuView,e.FrameLockModel,e.FrameLockView,e.FrameTrashModel,e.FrameTrashView,e.FrameAddressEditModel,e.FrameAddressEditView,e.RadarModel,e.RadarView,e.RadarButtonView,e.VSeparatorModel,e.VSeparatorView,e.SeparatorModel,e.SeparatorView,e.ScaleReadOutModel,e.ScaleReadOutView,e.PresentationButtonModel,e.PresentationButtonView,e.VersionStringView,e.AnnotationButtonModel,e.AnnotationButtonView,e.RoomNameModel,e.RoomNameView,e.RoomParticipantsModel,e.RoomParticipantsView,...t.expanders],functions:[function p(e,t,i){let s=e.createElement();s.domId="middle",s.setViewCode("boards.MiddleView");let o=e.createElement();o.domId="pad",o.classList.add("transform-pad"),o.style.setProperty("left","0px"),o.style.setProperty("top","0px");let r=e.createElement();r.domId="middle-backdrop",r.classList.add("middle-backdrop");let n=e.createElement();n.domId="peers",n.setViewCode("boards.PeerView");let a=e.createElement();a.domId="videoChat",a.setViewCode("boards.VideoChatView");let l=e.createElement();l.domId="vSeparator",l.setCode("boards.VSeparatorModel"),l.setViewCode("boards.VSeparatorView");let d=e.createElement();d.domId="textChat",d.setViewCode("boards.TextChatView");let h=e.createElement();h.domId="separator",h.setCode("boards.SeparatorModel"),h.setViewCode("boards.SeparatorView");let c=e.createElement();c.domId="peerFrameHolder",c.appendChild(a),c.appendChild(l),c.appendChild(d);let u=e.createElement();u.setViewCode(["widgets.WheelFilterView","widgets.GestureFilterView"]),u.domId="navHolder",u.classList.add("navHolder");let m=e.createElement();m.classList.add("navButtonBox");let g=e.createElement();g.domId="recenterButton",g.setCode("widgets.Button"),g.call("Button","beViewButton","Recenter","view-centered.svgIcon","navigation-button navigation-recenter-button","Recenter"),g.addDomain(null,"recenterButton");let w=e.createElement();w.domId="zoomInButton",w.setCode("widgets.Button"),w.call("Button","beViewButton","ZoomIn","view-zoom-in.svgIcon","navigation-button navigation-circle-button","Zoom In"),w.addDomain(null,"zoomInButton");let f=e.createElement();f.domId="zoomOutButton",f.setCode("widgets.Button"),f.call("Button","beViewButton","ZoomOut","view-zoom-out.svgIcon","navigation-button navigation-circle-button","Zoom Out"),f.addDomain(null,"zoomOutButton");let v=e.createElement();v.domId="presentationButton",v.classList.add("navigation-button","navigation-presentation-button"),v.setCode("boards.PresentationButtonModel"),v.setViewCode("boards.PresentationButtonView"),m.appendChild(g),m.appendChild(w),m.appendChild(f),u.appendChild(m),u.appendChild(v),n.appendChild(h),n.appendChild(u),n.appendChild(c);let y=e.createElement();y.domId="scaler",y.classList.add("transform-scaler"),y._set("boardWidth",2e4),y._set("boardHeight",2e4),y.style.setProperty("-cards-direct-manipulation",!0),y.style.setProperty("-cards-transform-origin","0 0"),y.setTransform([1,0,0,1,0,0]),y.style.setProperty("width","20000px"),y.style.setProperty("height","20000px"),y.setViewCode(["boards.PasteUpView","boards.RemoteCursorView"]),y.setCode("boards.PasteUpModel");let b=e.createElement();b.domId="tools",b.addDomain(null,"toolButtonPressed");let C=e.createElement();C.domId="boardTitle",C.innerHTML='<div id="boardTitleIcon" class="no-select"></div>',C.setViewCode(["boards.TitleView","widgets.WheelFilterView","widgets.GestureFilterView"]);let S=e.createElement();S.domId="toolsTab",S.setViewCode(["boards.ToolsTabView","widgets.WheelFilterView","widgets.GestureFilterView"]);let I=e.createElement();S.appendChild(I),I.innerHTML='<div class="no-select tools-label"><span>APPS</span><span id="icon">-</span></div>';let E=e.createElement();E.domId="toolsAppRegion";let V=e.createElement();V.domId="toolsUtilRegionHolder";let P=e.createElement();P.domId="toolsUtilRegion",V.appendChild(P);let x=e.createElement();x.domId="toolsScaler",x.appendChild(E),x.appendChild(V),x.appendChild(S),b.appendChild(C),b.appendChild(x),b.setViewCode(["boards.ToolsView","boards.AppButtonManager","widgets.WheelFilterView","widgets.GestureFilterView"]),o.appendChild(y),o.setViewCode(["boards.TransformView","widgets.GestureFilterView"]),o.setCode("boards.TransformModel");let M=e.createElement("CanvasElement");M.domId="annotation-canvas",M.setCode("boards.DrawModel"),M.setViewCode("boards.DrawView"),M._set("canvasId","annotation-canvas"),M.style.setProperty("pointer-events","none");let L=e.createElement();L.domId="cover",L.style.setProperty("width","100%"),L.style.setProperty("height","100%"),L.style.setProperty("position","absolute"),L.style.setProperty("left","0px"),L.style.setProperty("top","0px"),L.style.setProperty("background-color","transparent"),L.style.setProperty("z-index","10000010"),L.style.setProperty("outline","0px solid transparent"),L.style.setProperty("display","none"),L.setViewCode("boards.CoverView"),s.appendChild(r),s.appendChild(o),s.appendChild(M),s.appendChild(L);let A=e.createElement();A.domId="infoBar",A.setViewCode(["widgets.WheelFilterView","widgets.GestureFilterView"]);let F=e.createElement();F.domId="versionString",F.classList.add("no-select"),F.style.setProperty("display","none");let T=e.createElement();T.domId="presenterString",T.classList.add("no-select"),T.innerHTML="";let R=e.createElement();R.domId="beacon",R.classList.add("beacon"),R.setViewCode("boards.BeaconView");let B=e.createElement();B.domId="radar",B.style.setProperty("display","none"),B.classList.add("radar"),B.setCode("boards.RadarModel"),B.setViewCode("boards.RadarView");let k=e.createElement();k.domId="header",k.classList.add("flap"),k.setViewCode(["widgets.WheelFilterView","widgets.GestureFilterView"]);let U=e.createElement();U.domId="roomName",U.setCode("boards.RoomNameModel"),U.setViewCode("boards.RoomNameView");let q=e.createElement();q.domId="room-participants",q.setCode("boards.RoomParticipantsModel"),q.setViewCode("boards.RoomParticipantsView");let D=e.createElement();D.domId="annotationButton",D.classList.add("annotation-button"),D.setCode("widgets.Button"),D.addCode("boards.AnnotationButtonModel"),D.addViewCode("boards.AnnotationButtonView");let _=D.call("AnnotationButtonModel","svg");return D.call("Button","beViewButton","Annotation",_,"marker-button","Annotation"),D.addDomain(null,"annotationButton"),k.appendChild(U),k.appendChild(q),k.appendChild(D),A.appendChild(F),A.appendChild(T),A.appendChild(B),A.appendChild(R),e.appendChild(n),e.appendChild(s),e.appendChild(b),e.appendChild(k),e.appendChild(A),i&&y.call("PasteUpModel","loadPersistentData",i),e}],classes:[class PasteUpSaver{constructor(){this.map={},this.id=0}newId(){return(++this.id).toString().padStart(4,"0")}varName(e){let t=this.map[e];return t||(t="e_"+this.newId(),this.map[e]=t),t}save(e,t,i){let[s,o,r]=this.collectFrames(e,t,i);return this.json(s,o,r)}collectFrames(e,t,i){let s=[],o=[],r={},n=e.childNodes.slice();return n=n.filter((e=>e.hasHandler("FrameModel"))),t&&(n=n.filter((e=>t.find((t=>t===e))))),n=n.sort(((e,t)=>{let z=e=>e.style.getPropertyValue("z-index")||0;return z(e)-z(t)})),n.forEach((e=>{let t=e.getElement(e._get("target")),n=this.frameInfo(e,t,r,i),a=e.asElementRef().asKey();o[a]=n,s.push(a)})),[s,o,r]}frameInfo(e,t,i,s){let o={};return o.target=this.storeTarget(t,null,i,s?t:null),o.scriptingInfo=e.getScriptingInfo(),o.transform=JSON.stringify(e.getTransform()),o}json(e,t,i){let s=["target","scriptingInfo","transform"],o=[];for(let i=0;i<e.length;i++){let r=t[e[i]],n={};s.forEach((e=>{let t=r[e];void 0!==t&&0!==t.trim().length&&(n[e]=t)})),o[i]=n}let r=["elementClass","scriptingInfo","children","style","innerHTML","listeners","code","viewCode","text"],n={};for(let e in i){let t=i[e],s={};r.forEach((e=>{let i=t[e];void 0!==i&&0!==i.trim().length&&(s[e]=i)})),n[t.key]=s}return[o,n]}allNodesCollect(e,t,i,s,o){void 0===s&&(s=[],o=[]);let r=i(e,t);o[t.elementId]=r,s.push(t.elementId);let n=t.childNodes;for(let e=0;e<n.length;e++){let r=t.getElement(n[e].elementId);this.allNodesCollect(t,r,i,s,o)}return[s,o]}localUrl(e){if(e.startsWith("http"))return e;let t=window.location.origin+window.location.pathname,i=window.location.hostname;if(("localhost"===i||i.endsWith(".ngrok.io"))&&!e.startsWith("./apps/"))return new URL(e,"https://croquet.io/dev/greenlight/").toString();if(t.indexOf("files/v1/pitch")>=0)return new URL(e,"https://croquet.io/dev/greenlight/").toString();if(t.indexOf("croquet.io/events/")>=0)return new URL(e,"https://croquet.io/greenlight/").toString();if(e.startsWith("."))return new URL(e,t).toString();throw new Error("unrecognized URL fragment")}urlFromTemplate(e){let t=Math.floor(Math.random()*36**10).toString(36),i=e.replace("${q}",t);return this.localUrl(i)}storeTarget(e,t,i,s){let o={};o.key=e.asElementRef().asKey(),o.elementClass=e.constructor.name||"Element";let r=e.getScriptingInfo();if(s){let t=s._get("appInfo");if("IFrameElement"===e.constructor.name&&t&&t.urlTemplate){let e=this.urlFromTemplate(t.urlTemplate);r=r.replace(/^src: .*$/m,`src: "${e}"`)}}if(o.scriptingInfo=r,o.style=e.getStyleString(),o.innerHTML=e.innerHTML,o.listeners=e.getListenersInfo(),o.code=JSON.stringify(e.getCode()),o.viewCode=JSON.stringify(e.getViewCode()),e._get("_useCustomSaver")){let t=e.call(...e._get("_useCustomSaver"),this);o={...o,children:"[]",...t}}else{let t=e.childNodes,r=[];t.forEach((e=>{let t=this.storeTarget(e,this,i,s);r.push(t)})),o.children=JSON.stringify(r)}return i[o.key]=o,"TextElement"===e.constructor.name&&(o.text=JSON.stringify({runs:e.doc.runs,defaultFont:e.doc.defaultFont,defaultSize:e.doc.defaultSize})),o.key}loadTarget(e,t,i){let s=t[e],o=i.createElement(s.elementClass);if(o.setScriptingInfo(s.scriptingInfo),o.setStyleString(s.style),o.innerHTML=s.innerHTML,o.setListenersInfo(s.listeners),JSON.parse(s.children).forEach((e=>{o.appendChild(this.loadTarget(e,t,i))})),o.setCode(JSON.parse(s.code)),o.setViewCode(JSON.parse(s.viewCode)),o._get("_useCustomLoader")&&o.call(...o._get("_useCustomLoader"),this,s),"TextElement"===s.elementClass&&s.text){let e=JSON.parse(s.text);o.setDefault(e.defaultFont,e.defaultSize),o.load(e.runs)}return o}load(e,t){let[i,s]=e;return i.map((e=>{let i=t.createElement(),o=this.loadTarget(e.target,s,t),r=JSON.parse(e.transform);return i.setTransform(r),i.setScriptingInfo(e.scriptingInfo),i.setCode("boards.FrameModel"),i.setViewCode("boards.FrameView"),i.call("FrameModel","setObject",o,{x:r[4],y:r[5]}),i.call("FrameModel","beSolidBackground"),i}))}},class PasteUpSaver3{constructor(){this.map={},this.id=0}newId(){return(++this.id).toString().padStart(4,"0")}varName(e){let t=this.map[e];return t||(t="e_"+this.newId(),this.map[e]=t),t}save(e,t,i){let[s,o,r]=this.collectFrames(e,t,i);return this.json(s,o,r)}collectFrames(e,t,i){let s=[],o=new Map,r=new Map,n=e.childNodes.slice();return n=n.filter((e=>e.hasHandler("FrameModel"))),t&&(n=n.filter((e=>t.find((t=>t===e))))),n=n.sort(((e,t)=>{let z=e=>e.style.getPropertyValue("z-index")||0;return z(e)-z(t)})),n.forEach((e=>{let t=e.getElement(e._get("target")),n=this.frameInfo(e,t,r,i),a=e.asElementRef().asKey();o.set(a,n),s.push(a)})),[s,o,r]}frameInfo(e,t,i,s){let o=new Map;return o.set("target",this.storeTarget(t,null,i,s?t:null)),this.set(o,"scriptingDataObject",e.getScriptingDataObject()),o.set("transform",e.getTransform()),o}json(e,t,i){return[e.map((e=>t.get(e))),i]}allNodesCollect(e,t,i,s,o){void 0===s&&(s=[],o=new Map);let r=i(e,t);o.set(t.elementId,r),s.push(t.elementId);let n=t.childNodes;for(let e=0;e<n.length;e++){let r=t.getElement(n[e].elementId);this.allNodesCollect(t,r,i,s,o)}return[s,o]}localUrl(e){if(e.startsWith("http"))return e;let t=window.location.origin+window.location.pathname,i=window.location.hostname;if(("localhost"===i||i.endsWith(".ngrok.io"))&&!e.startsWith("./apps/"))return new URL(e,"https://croquet.io/dev/greenlight/").toString();if(t.indexOf("files/v1/pitch")>=0)return new URL(e,"https://croquet.io/dev/greenlight/").toString();if(t.indexOf("croquet.io/events/")>=0)return new URL(e,"https://croquet.io/greenlight/").toString();if(e.startsWith("."))return new URL(e,t).toString();throw new Error("unrecognized URL fragment")}urlFromTemplate(e){let t=Math.floor(Math.random()*36**10).toString(36),i=e.replace("${q}",t);return this.localUrl(i)}set(e,t,i){void 0===i||"string"==typeof i&&0===i.trim().length||e.set(t,i)}storeTarget(e,t,i,s){let o=new Map;o.set("key",e.asElementRef().asKey()),o.set("elementClass",e.constructor.name||"Element");let r=e.getScriptingDataObject();if(s){let t=s._get("appInfo");if("IFrameElement"===e.constructor.name&&t&&t.urlTemplate){let e=this.urlFromTemplate(t.urlTemplate);r.get("me").get("src")&&r.get("me").set("src",e)}}if(this.set(o,"scriptingDataObject",r),this.set(o,"style",e.getStyleString()),this.set(o,"innerHTML",e.innerHTML),this.set(o,"listeners",e.getListenersInfo()),this.set(o,"code",JSON.stringify(e.getCode())),this.set(o,"viewCode",JSON.stringify(e.getViewCode())),e._get("_useCustomSaver")){let t=e.call(...e._get("_useCustomSaver"),this);o=new Map([...o,["children",[]],...t])}else{let t=e.childNodes,r=[];t.forEach((e=>{let t=this.storeTarget(e,this,i,s);r.push(t)})),o.set("children",r)}return i.set(o.get("key"),o),"TextElement"===e.constructor.name&&o.set("text",{runs:e.doc.runs,defaultFont:e.doc.defaultFont,defaultSize:e.doc.defaultSize}),o.get("key")}loadTarget(e,t,i){let s=t.get(e),o=i.createElement(s.get("elementClass"));if(o.setScriptingDataObject(s.get("scriptingDataObject")),o.setStyleString(s.get("style")),o.innerHTML=s.get("innerHTML"),o.setListenersInfo(s.get("listeners")),s.get("children").forEach((e=>{o.appendChild(this.loadTarget(e,t,i))})),o.setCode(JSON.parse(s.get("code"))),o.setViewCode(JSON.parse(s.get("viewCode"))),o._get("_useCustomLoader")&&o.call(...o._get("_useCustomLoader"),this,s),"TextElement"===s.get("elementClass")&&s.get("text")){let e=s.get("text");o.setDefault(e.defaultFont,e.defaultSize),o.load(e.runs)}return o}load(e,t){let[i,s]=e;return i.map((e=>{let i=t.createElement(),o=this.loadTarget(e.get("target"),s,t),r=e.get("transform");return i.setTransform(r),i.setScriptingDataObject(e.get("scriptingDataObject")),i.setCode("boards.FrameModel"),i.setViewCode("boards.FrameView"),i.call("FrameModel","setObject",o,{x:r[4],y:r[5]}),i.call("FrameModel","beSolidBackground"),i}))}},class AppButton{constructor(e,t){this.managerView=e;let{label:i,iconName:s,urlTemplate:o,pressHold:r,viewBox:n}=this.appInfo=t;this.urlTemplate=o,this.dom=document.createElement("div"),this.dom.classList.add("tool-button"),e.setIconAndLabel(this.dom,s,i,n),this.noPressHold=!r,r&&(this.containerDom=document.createElement("div"),this.containerDom.classList.add("tool-button-secondary-container"),this.containerDom.appendChild(this.dom),this.triangle=document.createElement("div"),this.triangle.classList.add("tool-button-triangle"),this.containerDom.appendChild(this.triangle)),this.pressHoldDuration=400,this.startTime=Number.MAX_VALUE,this.pressHoldEvent=new CustomEvent("pressHold"),this.pointerEnterHandler=e=>this.pointerEnter(e),this.pressingDownHandler=e=>this.pressingDown(e),this.pointerUpHandler=e=>this.pointerUp(e),this.notPressingDownHandler=e=>this.notPressingDown(e),this.pressHoldHandler=e=>this.pressHold(e),this.dom.addEventListener("pointerenter",this.pointerEnterHandler,!1),this.dom.addEventListener("pointerdown",this.pressingDownHandler,!1),this.dom.addEventListener("pointerup",this.pointerUpHandler,!1),this.dom.addEventListener("pointerleave",this.notPressingDownHandler,!1),this.dom.addEventListener("pressHold",this.pressHoldHandler,!1),this.toolSelectionState=null,this.favoritesMenu=null,this.isShowingSecondary=!1}setSecondaryButton(e,t){t.isSecondaryButton=!0,t.appName=e,this.secondaryButton=t,this.triangle.style.removeProperty("display")}getName(){return this.appInfo.appName}pointerEnter(e){if(!this.toolSelectionState)return;let{name:t,showingMenu:i}=this.toolSelectionState;!0===i&&t!==this.getName()&&this.startFavoritesMenu()}pressingDown(e){if(this.noPressHold)return;if(1!==e.buttons)return;let t=this.toolSelectionState,i=t&&t.name===this.getName()&&t.showingMenu||this.isShowingSecondary;requestAnimationFrame((()=>this.timer())),this.startTime=i?Number.MAX_VALUE:Date.now(),e.preventDefault(),this.held=!1;let s=this.dom.getBoundingClientRect();this.pressingPosition={x:s.right+10,y:s.top+10}}notPressingDown(e){if(this.noPressHold)return;cancelAnimationFrame(this.timerID),this.startTime=Number.MAX_VALUE,window.topView.querySelector("#tools").call("ToolsView","circle",0)}pointerUp(e){this.notPressingDown(e),this.held||this.click()}timer(){let e=Date.now(),t=window.topView.querySelector("#tools");if(e-this.startTime<this.pressHoldDuration){if(this.timerID=requestAnimationFrame((()=>this.timer())),e-this.startTime<.3*this.pressHoldDuration)return;let i=(e-this.startTime)/this.pressHoldDuration*2*Math.PI;t.call("ToolsView","circle",i,this.pressingPosition.x,this.pressingPosition.y)}else this.held=!0,this.dom.dispatchEvent(this.pressHoldEvent),t.call("ToolsView","circle",0)}click(){this.publishPress({appInfo:this.appInfo})}pressHold(){this.showSecondary()}publishPress(e={}){let t=this.dom.getBoundingClientRect();this.managerView.publishToAll({name:this.getName(),buttonClientRect:t,...e})}updatedToolState(e){let t=e&&e.name,i=this.getName();if(t===i&&e.selected)this.dom.classList.add("app-selected");else{this.dom.classList.remove("app-selected");let s=this.secondaryButton&&this.secondaryButton.appName;s&&(!t||e.selected&&t!==i&&t!==s)&&this.hideSecondary()}this.toolSelectionState=e}dropHighlightedTool(e){this.getName()===e?this.dom.classList.add("tool-button-drophighlight"):this.dom.classList.remove("tool-button-drophighlight")}toolFavoritesChanged(e){e&&this.getName()!==e||!this.favoritesMenu||this.isMenuBeingEdited()||this.startFavoritesMenu()}startFavoritesMenu(){let e=this.makeMenu(),t=this.dom.getBoundingClientRect();e.style.setProperty("position","absolute"),e.style.setProperty("left",t.right+10+"px"),e.style.setProperty("top",t.top+"px"),this.publishPress({menu:e})}showSecondary(){let e=this.secondaryButton.dom;e.style.setProperty("margin-left","3px"),this.dom.parentNode.appendChild(e);this.triangle.style.setProperty("display","none"),this.isShowingSecondary=!0,this.publishPress({menu:{dummy:!0}})}hideSecondary(){if(!this.isShowingSecondary)return;this.isShowingSecondary=!1;let e=this.secondaryButton.dom;e.parentNode.removeChild(e),this.triangle.style.removeProperty("display")}makeMenuItem(e,t){let i=document.createElement("div"),{label:s}=t;if(null===e)return i.classList.add("no-select","fave-menu-title"),i.innerHTML=`<span>${s}</span>`,i.addEventListener("pointerdown",(e=>e.preventDefault()),!0),i;i.classList.add("no-select","fave-menu-item"),i.innerHTML=`<span class="fave-menu-label">${s}</span>`;let o=i.firstChild;i.q_pointerup=t=>this.menuSelected(e),i.addEventListener("pointerup",i.q_pointerup,!0),i.addEventListener("pointerdown",(e=>"true"!==o.getAttribute("contentEditable")&&e.preventDefault()),!0);let r=document.createElement("div");r.classList.add("no-select","fave-menu-item-wrapper"),r.appendChild(i);let n=document.createElement("div");n.classList.add("no-select","fave-menu-icon-holder"),n.innerHTML='<div class="fave-menu-icon"><svg viewBox="0 0 24 24" class="fave-menu-icon-svg"><use href="#img-edit"></use></svg></div>',n.addEventListener("pointerdown",(e=>e.preventDefault()),!0),n.addEventListener("pointerup",(i=>this.menuEdit(o,e,t.sessionFave,t.userFave)),!0),r.appendChild(n);let a=document.createElement("div");a.classList.add("no-select","fave-menu-icon-holder");let l=this.managerView.svgStarFunc(t.sessionFave?"session":null);a.innerHTML=`<div class="fave-menu-icon">${l}</div>`,a.addEventListener("pointerdown",(e=>e.preventDefault()),!0),a.addEventListener("pointerup",(i=>this.menuSetFave(o,e,"session",!t.sessionFave)),!0),r.appendChild(a);let d=document.createElement("div");return d.classList.add("no-select","fave-menu-icon-holder"),l=this.managerView.svgStarFunc(t.userFave?"user":null),d.innerHTML=`<div class="fave-menu-icon">${l}</div>`,d.addEventListener("pointerdown",(e=>e.preventDefault()),!0),d.addEventListener("pointerup",(i=>this.menuSetFave(o,e,"user",!t.userFave)),!0),r.appendChild(d),r}makeMenu(){let e=document.createElement("div");e.classList.add("fave-menu","no-select");let t=this.getName(),i=this.makeMenuItem(null,{label:t.toUpperCase()});e.appendChild(i);let s=window.topView.querySelector("#scaler").call("PasteUpView","getAppFavorites",t).map((e=>{let{userName:t,sessionName:i}=e;return{label:i&&t&&i!==t?`${i} | ${t}`:i||t,sortLabel:i||t,...e}}));s.sort(((e,t)=>e.sortLabel<t.sortLabel?-1:e.sortLabel>t.sortLabel?1:e.sessionName?-1:1)),s.forEach((t=>{let{label:i,url:s,userName:o,sessionName:r}=t,n=this.makeMenuItem(s,{label:i,sessionFave:!!r,userFave:!!o});e.appendChild(n)}));let o=document.createElement("div");return o.classList.add("fave-menu-holder"),o.setAttribute("editInProgress","false"),o.style.opacity=1,o.appendChild(e),o.onDismiss=()=>{this.favoritesMenu===o&&(this.favoritesMenu=null)},this.favoritesMenu=o,o}isMenuBeingEdited(){let e=this.favoritesMenu;return!!e&&"true"===e.getAttribute("editInProgress")}menuSelected(e){this.isMenuBeingEdited()||this.publishPress({url:e})}menuEdit(e,t,i,s){let o=this.favoritesMenu;if(!o||this.isMenuBeingEdited())return;o.setAttribute("editInProgress","true"),e.setAttribute("contenteditable","true"),e.q_originalText=e.textContent,e.q_editKeyDown=t=>this.editKeyDown(e,t),e.q_editFocusLost=o=>this.editFocusLost(e,t,i,s),e.addEventListener("keydown",e.q_editKeyDown,!0),e.addEventListener("blur",e.q_editFocusLost,!0);let r=document.createRange();r.selectNodeContents(e),r.collapse(!1);let n=window.getSelection();n.removeAllRanges(),n.addRange(r),e.focus()}editKeyDown(e,t){"Enter"===t.code?(t.preventDefault(),e.q_userAction="accept",e.blur()):"Escape"===t.code&&(t.preventDefault(),e.q_userAction="cancel",e.blur())}parseFaveText(e){let t=e.split("|").map((e=>e.trim())),i=t[0];return[i,t.length>1?t[1]:i]}editFocusLost(e,t,i,s){let o=this.favoritesMenu;if(!o)return;o.setAttribute("editInProgress","false"),e.removeAttribute("contenteditable"),e.removeEventListener("keydown",e.q_editKeyDown,!0),e.removeEventListener("blur",e.q_editFocusLost,!0);let r=e.q_originalText;delete e.q_originalText;let n=e.q_userAction;delete e.q_userAction;let a=e.textContent.trim(),[l,d]=this.parseFaveText(r),[h,c]=this.parseFaveText(a);if("accept"!==n||!h||!c||h===l&&c===d)return e.textContent=r,void(n&&this.startFavoritesMenu());let u={appInfo:this.appInfo,url:t},m=s||h!==c;(i||h!==c)&&(u.proposedSessionName=h,u.sessionFave=!0),m&&(u.proposedUserName=c,u.userFave=!0),window.topView.querySelector("#scaler").call("PasteUpView","setFavorite",u)}menuSetFave(e,t,i,s){if(this.isMenuBeingEdited())return;let o={appInfo:this.appInfo,url:t};"session"===i?(o.sessionFave=s,s&&(o.proposedSessionName=this.parseFaveText(e.textContent)[0])):"user"===i&&(o.userFave=s,s&&(o.proposedUserName=this.parseFaveText(e.textContent)[1])),window.topView.querySelector("#scaler").call("PasteUpView","setFavorite",o)}},class UtilityButton{constructor(e,t){this.managerView=e;let{label:i,iconName:s,buttonAction:o,hoverInverted:r,hoverSuppressed:n}=t;this.buttonAction=o,this.dom=document.createElement("div"),this.dom.classList.add("tool-button"),e.setIconAndLabel(this.dom,s,i,null,r),n&&this.dom.classList.add("hover-suppressed"),this.dom.addEventListener("pointerup",(e=>this.click()),!1)}click(){window.topView.querySelector("#pad").call("TransformView",this.buttonAction)}},class FileButton{constructor(e,t){this.managerView=e;let{label:i,iconName:s}=t;this.dom=document.createElement("div"),this.dom.classList.add("tool-button"),e.setIconAndLabel(this.dom,s,i),this.setUpInput()}async setUpInput(){let e=window.topView.querySelector("#scaler"),t=(await e.call("PasteUpView","getAllDroppableFileFormats")).types.concat(["text/*"]).join(","),i=document.createElement("div");i.style.display="none",i.innerHTML=`<input type="file" id="field" name="field" accept="${t}">`;let s=i.querySelector("input");s.addEventListener("change",(e=>this.handleInputChange(e))),this.dom.appendChild(i),this.dom.addEventListener("pointerup",(e=>s.click()),!1)}handleInputChange(e){this.managerView.publishToAll({name:null});let t=e.target.files;t.length&&this.managerView.publish(this.managerView.sessionId,"fileUpload",t)}},class AssetLibrary{avatar(e,t,i,s){return`\n<svg width="32px" height="32px" viewBox="0 0 32 34" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 64 (93537) - https://sketch.com --\x3e\n    <title>avatar/cursor/small</title>\n    <desc>Created with Sketch.</desc>\n    <defs>\n        <path d="M17,0 L17.0002994,0.0307604489 C25.3708878,0.547104153 32,7.49939602 32,16 C32,24.836556 24.836556,32 16,32 C7.49939602,32 0.547104153,25.3708878 0.0307604489,17.0002994 L0,17 L0,0 L17,0 Z" id="path-1"></path>\n        <filter x="-15.6%" y="-12.5%" width="131.2%" height="131.2%" filterUnits="objectBoundingBox" id="filter-2">\n            <feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n            <feGaussianBlur stdDeviation="1.5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.203780594 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix>\n            <feOffset dx="0" dy="0.5" in="SourceAlpha" result="shadowOffsetOuter2"></feOffset>\n            <feGaussianBlur stdDeviation="0.5" in="shadowOffsetOuter2" result="shadowBlurOuter2"></feGaussianBlur>\n            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.304223121 0" type="matrix" in="shadowBlurOuter2" result="shadowMatrixOuter2"></feColorMatrix>\n            <feMerge>\n                <feMergeNode in="shadowMatrixOuter1"></feMergeNode>\n                <feMergeNode in="shadowMatrixOuter2"></feMergeNode>\n            </feMerge>\n        </filter>\n    </defs>\n    <g id="avatar/cursor/small" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Combined-Shape">\n            <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>\n            <use fill="${t}" fill-rule="evenodd" xlink:href="#path-1"></use>\n        </g>\n        <path d="M17,2 L17.0008661,2.0352252 C24.2657313,2.54839185 30,8.60454082 30,16 C30,23.7319865 23.7319865,30 16,30 C8.94734804,30 3.11271995,24.7850199 2.14189822,18.0008423 L2,18 L2,2 L17,2 Z" id="Combined-Shape" fill="${i}"></path>\n        <text id="TD" font-family="Poppins-Medium, Poppins, sans-serif" font-size="13" font-weight="500" fill="${s}">\n            <tspan x="7.0" y="20">${e}</tspan>\n        </text>\n    </g>\n</svg>`}faveIndicator(e){let t,i;switch(e){case"session":t=i="#AA0000";break;case"user":t=i="#EFCF00";break;case"menu_add":t=i="black";break;default:t="transparent",i="black"}return`\n<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n         width="16px" height="16px" viewBox="0 0 36.09 36.09" style="enable-background:new 0 0 36.09 36.09;" xml:space="preserve"\n        >\n<g>\n        <path style="fill:${t};stroke:${i};" d="M36.041,13.907c-0.123-0.377-0.456-0.646-0.85-0.687l-11.549-1.172L18.96,1.431c-0.16-0.364-0.519-0.598-0.915-0.598\n                s-0.755,0.234-0.915,0.598l-4.683,10.618L0.899,13.221c-0.394,0.04-0.728,0.31-0.85,0.688c-0.123,0.377-0.011,0.791,0.285,1.055\n                l8.653,7.736L6.534,34.044c-0.083,0.387,0.069,0.787,0.39,1.021c0.322,0.231,0.75,0.254,1.091,0.056l10.031-5.839l10.031,5.839\n                c0.156,0.091,0.33,0.136,0.503,0.136c0.207,0,0.413-0.064,0.588-0.191c0.32-0.23,0.474-0.633,0.391-1.02L27.105,22.7l8.652-7.737\n                C36.052,14.698,36.164,14.284,36.041,13.907z"/>\n</g>\n</svg>\n`}greenlightLogo(){return"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABb5JREFUeNrsWUtPW0cUPvdlDI0EqKhQAZFBCKWhUo1EdqmKK6VpQ6WSXXcNK5ahvyDpL2hZsiL5AW2hmy7ShStVAZRC6TZU6t2AQUpqGz+v76vnzMylxjXch21gkbEOA76Xud+c+c53zswFeNPetDOb1K6BFhcXZ7Ej+wCtT3w9K3pdGLVfxe/plZUV/cJBI9B57L5Cm484xC7aMtoaTiDXUdAI9gF2j9ASbVooAryMwB+3HTSCTWK3ipbsEF3J8wsIfve8m5SQ3v0ZbaiDMUZjfzkzM3O0vb2925KnETB598EFi8R99PhaJNCXBNjjeaoZVWQfwEuXBBiEbK4ihr7AoEXQfXvJeSQpVCqwp1evSAJcQgcmfEELWiTh6rRV30BE0Nm6VByqjY2Pw/DwMFwfvQ4ufvb3D+DwMAMH+/tQLBZbAT7tBaV6hh6HBjw19T7c+eQOjI6MgCwr4LoOmKYFN268B7VaDYqFAuzs7MDm1iaY+HeIlkZ7Wq8iapObvggLeG7uc0ilUtAV7wJF5oxzHAckSWa967rw1rVrMHPrFrwzOAi/PHsG+bxvqfFEpPbdc3VayEs2DOB7CPhjAtyFgBUZgUoMJIG1LJt5uWbW0LsmVKpVKJVKkMkcwE/r63jdahxOFwXUk/MKqEZPz4YBPDExAR/evg2qxochsF7PDD8yTkRxFHAUByelMOvt7YXp5DS8+P1FPQWWz8qAfqBDKcZn9+YgFtMIJQMoMAvAwLwuoxFlbDQZTUG+Uz84NAj9/f3pbDa7ELaubpS8j4L+48DAAAwiPwkYSKdFiL7zPh4LvQl4XxHfxxNjepSNgBxVfyYnJxmHPUo0a9zfdbQRPxzbQbORVtpslGc30iNwUc9lTVCBFAK96JAHxRwclDzXoYDk/Ka/KThtx8YANFEOaxiUxcSFgnaEQhAoSXI4BWROCcZvx7suDD1ro1oQWMMwmJmmCe0AHbg56DECYsnEUz6M5Ep11zlom8DivZRoaih7RqUKlXIFKpUKWKaltwP0blAFOcxkUH9NHohEVaQL+5V+uO4JaJocabRRM6BcLkGxVMR0XmDAy5Uy5YbHIfCSfutqk8I7UNN1HV6/egVvo4pojgqO6qA6yFwdXM5pCjiaGFGhWCyxVH6cP4bCcYElnONCIdGs9PRJ6bocFTS1jc0NtsxVBFWtGqwngFWjClWkQRmvlTEDFo7zUMC0nctmIZfLosfLjM+UHdtBjz/DnGH8gQXQKFZziUQCVFVlSYPowqhhW3wCVQ48jx4mwAX0Nqv+DjKRyz21ifsfBQtElwXZjz98D3fvforgR1iK9ooliwUe8bjCOEyUqOAESP5e7u2xVVAVlWl9yydMQWpperCNfDVRb2tGjanD1M2bkEwmGRBHqIVhcKUguhC/X2f/YYCpiKICKxaL4f08rQdstNFNN5O8tSCbWV5rcCMa/Pb8OWxsbcG7Q0MwipsAW8gdtWwuB4dHR0iRPHR3d0MPGtduNKKU656oUFSdfhoENCURUguq4ojP5Dny+t+oKi/3/gLLtk7qELoe0zSIx+OgYS+L4omS0emULwU6iPkfaHI/UiR9XpnKih98IHFYczWmzQwYLjdlPaIO7Vy8ao9Vd3gv3UOmqcRlHriyVFdUtZgRv/GrrT0eSrIGio2lJ4EWKZtSuFcseZMkUGyiBFTw2FObsMegTSOAvI3dd/5Fk8wCiZa8C70cR4p0IwWIt571dPfwvodzmWhE95Pnw/A4aO3heds3rbP6uRGA244T8JD1tNij3Q+bJU+JaQcA+24CxK4iBf+9euj0gWO6LTsXsYWfDjpgxEbxM4bPIgct+K1u2DcBSyLN97UJLDni68azDXGUQc9ZapYRQ7NODEiDPWwB/Jo4Mkj7PMs7uZ1tCXTDoPNiB5/00XVdbDDWIcKruLoXUwstgz7HO94K6FHfFZ6xwhDm1d2Vav8KMADaY/Xd3BmUdwAAAABJRU5ErkJggg==')"}},...t.classes]};const s={expanders:[class MiniBrowser{init(){let e=this.querySelector("#iframe");if(!e){if(this.style.setProperty("background-color","white"),this.style.setProperty("display","flex"),this.style.setProperty("flex-direction","column"),this.style.setProperty("align-items","center"),this.style.setProperty("user-select","none"),!this._get("useExternalAddress")){let e=this.createElement("TextElement");e.domId="address",e.style.setProperty("-cards-text-margin","0px 4px 0px 4px"),e.style.setProperty("-cards-text-singleLine",!0),e.style.setProperty("height","22px"),e.style.setProperty("width","80%"),e.style.setProperty("border","1px solid black"),e.style.setProperty("margin","4px"),e._set("enterToAccept",!0),this.subscribe(e.id,"text","urlFromText"),this.appendChild(e);let t=this.createElement();t.setViewCode("minibrowser.QRView"),t.style.setProperty("position","absolute"),t.style.setProperty("top","5px"),t.style.setProperty("right","4px"),t.style.setProperty("width","24px"),t.style.setProperty("height","24px"),t.style.setProperty("background-image",`url(${this.getLibrary("minibrowser.QRIcon").iconString()})`),t.style.setProperty("background-size","24px 24px"),this.appendChild(t)}e=this.createElement("IFrameElement"),e.domId="iframe",e.classList.add("boards-iframe","no-select"),e.style.setProperty("width","100%"),e.style.setProperty("flex-grow","10"),e.style.setProperty("border","0px solid gray"),e._set("allow","camera; microphone; encrypted-media"),this.appendChild(e),this.cover=this.createElement(),this.cover.domId="iframeCover",this.cover.classList.add("boards-iframeCover","no-select"),this.cover.style.setProperty("width","100%"),this.cover.style.setProperty("height","100%"),this.cover.style.setProperty("position","absolute"),this.appendChild(this.cover),this._set("_useSetExtent",["MiniBrowser","setExtent"]),this._set("menuItems",[{value:"OpenInANewTab",label:"Open in a New Tab",traits:null,method:"openTab"},{value:"BeTransparent",label:"Be transparent",traits:null,method:"beTransparent",asset:"make-trans"}])}this.subscribe(this.id,"beTransparent","updateTransparency"),this.subscribe(this.id,"setAppInfo","setAppInfo"),console.log("MiniBrowser.init")}setCoverContent(e){if("googleworkspace"===e)this.cover.innerHTML=this.getLibrary("minibrowser.GoogleContent").coverPage()}setExtent(e,t){void 0===e&&void 0===t&&(e=parseFloat(this.style.getPropertyValue("width")),t=parseFloat(this.style.getPropertyValue("height"))),this.style.setProperty("width",e+"px"),this.style.setProperty("height",t+"px");let i=this.getAddressBar();i&&i.setWidth(e-112)}setAppInfo(e){this._set("appInfo",e);let t=e&&e.transparent;this.updateTransparency(t);let i=!(e&&e.noSandbox);this.setSandbox(i)}setSandbox(e){let t=this.querySelector("#iframe");t&&e&&t._set("sandbox","allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-same-origin allow-scripts")}setCreatingUser(e){this._set("creatingUser",e)}getAddressBar(){if(!this._get("useExternalAddress"))return this.querySelector("#address");let e=this._get("addressBarInfo");return e?this.getElement(e):null}getURL(){let e=this.querySelector("#iframe");return e&&e._get("src")}updateTransparency(e){if(void 0!==e){this._set("transparent",e);let t=this._get("menuItems");function updateMenuItems(t){let i=t.findIndex((e=>"beTransparent"===e.method||"beOpaque"===e.method));return[...t.slice(0,i),{value:e?"BeOpaque":"BeTransparent",label:e?"Be opaque":"Be transparent",method:e?"beOpaque":"beTransparent",asset:e?"make-opaque":"make-trans"},...t.slice(i+1)]}this._set("menuItems",updateMenuItems(t))}let t=this.querySelector("#iframe");this._get("transparent")&&t&&t._get("src")?this.style.setProperty("background-color","#FFFFFF02"):this.style.setProperty("background-color","white"),this.publish(this.id,"updateTransparency")}urlFromText(e){this.url(e.text)}url(e,t){"string"!=typeof e&&(e=""),e=e.trim();let i=this.querySelector("#iframe");if(!i)return;if(0===e.length)return i._set("src",""),this.announceUrlChanged(),this.updateTransparency(),void this.removeCover();e.startsWith("https://")||e.startsWith("http://")||(e=window.location.protocol+"//"+e),"https:"===window.location.protocol&&e.startsWith("http://")&&(e=window.location.protocol+"//"+e.slice("http://".length)),console.log("showing: "+e);let s=this.getAddressBar();s&&(s.value=e),i._set("src",e),t||this.announceUrlChanged(),this.updateTransparency(),this.removeCover()}announceUrlChanged(){this._set("appInfo",null),this.publish(this.id,"urlChanged")}removeCover(){this.cover&&(this.cover.remove(),this.cover=null)}comeUpFullyOnReload(){let e=this.querySelector("#iframe");if(!e)return;let t=parseFloat(this.style.getPropertyValue("width")),i=parseFloat(this.style.getPropertyValue("height")),s=e._get("src");this.url(s,!0),"string"==typeof s&&s.indexOf("cobrowser-single")>=0&&!this._get("appInfo")&&this._set("appInfo",{label:"web page",iconName:"link.svgIcon",urlTemplate:"../cobrowser-single/?q=${q}",order:10,noURLEdit:!0,noSandbox:!0}),this.setExtent(t,i)}},class MiniBrowserView{init(){this.subscribe(this.model.id,"updateTransparency","updateTransparency");let e=this.model.call("MiniBrowser","getAddressBar");if(e){let t=this.model._get("appInfo"),i=!t||!t.noURLEdit;this.future(100).publish(e.id,"setButtonVisibility",i),this.model.call("MiniBrowser","getURL")||this.future(100).publish(e.id,"setEditState",!0)}console.log("MiniBrowserView.init")}getLoadedURL(){let e=this.dom.querySelector("#iframe");return e&&e.src}setAppInfo(e){this.publish(this.model.id,"setAppInfo",e),e&&e.transparent&&this.future(1e3).updateTransparency()}getAppInfo(){return this.model._get("appInfo")}updateTransparency(){let e=this.model._get("appInfo"),t=e&&e.transparent,i=this.dom.querySelector("#iframe");Croquet.Messenger.ready&&Croquet.Messenger.send("transparency",t,i.contentWindow)}sendCreatingUser(){let e=this.model._get("creatingUser"),t=this.dom.querySelector("#iframe");Croquet.Messenger.ready&&Croquet.Messenger.send("creatingUser",{userId:e},t.contentWindow)}},class QRView{init(){this.addEventListener("click","click"),this.dom.addEventListener("pointerdown",(e=>this.pointerDown(e)))}pointerDown(e){e.stopPropagation()}getBrowserView(){return this.parentNode.parentNode.querySelector("#miniBrowser")}getBrowser(){return this.getBrowserView().model}getLoadedURL(){let e=this.getBrowserView();return e&&e.call("MiniBrowserView","getLoadedURL")}show(){if(this.qrElement)return;let e=this.getLoadedURL();if(!e)return;const t=this.qrElement=document.createElement("div");t.style.position="absolute",t.style.width="148px",t.style.height="148px",t.style.backgroundColor="white",t.style.top="8px",t.style.left="-154px",t.style.zIndex="10";const{App:i}=Croquet,s=i.sessionURL;i.sessionURL=e;const o=i.makeQRCanvas();i.sessionURL=s,o.style.position="absolute",o.style.top="10px",o.style.left="10px",t.appendChild(o),this.dom.appendChild(t)}hide(){this.qrElement&&(this.dom.removeChild(this.qrElement),delete this.qrElement)}toggle(){return this.qrElement?(this.hide(),!1):(this.show(),!0)}click(e){let t=this.toggle();this.frameViewId&&this.publish(this.frameViewId,"qrState",t)}setFrameView(e){this.frameViewId=e}}],functions:[function beBrowser(e,t){e.setStyleClasses(".no-select {\n    user-select: none;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n}");let i=e.createElement();i.setCode("minibrowser.MiniBrowser"),i.setViewCode("minibrowser.MiniBrowserView"),i.style.setProperty("-cards-direct-manipulation",!0),i.call("MiniBrowser","setExtent",800,600),i.setTransform("1,0,0,1,0,0"),e.appendChild(i)}],classes:[class QRIcon{static iconString(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAASAAAAEgARslrPgAAC5VJREFUeNrtnHuMHVUdxz9z5nHvlu6jLe2W7sJufQDbUiBbGlPEKtYqT6UYMRBiNEX+Mf7jOyox8RklGk2MgmLUGJUoYMRoNBo0igYSWWoUMIUWZLdLS7fA9t6ZO3ce5/jHmbk7u7RlZ+7c3VbvN5nc2bv3MfO5v/N7nTMDXXXVVVddddVVV1111VVXSy1juQ9gzy23prsC6AH6ksesQqAG1IEYUN+76zvLfejAMgBMgBnAGcBG4HzgIuC1wAZODPAYMAPsB/4FPA48CbwAxMsFdEkAZqxsBbAFeCvwpgTeOsDK+ZEKeBF4Bvgb8FvgITTMJbXOjgLMgOsHdgE3AZcBZ5b83S6wF7gH+AXwLEsEsmMAE3g9wJXA+4EdaAvspGL00P4h8GPgEEAnQZYOMGN1W4CPALuB3o6dwfEVoYf07ejhHXQKYqkAE3gOcD3wGbSPW069CNwBfB14Hsq3RrOsD0rg9QEfBz4HDC8No5OqB7gUGEP7yJnx8a08OvFIaV9QCsAE3lrgS8AH0SnKqSIBnAdcgoY4XSbEtgEm8Faj/c37AHuZQL2ShtEQJygRomjnzZlI+yngPZToEjqkceCb6CFdigqfcAJPAB8APoEOHqeDhoGzgQfGx7e67VphWxYIXA58jJeXXqe6rgE+BNiZtKuQCllg8qXrgW+g873TTQawGfgnsK8df5jbAjPNgPeiq4vTVauADwOD7XxI0SF8Hjrilh40lFLH3Tqky4B3w7wKKpdydUEy1ncjuv1UmqSUCCFYsWIFPT09VKtVAKIowvM8fL9BGEYAGEZpBZSFHkn3Agc7DjDRRuAGSioDlVI4jsPo6Ajnnz/GyMg5DAwMYFkmMpYEQcCxWo1Dhw6xf/9+Dhx4mmPHjpUJcQtwFfDdPbfcmrvUWzTAjInvokTrGx0d4Y07drB58yZW9vYiDAOlFHEcE8UxYRjS29fH4OAg5557HtPT00xMTLBv3z6azWYZIC107X43uuvdGYCJetApQFu+TymFaZps23YJV1xxBesH1yGEaMFQSrX2pZTEcYwQAqfiMDw8xMBAP+sHB3no4Yep1WplQNyGjsoP5X1j3iDyauDido/WNE22b9/O7uuuY/3gIEKIFsB5W/K8KUxMU2CZJkIIKpUKY5vGeP2l21m5cmUZQWYNSUaRN5gsCmDmQy9G53+FpZRiy4VbuPLKt9Hb1zvv+fSxFXmVQhgGpmlqiELo/WQb3TjKRRduwbZLKb9fB1TzvimvBW6lWOBpwVm7di27du6kr68PFkCTUmYA6okPwzAQwkCYomWp2W1kZIThoaEyrHALeqqhYwArwKZ2jlAIwbZtlzA0tEGDAxSK7Lmn8DDSdEUPZ2EYGCKBKQTC0Jtt24ycc3Yr7WlDZ6IzjI4BXAOcVfTolFIMDAxwwebN2t+d4HXa/yX7pPsGpH6ROR+pP0Sxsnclq1evatcKe4FzOglwdQKxMMDh4WFWr1nDwtM8XhA1MOZnmooWvOxzSikMDFb19yNEW70RCz0vnSuQ5PnGXtqYHDIMg6GhIe3wF1iKUrzMevTQVq2/Ws9l9xO/KWWM4zhYVmH3nCq3geT1gZWiR2ZZFgOrBjCMxPclUVYp1fKD8wJI9v/Zv2UKTRLHEXEUE0UxRhKt29Rqcua4bf9ki5VpmlQrFaRUGEhUUnEglf4ZjTnDVAkobWFz0VkqhVQanoxjoigijEKiKERJ2api2kisTXKWqEsGMC3PNBQwhAIpEQKUXOjbssNTztuPY12ZhFFIGIaEQaC3MNQ/SHk18qkFMIoi6nVXAzEMjNgAU4CUGIaReDaD1N/JzFCVUiKVJIoSqwtDwmaTZrOJ7zdpBgFhFBJL2W6HQ7YOoAMAG4BHwbmPOI45cuQIURhiWiaxkQSCtITLvDYdukrJFsgoiohCbXVB08dvNvEbPk2/QZBYYBzH7eFLVnp1CmC6Pm+g2LEZTE5OUnddVq48Q6cgpmr5rBSg0gTR7lG24IVBSBCENP0GfqNBo9Gg4Xk0fJ84ivGbQRkAj+R9Q54o/AJwtOiRGQYcPnyYqamDRFFMGEXaqiIdSeNYEifBQfu5aA5cM6AZBDT8Bp7n4Xkebr2O57k0/SZSSequ224iHQHTkG/5Rx4LfBHdtb2oGECDRqPB3r17Oeus9VQqVUxTYJoCwxCItLLIWF4cS+IoIghCfF9bnOu51Gr1BGADhaLR8HFdr9221izwdN435QHYRC8du6roERqGwb59+xgdHWVsbAzTFAjT1HVuMowVoKS2xhRe0PTx/Qae16Ber1Gr1ai7LlEcAQYzR18oI4Ac6jRAgL+jTb1w9PZ9nwcf/As9PVWGNmxo9fyyzVSZwNNpio62jUYD13Vx6y6u5xJFEZZpMTU9zUuzs0lt3BbCf6DdVC4tKut+dOIRxse3go5Q76BgIEm7y7OzLzF98CAD/f1UKxUdRYMmQZKazAUKD9f1qNdd6vUa9Vodz/OQUmGagmenJnl2cmouEBlG0WEcA3cCD6fnWypAIAVYQzceNxeFl6YjR4/OcODAAYQQ9FSrRFGE7/sanKeDheu61Ot13HoN13UJggDDEPi+zxNPPMHTzzyDlBJDzMEr2FCYBr4IPN+xSaVETeDXaCtcdD6Y1r6yFWUjZBwzPf0c9913H6Ojo2zetIm169bh2DZSpmWaHsZRFBHHEs9zmZyc4qn9T+F5DXp6eqhUK63+oGEI7RLyW+Gf0Sv+cyvXNyVtnrMTiIte0pHCizLlVxA0aTR8Gg09XE1TsGb1GtauPZOBVauoVqsopYiiiNnZWWZmjjIzcwTP87BshxU9K6j2VKlUKtiOg+M42LaNaVqYpplnKNeBm4FfFlm9WiQYTKEnoi9Y9A+QnIweZknQEALTtHAcbchBEDB96DkmpyaJ4xip0uJON1UNIXBsB8ep4lQcLNua19qfA6YrGKUW7RP/CDxQgENyfDmVWOG5wP3oJR6LUtq3i6KYKAwJwoAoGZ6tYRpFRHHceq2UMgGvJ5Ms08KyLSzLwrJtbMvCtm1sp4JlWa3Jpha0bIm4oFxMdAxtfb8quna6aDryJHAXeknvoj4jde6mqWtgJ+nfWVGEbdvEcawtLzOxBHON1nSa0xQmlpXMzFlWa8ia5gJLXNwQvhf4Q0EG+muKvCmzJvonwFvyvHdehyUNKom1KSmRmSnN1kEmOZ6RgNGgtFXq2To95SmEMXdKr2x9jwPvSh4Lr94v1MJN8kIP7Q93kaPVn003RGae17IsLMtubbadbg62Y+MkgUIHizRgmLqSEcfxdycBaBjGsWq1etudd3zr97t3X8/Xvnp7IXjQ/grVPwFfRre6Fq0UYAovhZUCqlQqOJUKjlPR+04lgTYHz0r9n2VhCnPeyoYTWFyqsFKpfHvnzjffc+NNN3Pbpz/ZFoC2ap9kKK8AvoC+vOFUX2QO8JjjOFcfOTLzn5//7Kdtr6tpywITv+EBnwd+QM5m5DLJD4Kg2d/fV8oSuXaHcArxKPoKpe+jmw2nskqdNGkbIMyD+FHgK+j86v9CpQCEFsSXgM+i/WGh2vJ0U2kAoQWxCfwInWPdjfaR/7MqPWo+OvFImiceBn4H/Ju5hUlLNo16Ej2HLgDqy36t3MmUWGMdbYXvBPYAvyG5r8ESgFoSdTRvy1ijj74q6H5092M6eUkV3VfMexwBOnm3yB9VS7XAJRlSmTqzvueWW/+KvtNGP7q3eCH66smN6GG+lpdfb+yjb3kyjb7tyWPoK9AvR9+TYYwCy3PL0Kl04x2HOYtc+MNKdHDyk8dUAn2p1g60m9iBvo3Kyc5rArgaOFTG5f/LDrBdZX6AKnqu5lrg7ejlyMdbjtcFeCJlLkUbRN/Y5wbgDegsID3XLsDFKHM1/Tg6J70WeBV6bvsa4HAX4CKUgDSB16DB1dA35ml2AebQwoXjp8rd37rqqquuuuqqq66WSf8FikiWcfSaqpUAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjAtMDktMThUMTM6MDk6MzMtMDc6MDAOU8+LAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIwLTA5LTE4VDEzOjA5OjMzLTA3OjAwfw53NwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII="}static defaultIcon(){return new Promise(((e,t)=>{let i=new Image(80,80);i.src=this.iconString(),i.onload=()=>e(i),i.onerror=t}))}static defaultDragImage(e,t){return this.defaultIcon().then((i=>{let s=document.createElement("canvas");s.width=e||32,s.height=t||32,s.getContext("2d").drawImage(i,0,0,s.width,s.height);let o=s.toDataURL(),r=new Image;return r.src=o,r}))}},class GoogleContent{static coverPage(){return`\n<div style="height:100%; width:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">\n    <div style="width:100%; margin-bottom:4%; display:flex; flex-direction:row; justify-content:center;">\n        <img style="width:10%; margin-right:1%" src="${this.docsIcon()}"/>\n        <img style="width:10%; margin-right:1%" src="${this.sheetsIcon()}"/>\n        <img style="width:10%; margin-right:1%" src="${this.slidesIcon()}"/>\n    </div>\n    <div style="width:75%; text-align:center;">\n        <span style="font-family:Poppins-Medium; font-size:16px; color:#4586f3">Paste the link for your Google Workspace document in the URL bar above and hit Enter</span>\n    </div>\n</div>\n`}static docsIcon(){return"data:image/svg+xml,%3Csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 140 175'%3E%3Cdefs%3E%3CclipPath id='clip-path'%3E%3Crect x='-1512.26' y='-1412.5' width='1937.74' height='1092.52' fill='none'/%3E%3C/clipPath%3E%3C/defs%3E%3Cg clip-path='url(%23clip-path)'%3E%3Cpath d='M115.43-1843.61c4.69,9.39,0,1955,0,1955' fill='none' stroke='%23ddd' stroke-miterlimit='10'/%3E%3Cpath d='M24.35-1843.61c4.7,9.39,0,1955,0,1955' fill='none' stroke='%23ddd' stroke-miterlimit='10'/%3E%3C/g%3E%3Cpath d='M15.39,3.68a12,12,0,0,0-12,12V159.33a12,12,0,0,0,12,12H124.6a12,12,0,0,0,12-12V42L98.34,3.68Z' fill='%234e8bf2'/%3E%3Cpath d='M110.34,41.94h26.27L98.34,3.67V29.94A12,12,0,0,0,110.34,41.94Z' fill='%23a7c6fd'/%3E%3Crect x='37.83' y='74.88' width='64.34' height='8.95' rx='3.98' fill='%23edefed'/%3E%3Crect x='37.83' y='87.89' width='64.34' height='8.95' rx='3.98' fill='%23edefed'/%3E%3Crect x='37.83' y='100.9' width='64.34' height='8.95' rx='3.98' fill='%23edefed'/%3E%3Crect x='37.83' y='113.91' width='38.97' height='8.95' rx='3.98' fill='%23edefed'/%3E%3C/svg%3E"}static sheetsIcon(){return"data:image/svg+xml,%3Csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 140 175'%3E%3Cdefs%3E%3CclipPath id='clip-path'%3E%3Crect x='-1672.45' y='-1412.5' width='1937.74' height='1092.52' fill='none'/%3E%3C/clipPath%3E%3C/defs%3E%3Cg clip-path='url(%23clip-path)'%3E%3Cpath d='M137.39-1843.61c4.69,9.39,0,1955,0,1955' fill='none' stroke='%23ddd' stroke-miterlimit='10'/%3E%3Cpath d='M46.31-1843.61c4.7,9.39,0,1955,0,1955' fill='none' stroke='%23ddd' stroke-miterlimit='10'/%3E%3C/g%3E%3Cpath d='M15.39,3.68a12,12,0,0,0-12,12V159.33a12,12,0,0,0,12,12H124.6a12,12,0,0,0,12-12V42L98.34,3.68Z' fill='%2323a464'/%3E%3Cpath d='M110.34,41.94h26.27L98.34,3.67V29.94A12,12,0,0,0,110.34,41.94Z' fill='%238ed0b4'/%3E%3Crect x='34.55' y='68.63' width='70.89' height='60.49' rx='7.2' fill='%23edefed'/%3E%3Cpath d='M42.48,118.4c2.07,0,4.14-.1,6.21-.1,6.27,0,12.9,1.29,17.51-4.79l-.12,6.35L63.48,121l-19.24,0-1.5-1a8.8,8.8,0,0,1-.35-1C42.35,118.77,42.45,118.58,42.48,118.4Z' fill='%23139e5b'/%3E%3Cpath d='M42.81,102.41l4.5.84C45.72,103.48,43.92,104.82,42.81,102.41Z' fill='%2323a464'/%3E%3Cpath d='M63.48,121l2.6-1.14C65.76,121.5,64.69,121.4,63.48,121Z' fill='%2323a464'/%3E%3Cpath d='M42.74,119.91l1.5,1C43.24,121.33,42.74,121,42.74,119.91Z' fill='%2323a464'/%3E%3Crect x='42.27' y='75.35' width='23.93' height='10.9' rx='3.2' fill='%2323a464'/%3E%3Crect x='42.27' y='93.34' width='23.93' height='10.9' rx='3.2' fill='%2323a464'/%3E%3Crect x='42.27' y='111.33' width='23.93' height='10.9' rx='3.2' fill='%2323a464'/%3E%3Crect x='73.3' y='75.35' width='23.93' height='10.9' rx='3.2' fill='%2323a464'/%3E%3Crect x='73.3' y='93.34' width='23.93' height='10.9' rx='3.2' fill='%2323a464'/%3E%3Crect x='73.3' y='111.33' width='23.93' height='10.9' rx='3.2' fill='%2323a464'/%3E%3C/svg%3E"}static slidesIcon(){return"data:image/svg+xml,%3Csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 140 175'%3E%3Cdefs xmlns='http://www.w3.org/2000/svg'%3E%3Cpath id='a' d='M-1823.4 -1412.5H114.33999999999992V-319.98H-1823.4z'/%3E%3C/defs%3E%3CclipPath xmlns='http://www.w3.org/2000/svg' id='b'%3E%3Cuse overflow='visible' xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='%23a'/%3E%3C/clipPath%3E%3Cg xmlns='http://www.w3.org/2000/svg' clip-path='url(%23b)'%3E%3Cpath fill='none' stroke='%23DDDDDD' stroke-miterlimit='10' d='M77.51-1843.61c4.7,9.39,0,1954.96,0,1954.96'/%3E%3C/g%3E%3Cpath xmlns='http://www.w3.org/2000/svg' fill='%23F3B507' d='M15.39,3.68c-6.6,0-12,5.4-12,12v143.65c0,6.6,5.4,12,12,12H124.6c6.6,0,12-5.4,12-12V41.95L98.34,3.68 H15.39z'/%3E%3Cpath xmlns='http://www.w3.org/2000/svg' fill='%23FCDE95' d='M110.34,41.94h26.27L98.34,3.67v26.27C98.34,36.54,103.74,41.94,110.34,41.94z'/%3E%3Cpath xmlns='http://www.w3.org/2000/svg' fill='%23EDEFED' d='M95.29,128.29H49.03c-4.99,0-9.04-4.05-9.04-9.04V72.63c0-4.99,4.05-9.04,9.04-9.04h46.26 c4.99,0,9.04,4.05,9.04,9.04v46.61C104.34,124.24,100.29,128.29,95.29,128.29z'/%3E%3Cpath xmlns='http://www.w3.org/2000/svg' fill='%23F3B507' d='M88.86,109.68H55.47c-4.03,0-7.3-3.27-7.3-7.3V89.5c0-4.03,3.27-7.3,7.3-7.3h33.39c4.03,0,7.3,3.27,7.3,7.3 v12.87C96.16,106.41,92.89,109.68,88.86,109.68z'/%3E%3C/svg%3E"}}]};const o={expanders:[class TextModel{setup(e,t){let i=this.createElement("TextElement"),s=Math.floor(Math.random()*36**10).toString(36);i.domId="text"+s,i.style.setProperty("font-family","OpenSans-Regular"),i.style.setProperty("-cards-text-margin","2px 10px 10px 10px"),i.setDefault("OpenSans-Regular",16),this.text=i,this.setExtent(e,t),this.style.setProperty("-cards-direct-manipulation",!0),this.style.setProperty("width",e+"px"),this.style.setProperty("height",t+"px"),this.setTransform([1,0,0,1,0,0]),this.appendChild(i);let o=this.createElement();o.domId="palette",o.setCode("text.WidgetModel"),o.setViewCode("text.WidgetView"),o._set("text",i.domId),this.appendChild(o),this._set("_useSetExtent",["TextModel","setExtent"]),this._set("_useCustomSaver",["TextModel","saveData"]),this._set("_useCustomLoader",["TextModel","loadData"]),this._set("desiredFrameType","stickyNote")}setExtent(e,t){this.style.setProperty("width",e+"px"),this.style.setProperty("height",t+"px"),this.text.style.setProperty("height",t+"px"),this.text.setWidth(e)}saveData(e){return(()=>{let e=this.wellKnownModel("modelRoot"),t=new Map;return t.set("text",e.stringify(this.text.save())),t})()}loadData(e,t){let i,s=parseFloat(this.style.getPropertyValue("width")),o=parseFloat(this.style.getPropertyValue("height")),r=this.wellKnownModel("modelRoot");i=t.constructor===window.Map?t.get("text"):t.text;let n=r.parse(i);this.setup(s,o),this.text.setDefault(n.defaultFont,n.defaultSize),this.text.setWidth(s),this.text.load(n.runs)}},class WidgetModel{init(){if(!this._get("initialized")){this._set("initialized",!0);let e=this.createElement("div");e.classList.add("text-menu-top");let t=this.createElement();t.domId="boldButton",t.classList.add("text-face-button"),t.setCode("widgets.Button"),t.call("Button","beViewButton","Off","<b style='font-family: serif'>B</b>","text-face-bold","Bold"),t.addDomain(this.id,"bold");let i=this.createElement();i.domId="italicButton",i.classList.add("text-face-button"),i.setCode("widgets.Button"),i.call("Button","beViewButton","Off","<i style='font-family: serif'>I</i>","text-face-italic","Italic"),i.addDomain(this.id,"italic");let s=this.createElement();s.domId="size",s.innerHTML="size",s.classList.add("text-menu-item");let o=this.createElement();o.domId="color",o.innerHTML="color",o.classList.add("text-menu-item"),e.appendChild(t),e.appendChild(i),e.appendChild(s),e.appendChild(o),this.appendChild(e)}}},class WidgetView{init(){this.querySelector("#size").dom.addEventListener("click",(e=>this.launchSizeMenu(e))),this.querySelector("#color").dom.addEventListener("click",(e=>this.launchColorMenu(e))),this.querySelector("#boldButton").dom.addEventListener("click",(e=>this.bold(e))),this.querySelector("#italicButton").dom.addEventListener("click",(e=>this.italic(e)));let e=window.topView.querySelector(`#${this.model._get("text")}`);this.subscribe(e.id,"selectionUpdated","selectionUpdated");let t=this.getSelection();this.hasBoxSelection=!(!t||t.start===t.end),this.selectionUpdated(!0)}getSelection(){return window.topView.querySelector(`#${this.model._get("text")}`).model.content.selections[this.viewId]}dismissMenu(){this.menu&&(this.menu.remove(),this.menu=null)}launchSizeMenu(e){this.menu?this.dismissMenu():(this.menu=this.makeSizeMenu(),this.dom.appendChild(this.menu))}launchColorMenu(e){this.menu?this.dismissMenu():(this.menu=this.makeColorMenu(),this.dom.appendChild(this.menu))}makeSizeMenu(){return this.makeMenu(["8","12","16","20","24"])}makeColorMenu(){return this.makeMenu(["black","blue","green","red"])}makeMenu(e){let t=document.createElement("div");t.classList.add("text-menu","no-select"),e.forEach((e=>{let i=this.makeMenuItem(null,e,e);t.appendChild(i)}));let i=document.createElement("div");return i.classList.add("text-menu-holder"),i.appendChild(t),i}makeMenuItem(e,t,i){let s=document.createElement("div");if(null===t)return s.classList.add("no-select","text-menu-title"),s.innerHTML=`<span>${i}</span>`,s;s.classList.add("no-select","text-menu-item");let o="";if(e){o=`<div class="frame-menu-icon"><svg viewBox="0 0 24 24" class="frame-menu-icon-svg"><use href="#${"img-"+e}"></use></svg></div>`}return o+=`<span class="text-menu-label">${i}</span>`,s.innerHTML=o,s.value=t,s.addEventListener("click",(e=>this.menuSelected(e)),!0),s}menuSelected(e){let t,i=e.currentTarget.value,s=window.topView.querySelector(`#${this.model._get("text")}`);/^[0-9]/.test(i)?(i=parseInt(i,10),t={size:i}):t={color:i},s.mergeStyle(t)}selectionUpdated(e){let t=this.hasBoxSelection,i=window.topView.querySelector(`#${this.model._get("text")}`),s=i.model.content.selections[this.viewId];if(this.hasBoxSelection=!(!s||s.start===s.end),s){let e=i.model.styleAt(s.start),t=e&&e.italic?"On":"Off",o=this.querySelector("#italicButton");o.call("ButtonView","setButtonState",t,o.model._get("label"),o.model._get("class"),o.model._get("title")),t=e&&e.bold?"On":"Off";let r=this.querySelector("#boldButton");r.call("ButtonView","setButtonState",t,r.model._get("label"),r.model._get("class"),r.model._get("title"))}if(!e&&t===this.hasBoxSelection)return;if(e||t&&!this.hasBoxSelection)return this.dismissMenu(),void this.dom.style.setProperty("display","none");let o=i.warota.selectionRects(s);this.dom.style.removeProperty("display");let r=o[0].left+o[0].width/2,n=o[0].top+o[0].height+5;this.dom.style.setProperty("position","absolute"),this.dom.style.setProperty("left",r+"px"),this.dom.style.setProperty("top",n+"px")}bold(){console.log("bold");let e,t=window.topView.querySelector(`#${this.model._get("text")}`),i=this.querySelector("#boldButton"),s="On"!==i.dom.getAttribute("buttonState");e={bold:s},t.mergeStyle(e),i.call("ButtonView","setButtonState",s,i.model._get("label"),i.model._get("class"),i.model._get("title"))}italic(){console.log("italic");let e,t=window.topView.querySelector(`#${this.model._get("text")}`),i=this.querySelector("#italicButton"),s="On"!==i.dom.getAttribute("buttonState");e={italic:s},t.mergeStyle(e),i.call("ButtonView","setButtonState",s,i.model._get("label"),i.model._get("class"),i.model._get("title"))}}],functions:[]};export{i as boards,s as minibrowser,o as text};
